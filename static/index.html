<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">

  <title>Boat Control UI</title>

    <!-- body and base styles -->
    <style>
    
    
    
    /* Testing git. Good Test Scott*/
    
    
    /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #202020;
            color: #ffffff;
            line-height: 1.6;
            overflow: hidden;
            overflow-y: auto;
            height: auto;
        }
        
        html, body {
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
        }

        .scale-container {
        width: 100vw;
        height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        }

        .scale-wrapper {
        display: inline-block;
        transform-origin: top center;
        height: fit-content;
        }

        .control-screen {
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }

        #main {
          flex: 1;
          display: flex;
          flex-direction: column;
          overflow: hidden;
            overflow-y: auto;
        }
        .main-content {
        overflow-y: auto;
        max-height: calc(100vh - 160px); /* примерно: хедер (100px) + футер (60px) */
        }

    </style>


    <!-- INFO BAR -->
    <style>

        .info-bar {
        display: flex;               /* arrange items in a row */
        justify-content: space-between; /* spread elements across the width */
        align-items: center;          /* vertical centering */
        padding: 8px 16px;
        background-color: #202020;    /* dark background */
        color: #ffffff;               /* white text */
        font-size: 14px;
        border-bottom: 1px solid #202020; /* subtle separator */
        }

        /* Put icon + text on one line and center them vertically */
        .info-item {
        display: inline-flex;     /* single row */
        align-items: center;      /* vertical centering */
        gap: 6px;                 /* spacing between icon and text */
        height: 20px;             /* = icon box height */
        white-space: nowrap;      /* prevent wrapping that causes jumps */
        }
        
        
        /* Size and center the SVG icon */
        .info-icon {
        display: inline-flex;      /* keep it inline with text */
        align-items: center;       /* vertical centering */
        justify-content: center;   /* horizontal centering */
        width: 22px;               /* tweak if you need larger icon */
        height: 22px;
        }

        .info-icon img {
        width: 100%;               /* scale SVG to the box */
        height: 100%;
        display: block;            /* remove inline gaps */
        }

        /* Unit label (e.g., "GPS") */
        .info-unit {
        /* small caps look */
        font-family: Inter, system-ui, sans-serif;
        font-weight: 600;
        font-size: 14px;
        letter-spacing: 0.6px;         /* tech look */
        color: #757575;              /* muted gray */
        }

        /* Value text (e.g., "Locked") */
        .info-value {
        font-family: Inter, system-ui, sans-serif;
        font-weight: 600;
        font-size: 14px;
        color: #909090;  /* brighter than unit */
        }


        /* ALARM ICON */
        .alarm-icon{
        display:inline-flex;      /* one row */
        align-items:center;       /* vertical centering */
        justify-content:center;
        width:24px; height:24px;
        opacity: 0.15;

        }
        .alarm-icon img{
        width:100%; height:100%;
        display:block;            /* no extra whitespace */
        }

        /* 2) Active — bright amber (#FFBD0A) */
        .alarm-icon.is-active {
        opacity: 1;
        filter: invert(76%) sepia(90%) saturate(1180%) hue-rotate(357deg) 
        brightness(102%) contrast(103%);

        }
        .alarm-icon.is-active img {
        /* recolor white SVG to near-exact #FFBD0A */
        filter: invert(76%) sepia(90%) saturate(1180%) hue-rotate(357deg) 
        brightness(102%) contrast(103%);
        display: block;
        }


                
        /* Center the middle block like a modal when viewport ≥1600px */
        @media (min-width: 1024px){
        .info-bar{ position: relative; } /* anchor for absolute centering */

        .info-bar .info-item--center{
            position: absolute;           /* take out of flex flow */
            left: 50%;                    /* center in viewport */
            transform: translateX(-50%);  /* exact centering */
            z-index: 2;                   /* above, just in case */
            margin: 0;                    /* ignore inline gaps */
            width: max-content;           /* shrink to its contents */
            pointer-events: auto;         /* keep clickable */
        }
        }


    </style>


    <!-- Navigation -->
    <style>
    /* Navigation arrows */
        .header-inner {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100px;
        z-index: 100;
        }

        .carousel-titles {
          position: absolute;
          top: 5vh;
          left: 50%;
          transform: translateX(-50%);
          z-index: 999;
          pointer-events: none;
        }

        .carousel-title {
          font-size: 2rem;
          font-weight: 600;
          color: white;
          text-align: center;
          opacity: 0;
          transition: opacity 0.3s ease;
          position: absolute;
          left: 50%;
          transform: translateX(-50%);
          white-space: nowrap; 
        }

        .carousel-title.active {
          opacity: 1;
        }

        .nav-arrow {
            position: absolute;
            top: 5vh;
            background: none;        /* no background */
            border: none;            /* no border */
            border-radius: 0;        /* no rounding */
            color: #757575;
            font-size: 32px;         /* make triangle bigger if needed */
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto;             /* no fixed size */
            height: auto;
            padding: 0;              /* no padding */
        }
        .nav-arrow:hover {
            transform: scale(1.2);   /* still animate on hover */
            filter: drop-shadow(0 0 8px rgb(100, 100, 100));
            color: white;
        }
        .nav-arrow.left {
            left: 5vh;
        }
        .nav-arrow.right {
            right: 5vh;
        }

        
    /* Screen indicator dots */
        .screen-indicator {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .indicator-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #505050;
            transition: background-color 0.3s ease;
        }
        .indicator-dot.active {
            background-color: white;
        }
    </style>
    <!-- Screens -->
    <style>

    /* Screens */
        .screen-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px;
        width: 100%;
        }

        .screen-title {
          position: absolute;
          top: 5vh;
          left: 50%;
          transform: translateX(-50%);
          font-size: 2.1rem;
          font-weight: 600;
          color: #ffffff;
          z-index: 100;
        }

        .boat-control {
            flex: 1;
            display: grid;
            grid-template-columns: 60px 1fr 1fr 1fr 1fr 1fr 60px;
            gap: 20px;
            width: 100%;
            align-items: stretch;
            padding: 40px 0;
            padding-top: 80px;

        }
        .container {
          width: 100vw;
          height: 100vh;
          display: flex;
          flex-direction: column;
          position: relative;
        }

        .main-content {
          flex: 1;
          display: flex;
          flex-direction: column;
          position: relative;
        }

        .screen {
          flex: 1;
          display: none;
          flex-direction: column;
          position: relative;
        }

        .screen.active {
          display: flex;
        }

        /* Columns */
        .columns-wrapper.full-height {
          flex: 1;
          display: flex;
          flex-direction: row;
          padding-bottom: 50px;
        }

        .column {
          flex: 1;
          text-align: center;
          color: #fff;
          font-weight: bold;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        .column.col-center {
          background-color: #444;
        }
        .column.col-left-center,
        .column.col-right-center {
          background-color: #3a3a3a;
          flex-direction: column;
          justify-content: space-evenly;

        }
        .column.left,
        .column.right {
          background-color: #3a3a3a;
          flex-direction: column;
          justify-content: space-evenly;
        }
        .column.side-left,
        .column.side-right {
          flex: 0 0 80px;
        }

   </style>

    <!-- GAUGES -->
    <style>
    #gauges-all {
    display: grid;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 997;

    grid-template-columns: 0 1fr 0 0 0 1fr 0;
    width: 130vw;
    pointer-events: none;
    }

    /* Левая колонка (вторая из пяти) = примерно 20% экрана */
    #gauges-all > .gauge-1,
    #gauges-all > .gauge-2,
    #gauges-all > .gauge-3,
    #gauges-all > .gauge-4 {
    grid-column: 2;
    }

    /* Правая колонка (четвёртая из пяти) = примерно 80% экрана */
    #gauges-all > .gauge-5,
    #gauges-all > .gauge-6,
    #gauges-all > .gauge-7,
    #gauges-all > .gauge-8 {
    grid-column: 6;
    }

    /* Общий стиль */
    #gauges-all > div {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 50px 0;
    }

    </style>

    <!-- GAUGES LIST-->
    <style>
        .gauge-mini {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        background-color: #202020;
        border-radius: 8px;
        padding: 8px 12px;
        font-family: sans-serif;
        }

        .gauge-icon {
        width: 32px;
        height: 32px;
        opacity: 0.2;
        object-fit: contain;
        margin-top: 6px; /* Slight vertical alignment */
        }

        .gauge-main {
        display: flex;
        flex-direction: column;
        line-height: 1;
        }

        .gauge-top-row {
        display: flex;
        align-items: baseline;
        gap: 4px;
        }

        .value {
        font-size: 40px;
        font-weight: 600;
        color: white;
        }

        .unit {
        font-size: 40px;
        color: #454545;
        }

        .caption {
        font-size: 10px;
        color: #555555;
        margin-top: 6px;
        padding-left: 1px; /* Slight indent to align visually under value */
        }



    </style>
    <!-- Throttle -->
    <style>

    /* Engine Control Throttle Slider */
        /* Wrapper that handles hover expansion */
        .throttle-wrapper {
        position: absolute;
        top: 50%;
        left: calc(5vh - 105px); /* shifted 40px to the left */

        transform: translateY(-50%);
        z-index: 999;
        }
        /* Default compact gear toggle */
        .mini-gear-toggle {
        width: 36px;
        height: 460px;
        background-color: none;
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 6px 0;
        transition: width 0.3s ease, height 0.3s ease;
        overflow: visible;  
        cursor: pointer;
        }
        /* Expand on hover */
        .throttle-wrapper:hover .mini-gear-toggle {
        width: 85px;
        }
        /* Container for the slider */
        .mini-gear-toggle .gear-track {
        width: 100%;
        height: 100%;
        position: relative;
        }
        /* Track background */
        .gear-track {
        position: relative;
        width: 20px;
        height: 100%;
        background: black;
        border: 1px solid #757575;
        border-radius: 12px;
        margin: 0 auto;
        z-index: 0;
        overflow: visible;
        }
        /* Fill above track, below neutral button and thumb */
        .gear-fill {
        position: absolute;
        bottom: 50%;
        left: 0;
        width: 100%;
        background-color: #FFBD0A;
        border: 0px solid #000000;
        height: 46%;
        z-index: 1;
        }
        /* Forward "F" button on top */
        .forward-button{
        transform: translate(-50%, -50%);
        width: 100%;
        color: #ffffff;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
        white-space: nowrap;
        position: absolute;
        top: 2%;
        left: 50%;
        height: 20px;
        }
        .text-forward {
        display: none;
        }
        .throttle-wrapper:hover .text-f {
        display: none;
        }
        .throttle-wrapper:hover .text-forward {
        display: inline;
        }
        /* Neutral "N" button in center */
        .neutral-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 100%;
        height: 60px;
        background-color: #454545;
        border-radius: 4px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
        white-space: nowrap;
        }
        /* On hover, expand neutral button and reveal full label */
        .throttle-wrapper:hover .neutral-button {
        width: 100%;             /* Match gear-track width */
        font-size: 14px;         /* Slightly larger text */
        }
        /* Default: show 'N', hide 'Neutral' */
        .text-neutral {
        display: none;
        color:#ffffff
        }
        .throttle-wrapper:hover .text-n {
        display: none;
        color:#ffffff

        }
        .throttle-wrapper:hover .text-neutral {
        display: inline;
        color:#ffffff

        }
        /* Ensure gear-track expands smoothly */
        .mini-gear-toggle .gear-track {
        width: 100%;
        transition: width 0.3s ease;
        }
        /* Reverse "R" button on bottom */
        .reverse-button{
        transform: translate(-50%, -50%);
        width: 100%;
        color: #ffffff;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        cursor: pointer;
        transition: all 0.3s ease;
        overflow: hidden;
        white-space: nowrap;
        position: absolute;
        top: 98%;
        left: 50%;
        height: 20px;
        }
        .text-reverse {
        display: none;
        }
        .throttle-wrapper:hover .text-r {
        display: none;
        }
        .throttle-wrapper:hover .text-reverse {
        display: inline;
        }



        /* Gear thumb (slider handle) styling */
        .gear-thumb {
        position: absolute;
        bottom: 50%;
        left: 50%;                          /* Center horizontally */
        transform: translate(-50%, 50%);
        width: 36px;                        /* Narrow default width */
        height: 28px;
        background: linear-gradient(0deg, rgb(30, 30, 30) 0%, rgb(75, 75, 75) 100%);
        border-radius: 10px;
        z-index: 15;                        /* Above all other elements */
        transition: width 0.1s ease;
        }

        /* Optional hover effect for thumb itself */
        .gear-thumb:hover {
        filter: drop-shadow(0 0 4px rgba(255, 255, 255, 1));
        }

        /* Text label inside the thumb */
        .gear-thumb-text {
        display: flex;                     /* ✅ Always visible */
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        pointer-events: none;
        text-align: center;
        font-size: 14px;                   /* ✅ Small by default */
        color: #ffffff;
        transition: all 0.3s ease;
        }

        /* On hover — expand and brighten */
        .throttle-wrapper:hover .gear-thumb {
        width: 100%;
        }

        .throttle-wrapper:hover .gear-thumb-text {
        font-size: 16px;
        opacity: 1;
        color: #ffffff;
        }

        /* Throttle Down Button */
        .throttle-button {
            width: 100%;
            height: 10px;
            background-color: transparent;
            color: #757575;
            font-size: 18px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .throttle-up {
            margin-left: -1px;
        }
        .throttle-icon {
            transition: all 0.2s ease;
        }
        .throttle-button:hover .throttle-icon {
            transform: scale(1.2);
            filter: drop-shadow(0 0 8px white);
            color: white;
        }
                
        /* Throttle expanded GAMEPAD */
        .throttle-wrapper.expanded .mini-gear-toggle {
        width: 120px;
        }

        .throttle-wrapper.expanded .text-f {
        display: none;
        }
        .throttle-wrapper.expanded .text-forward {
        display: inline;
        }

        .throttle-wrapper.expanded .text-n {
        display: none;
        }
        .throttle-wrapper.expanded .text-neutral {
        display: inline;
        }

        .throttle-wrapper.expanded .text-r {
        display: none;
        }
        .throttle-wrapper.expanded .text-reverse {
        display: inline;
        }

        .throttle-wrapper.expanded .gear-thumb {
        width: 100%;
        }
        .throttle-wrapper.expanded .gear-thumb-text {
        display: block;
        }

    </style>
    <!-- RULE RUDDER ANGLE INDICATOR -->
    <style>

    /* RUDDER ANGLE INDICATOR */
       .rudder-wrapper {
            top: 15%;                       /* Vertical offset from the top of the container */
            position: fixed;
            top: 50%;
            left: 50%;
            display: flex;                  /* Use flexbox for vertical layout */
            flex-direction: column;        /* Stack child elements vertically */
            align-items: center;           /* Center child elements horizontally */

            width: 100%;                   /* Take full available width */
            max-width: 300px;              /* But don't exceed 200px */
            box-sizing: border-box;        /* Include padding in width/height calculation */
            padding: 50px;                 /* Inner spacing */

            z-index: 6;                    /* Layer position (on top of lower elements) */
        }

        .rudder-gauge {
        top: calc(40% + 6vw); /* position below the boat */
        left: 50%;
        width: fit-content;
        height: 120px;
        z-index: 2;
        pointer-events: none;
        overflow: visible; 
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        
        }
        .rudder-gauge svg {
            display: block;
            margin: 0 auto;
            width: 100%;
            height: auto;
        }
        /* Rudder Angle UNPUT */
        /* Rudder input container */
        .rudder-input-control {

        display: flex;                /* Align elements horizontally */
        gap: 6px;                     /* Space between input and ° sign */
        justify-content: center;
        font-family: sans-serif;
        font-size: 14px;
        z-index: 10;
        white-space: nowrap
        }
        /* Input field styling */
        #rudder-input {
        width: 50px;                  /* Fixed width for neat alignment */
        padding: 4px;                 /* Inner padding for comfort */
        font-size: 14px;              /* Match text size to label */
        color: #ffffff;       
        background: #000000;  
        border: 1px solid #757575; 
        border-radius: 4px;
        
        }
        .rudder-input-control label {
        color: #757575; 
        font-size: 14px;
        }
    </style>

    <!-- BOAT // Rudder & Trim GAUGE row -->
    <style>
    /* Row container */
    .boat-stats-row {
    display: flex;
    gap: 48px;            /* space between left/right chips */
    align-items: baseline;/* align icon+number to same baseline */
    justify-content: center;
    margin-top: 8px;      /* adjust to fit under your existing blocks */
    }

    /* Each stat chip */
    .boat-stat {
    display: inline-flex;
    align-items: center;  /* icon and number share baseline */
    gap: 10px;
    color: #e7e7e7;         /* inherit or override to your palette */
    font-family: inherit;
    }

    /* Icon container */
    .boat-stat__icon {
    display: inline-flex;
    line-height: 1;
    }

    /* Icon itself (works for both <img> and <svg>) */
    .boat-icon {
    width: 24px;   /* tune to match your UI scale */
    height: 24px;
    display: block;
    object-fit: contain;   /* ensures <img> scales correctly */
    flex-shrink: 0;        /* prevents icon from shrinking */
    color: currentColor;   /* for inline SVGs still allows inheriting text color */
    }

    /* Value */
    .boat-stat__value {
    display: inline-flex;
    align-items: baseline;  /* number + degree on one line bottom-aligned */
    gap: 4px;
    font-weight: 600;
    letter-spacing: 0.2px;
    }
    .boat-stat__value #rudder-angle-value,
    .boat-stat__value #trim-value {
    font-size: 16px;      /* main number size */
    line-height: 1;
    }

    /* Small degree sign */
    .boat-stat__value .deg {
    font-size: 16px;
    line-height: 1;
    vertical-align: top;   /* raises degree slightly */
    opacity: 0.85;
    }

    /* Update feedback effect */
    .boat-stat.updating .boat-stat__value {
    text-shadow: 0 0 8px rgba(255,255,255,0.15);
    }

    </style>


    <!-- FOOTER -->
    <style>

    /* Status bar */
        .status-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;

        height: 60px;
        background-color: #101010;
        border-top: 1px solid #333;
        display: flex;
        align-items: center;
        padding: 0 20px;
        z-index: 999;
        cursor: pointer;
        }

        .status-bar:hover {
            background-color: #171717;
        }
        .status-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .connection-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: dodgerblue;
            animation: pulse-connection 2s infinite;
        }
        @keyframes pulse-connection {
            0% { 
                box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(52, 152, 219, 1);
                transform: scale(1.1);
            }
            100% { 
                box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
                transform: scale(1);
            }
        }
        .connection-indicator.disconnected {
            background-color: red;
            animation: none;
        }
        .status-text {
            color: #e0e0e0;
            font-size: 16px;
        }

    /* Debug panel titles */
        body.connected .debug-box h3 {
            color: dodgerblue;
        }
        body.disconnected .debug-box h3 {
            color: red;
        }

    /* Debug panel */
        .debug-panel {
            position: absolute;
            bottom: 60px;
            left: 0;
            right: 0;
            background-color: black;
            border-top: 1px solid #353535;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            z-index: 2000;
        }
        .debug-panel.open {
            max-height: 300px;
        }
        .debug-content {
            padding: 0px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 0px;
        }
        .debug-box {
            background-color: black;
            border: 1px solid black;
            border-radius: 0px;
            padding: 15px;
        }
        .debug-box h3 {
            margin-top: 0;
            font-size: 16px;
            color: steelblue ;
            margin-bottom: 10px;
        }
        .debug-box pre {
            background-color: #202020;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #ecf0f1;
            border: 1px solid #353535;
            max-height: 150px;
            overflow-y: auto;
        }

    /* Options */
        .options-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .options-icons {
            display: flex;
            gap: 16px;
            margin-top: 10px;
        }
        .options-icon {
            width: 32px;
            height: 32px;
            filter: brightness(0) invert(1);
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        .options-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 8px white);
        } 

    </style>
    <!-- Boat container -->
    <style>

    /* Boat container */
        .boat-image {
            z-index: 0;
            align-items: center;
            justify-content: center;
            width: 14.4vw;
            transform: scale(1.2);

        }
        .boat-image:hover {
            filter: drop-shadow(0 0 8px rgb(100, 100, 100));
        }
        
    </style>
    <!-- EDIT Button MODAL -->
    <style>

        body.editing-mode {
            background-color: #000000;
        }
        body.editing-mode .control-button button {
            background-color: #757575 !important;
            border: 2px dashed #ffffff;
            box-shadow: none !important;
        }
        body.editing-mode .safety-cap {
            pointer-events: none;
            opacity: 0.4;
        }
        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3100;
            background-color: transparent;
        }

    /* MODAL Button edit WINDOW BASE */
        .modal-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #202020;
            color: #fff;
            border-radius: 8px;
            padding: 20px;
            width: 400px;
            z-index: 3101;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #edit-modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            pointer-events: auto;
        }

    /* MODAL Button edit WINDOW inside */
        .editor-screen-title {
            text-align: center;
            font-size: 2.1rem;
            font-weight: 600;
            color: #757575;
            padding: 4vh 0;
        }

    /* BASE */
        .editor-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%; /* fixed screen coverage */
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .editor-modal-window {
            background-color: #202020;
            padding: 0px 0px;
            border-radius: 1px;
            width: 360px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            padding-top: 26px;
            padding-bottom: 26px;
        }
        .editor-modal-title {
            font-size: 1.8rem;
            margin-bottom: 24px;
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .editor-modal-title {
            margin: 0 0 12px 0;
        }
        .editor-modal-actions {
            margin-top: 32px;
        }  
        .editor-modal-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .editor-modal-actions {
            margin-top: 30px;
            display: flex;
            gap: 16px;
        }

    /* PREVIEW WINDOW */
        .editor-preview-frame {
            width: 288px;
            height: 240px;
            border: 1px solid #2a2a2a;
            background-color: #2a2a2a;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            padding: 12px;
            position: relative;
        }
        .editor-preview-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            height: 100%;
            width: 100%;
        }

    /* Preview Button */
        .editor-preview-button {
            width: 150px;
            height: 75px;
            background-color: rgb(30, 30, 30);
            border: none;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: auto;
            margin-bottom: auto;

        }
        .editor-control-button {
            position: relative;
            margin-top: 90px;
            width: 120px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .editor-button-icon {
            width: 40px;
            height: 40px;
            filter: brightness(0) saturate(100%) invert(44%) sepia(0%) saturate(0%) hue-rotate(175deg) brightness(96%) contrast(85%);

        }
        .editor-button-label {
            margin-top: 6px;
            font-size: 0.9rem;
            text-align: center;
            color: #757575;
        }

    /* Change Preview Button Icon */
        .editor-button-icon {
            filter: brightness(0) saturate(100%) invert(44%) sepia(0%) saturate(0%) hue-rotate(175deg) brightness(96%) contrast(85%);
            transition: filter 0.2s ease;
        }
        .editor-preview-button:hover .editor-button-icon {
            filter: none; /* Shows original white icon on hover */
            filter: drop-shadow(0 0 10px rgb(120, 120, 120));
        }
        .editor-icon-picker-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #202020;
            border: 1px solid #757575;
            padding: 20px;
            border-radius: 8px;
            display: none; /* Hidden by default */
            z-index: 1000;
        }
        .editor-icon-grid {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .editor-icon-grid img {
            width: 40px;
            height: 40px;
            cursor: pointer;
            filter: brightness(0) saturate(100%) invert(44%);
            transition: filter 0.2s ease;
        }

    /* Hover effect */
        .editor-icon-grid img:hover {
            filter: none;
            transform: scale(1.05);
            filter: drop-shadow(0 0 10px rgb(120, 120, 120));
        }
        .editor-button-icon {
            transition: filter 0.2s ease, transform 0.2s ease;
        }
        .editor-button-icon.icon-selected {
            filter: none;
        }
        .editor-preview-button:hover .editor-button-icon.icon-selected {
            filter: drop-shadow(0 0 10px rgb(120, 120, 120));
            transform: scale(1.05);
        }

    /* Safety Cap */
        .editor-safety-cap {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-110%);
            width: 150px;
            height: 75px;
            background: repeating-linear-gradient(-45deg, #9a7000, #9a7000 12px, black 8px, black 25px);
            border-radius: 10px;
            z-index: 2;
            outline: 2px solid #9a7000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: rgba(0, 0, 0, 0.7);
            font-weight: bold;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.4);
            pointer-events: none;
        }
        .editor-no-safety-cap {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-110%);
            width: 150px;
            height: 75px;
            background:  #2a2a2a;
            border-radius: 10px;
            z-index: 2;
            outline: 2px dotted #757575;
            box-shadow: 0 0 0 3px #2a2a2a; /* solid outer border */
            display: flex;
            justify-content: center;
            pointer-events: none;
        }
        .editor-cap-icon {
            width: 24px;
            height: 24px;
            filter: brightness(0) invert(1);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

    /* Safety Cap Hover */
        .editor-safety-cap-hover {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-110%);
            width: 150px;
            height: 75px;
            background: repeating-linear-gradient(-45deg, #41361c, #41361c 12px, #202020 8px, #202020 25px);
            border-radius: 10px;
            z-index: 2;
            outline: 2px solid #41361c;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: rgba(0, 0, 0, 0.7);
            font-weight: bold;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.4);
            pointer-events: none;
        }
        .editor-cap-container {
            position: absolute;
            top: -80px; /* shift upwards */
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 75px;
            z-index: 2;
        }

    /* Common styles for all states */
        .editor-cap-container .editor-safety-cap,
        .editor-cap-container .editor-no-safety-cap,
        .editor-cap-container .editor-safety-cap-hover {
            position: absolute;
            top: 0;
            left: 0;
            transform: none; /* make sure there’s no inherited translate */
            width: 150px;
            height: 75px;
            border-radius: 10px;
            pointer-events: none;
        }

    /* Hover effect */
        .editor-cap-container .editor-safety-cap-hover {
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 3;
        }
        .editor-cap-container:hover .editor-safety-cap-hover {
            opacity: 1;
        }

    /* State: safety cap visible */
        .editor-cap-container.state-safety .editor-safety-cap {
            display: block;
        }
        .editor-cap-container.state-safety .editor-no-safety-cap {
            display: none;
        }

    /* State: no safety cap visible */
        .editor-cap-container.state-no-cap .editor-safety-cap {
            display: none;
        }
        .editor-cap-container.state-no-cap .editor-no-safety-cap {
            display: block;
        }
        .editor-safety-cap img {
            width: 50px;        
            height: 50px;        
            filter: 
            brightness(0)
            drop-shadow(2px 0 0 #9a7000)
            drop-shadow(-2px 0 0 #9a7000)
            drop-shadow(0 2px 0 #9a7000)
            drop-shadow(0 -2px 0 #9a7000)
            drop-shadow(3px 3px 0 #9a7000)
            drop-shadow(-3px 3px 0 #9a7000)
            drop-shadow(3px -3px 0 #9a7000)
            drop-shadow(-3px -3px 0 #9a7000);
        }

    /* Label below Preview button */
        .editor-button-label[contenteditable="true"]:hover {
            color: #ffffff;
            font-weight: bold;
            cursor: text;
        }
        .editor-button-label-input {
            margin-top: 6px;
            font-size: 0.9rem;
            text-align: center;
            color: #ffffff;
            background-color: transparent;
            border: none;
            outline: none;
            border-bottom: 1px solid #757575;
            width: 100px;
            text-transform: uppercase;
        }
        .editor-button-label-input:focus {
            border-bottom: 1px solid #ffffff;
        }
        .editor-button-label[contenteditable="true"]:focus {
            outline: none; /* remove default focus outline */
            padding: 4px 6px; /* add inner spacing around the text */
            border: 1px dashed #757575; /* show a dashed border during editing */
            border-radius: 4px; /* slightly rounded corners */
            background-color: #2a2a2a; /* optional: gives subtle contrast while editing */
        }
        .editor-button-label.edited {
            color: #ffffff;        
            font-weight: bold;
            white-space: nowrap;
    
        }


    /* FUNCTION BUTTONS */

        .editor-options-row {
            width: 288px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .editor-option-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .editor-option-block {
            width: 64px;
            height: 64px;
            background-color: #2a2a2a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .editor-option-block img {
            width: 32px;
            height: 32px;
            filter: brightness(0) saturate(100%) invert(44%) sepia(0%) saturate(0%) hue-rotate(175deg) brightness(96%) contrast(85%);
        }
        .editor-option-label {
            margin-top: 6px;
            font-size: 12px;
            color: #757575;
            text-align: center;
        }
        .editor-option-wrapper.active .editor-option-block {
            outline: 2px solid #ffffff;
            box-shadow: 0 0 4px #ffffff;
        }

    /* Active Function Buttons */
        .editor-option-wrapper.active .editor-option-block img {
            filter: none; /* Show the original white icon */
        }
        .editor-option-wrapper.active .editor-value-box {
            border-color: #ffffff;
        }
        .editor-option-wrapper.active .editor-value-box span {
            color: #ffffff;
        }
        .editor-option-wrapper.active .editor-option-label {
            color: #ffffff;
            font-weight: bold;
        }


    /* Timer Input label */
        .editor-value-box {
            position: relative;
            width: 90px;
            height: 30px;
            border: 1px solid #757575;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
            background-color: transparent;
            overflow: hidden;
        }
        .editor-value-box-wrapper {
            display: flex;
            justify-content: flex-end; /* align to the right */
            width: 288px;
            margin-top: 4px;
        }
        .editor-value-input {
            width: 100%;
            height: 100%;
            padding-right: 36px;
            background-color: transparent;
            border: none;
            font-size: 14px;
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
            text-align: right;
            outline: none;
            position: relative;
            z-index: 2;
            color: #757575;

            
            /* remove arrows */
            appearance: textfield;
            -moz-appearance: textfield;
            -webkit-appearance: none;
        }
        .editor-value-input:disabled {
            color: #757575;
            cursor: not-allowed;
        }
        .editor-modal-window:not(.timer-active) .editor-arrow-controls {
            color: #757575;
            pointer-events: none;
        }
        .editor-arrow-controls {
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-right: 6px;
            margin-left: 6px;
            z-index: 2;
        }
        .editor-arrow-controls button {
            background: none;
            border: none;
            color: #757575;
            font-size: 8px;
            line-height: 10px;
            padding: 0;
            cursor: pointer;
            height: 10px;
        }
       /* Up arrow when timer button is activated */
        .editor-modal-window.timer-active .arrow-up:hover {
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 -1px 2px #ffffff;
        }
        /* Up down when timer button is activated */
        .editor-modal-window.timer-active .arrow-down:hover {
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 1px 2px #ffffff;
        }
        .editor-option-wrapper.active .editor-arrow-controls button {
            color: #ffffff;
            font-weight: bold;
        }
        .editor-value-input::-webkit-outer-spin-button,
        .editor-value-input::-webkit-inner-spin-button {
            appearance: none;
            -webkit-appearance: none;
            margin: 0;
        }
        /* ms unit label */
        .editor-unit-label {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: #757575;
            font-size: 14px;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }
        /* Active white text */
        .editor-modal-window.timer-active .editor-value-box {
            border-color: #ffffff;
        }
        .editor-modal-window.timer-active .editor-value-input {
            color: #ffffff;
        }
        .editor-modal-window.timer-active .editor-unit-label {
            color: #ffffff;
        }


    /* Input row layout */
        /* === Row container for label + input === */
        .editor-custom-input-row {
        display: flex;
        align-items: center;
        justify-content: space-between; /* aligns label left, input right */
        gap: 10px;                        /* space between label and field */
        margin-top: 16px;            /* top & bottom spacing */
        margin-bottom: 0px;
        font-family: 'Roboto', sans-serif;
        }
        .editor-custom-input-row:nth-of-type(2) {
        margin-top: 0px;
        margin-bottom: 0px;
        }
        /* Label (e.g., "CAN:") */
        .editor-custom-label {
        min-width: 40px;
        font-weight: normal;
        color: #757575;
        height: 32px;
        line-height: 32px;
        font-size: 12px;
        }
        /* Prefixed input block (shared styles for BN and HEX) */
        .editor-prefixed-wrapper,
        .bn-wrapper,
        .hex-wrapper {
        display: flex;
        align-items: center;
        background-color: #202020;
        border: 1px solid #757575;
        border-radius: 4px;
        overflow: hidden;
        height: 32px;
        }
        /* Specific margin between BN and HEX fields */
        .bn-wrapper {
        margin-right: 2px;
        }
        /* BN prefix inside the field */
        .bn-wrapper .editor-prefix,
        .editor-prefix {
        padding: 0 6px;
        color: #757575;
        font-family: monospace;
        font-size: 12px;
        display: flex;
        align-items: center;
        background: none;
        border: none;
        height: 100%;
        }
        /* Input for 3-digit BN code */
        .bn-wrapper .editor-prefixed-input,
        .editor-prefixed-input {
        width: 45px;
        padding: 0 6px;
        font-size: 12px;
        background: none;
        border: none;
        color: #757575;
        height: 100%;
        outline: none;
        }
        /* Input for HEX values */
        .hex-wrapper input {
        width: 154px;
        padding: 0 10px;
        font-size: 12px;
        background: none;
        border: none;
        color: #757575;
        height: 100%;
        outline: none;
        }
        /* Remove input focus outline */
        .editor-prefixed-input:focus,
        .hex-wrapper input:focus {
        outline: none;
        box-shadow: none;
        }
        /* Dropdown (select) styling */
        .editor-select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: #202020;
        color: #757575;
        border: 1px solid #757575;
        border-radius: 4px;
        padding: 6px 10px;
        font-size: 14px;
        font-family: 'Roboto', sans-serif;
        width: 196px;
        background-image: url('data:image/svg+xml;utf8,<svg fill="%23aaa" height="20" width="20" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px;
        padding-right: 30px; /* reserve space for dropdown icon */
        }
        /* Arrow Dropdown icon */
        .editor-select {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23757575" height="24" width="24" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 28px;
        padding-right: 32px;
        }



        /* Buttons Cancel + Create */
        .editor-modal-actions {
            display: flex;
            justify-content: space-between; /* aligns buttons to opposite sides */
            width: 288px;
            margin-top: 30px;
        }
        .editor-cancel-button,
        .editor-apply-button {
            padding: 10px 30px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: sans-serif;
            width: 48%; /* optional: keeps buttons similar in size */
        }
        .editor-cancel-button {
            background-color: transparent;
            color: #757575;
            border: 1px solid #757575;
        }
        .editor-apply-button {
            background-color: transparent;
            color: #757575;
            border: 1px solid #757575;
        }
        .editor-cancel-button:hover,
        .editor-apply-button:hover {
            outline: 2px solid #ffffff;
            color: #ffffff;
            font-weight: bold;
        }

        /* Close window */
        .editor-modal-window {
            position: relative; /* It is necessary to position the cross inside */
        }
        .editor-modal-close {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 18px;
            color: #999;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .editor-modal-close:hover {
            color: white;
        }
        
        /* Buttons Fuctions Hover */
        .editor-option-wrapper:hover .editor-option-block {
            box-shadow: 0 0 6px #ffffff;
            transition: all 0.2s ease;
        }
        .editor-option-wrapper:hover .editor-option-label {
            color: #ffffff;
            transition: all 0.2s ease;

        }


    </style>
    <!-- TRIM MODAL -->
    <style>
        /* TRIM MODAL */
        #trim-modal-backdrop {
            z-index: 3200;
        }
        #trim-modal-container {
            z-index: 3300;
        }
        /* TRIM MODAL Background image */
        .trim-image-wrapper {
            position: relative;
            width: 100%;
            height: 340px; /* or any value you need */
            overflow: hidden;
        }
        .trim-center-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: auto;
        }
        .editor-modal-actions {
            margin: 4;
            margin-bottom: 12px;
        }
        .trim-center-image {
            pointer-events: none;
        }
        /* TRIM MODAL Arrow */
        .trim-center-image {
        width: 100%;
        height: auto;
        display: block;
        }
        /* gauge overlay container */
        .trim-gauge-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
        }
        /* pointer container */
        .trim-pointer {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 250px;  /* or your square size */
        height: 250px;
        transform: translate(-50%, -50%);
        z-index: 3;
        pointer-events: none;
        }
        .trim-pointer-img {
        width: 100%;
        height: 100%;
        transform-origin: 50% 50%;
        transition: transform 0.3s ease;
        }
        /* SLIDER */
        .trim-slider-wrapper {
        position: relative;
        width: 80px;
        height: 340px; 
        margin-left: auto;
        margin-right: 0;
        margin-top: 0;
        margin-bottom: 0;
        z-index: 2;
        overflow: visible; 
        }
        .trim-labels {
        position: absolute;
        left: 8px;
        top: 0;
        width: 30px;
        height: 90%;
        font-size: 10px;
        font-family: 'Roboto', sans-serif;
        font-weight: 700;
        color: #757575;
        line-height: 15px;
        text-align: center;
        pointer-events: none;
        }
        /* Background track */
        .trim-track-bg {
        position: absolute;
        top: 10;
        left: 40px;
        width: 30px;
        height: 100%;
        background: black;
        border-radius: 10px;
        }
        /* Fill Yellow area */
        .trim-track-fill {
        position: absolute;
        background-color: #FFBD0A;
        border-radius: 9px;
        left: 0;
        bottom: 0; /* ✅ Anchor to bottom */
        left: 42px;
        width: 29%;
        z-index: 1;
        height: 100%;
        bottom: 2px
        }
        /* Thumb handle */
        .trim-thumb {
        position: absolute;
        left: 36px;
        width: 38px;
        height: 26px;
        background: radial-gradient(ellipse 50% 50% at 50% 50%, #939393 0%, #737373 100%);
        border-radius: 10%;
        transform: translateY(-50%);
        cursor: grab;
        z-index: 10;
        }
        .trim-thumb:hover {
        filter: drop-shadow(0 0 8px rgb(100, 100, 100));
        background: radial-gradient(ellipse 50% 50% at 50% 50%, #a8a8a8 0%, #848484 100%);
        }
        /* Thumb SLIDER */
        .trim-slider-overlay {
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        display: flex;
        align-items: center;
        padding-right: 10px;
        z-index: 4;
        }
        /* READOUT */
        .trim-readout {
        position: absolute;
        left: -230px;
        bottom: 0;
        width: 60px;
        height: 40px;
        background-color: #000000;
        color: #fff;
        font-family: Roboto, sans-serif;
        font-weight: normal;
        font-size: 28px;
        text-align: center;
        line-height: 40px;
        border-radius: 4px;
        z-index: 6;
        }

    </style>
    <!-- NEW VERSION -->
    <style> 

        .gauges-left, .gauges-right,
        .buttons-left, .buttons-right {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        }
        .buttons-left button,
        .buttons-right button {
        width: 100%; min-width: 100px;
        max-width: 140px;
        height: 120px;
        }
        .boat-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        }
        .boat-center img {
        width: 100px;
        height: auto;
        margin-bottom: 16px;
        }
        .throttle-slider {
            width: 40px;
            max-width: 40px;
            height: 200px;
            background-color: #404040;
            border-radius: 8px;
            margin: auto;
        }
        .column-right,
        .throttle-gauge {
        display: flex;
        justify-content: center;
        align-items: center;
        }
        .button-bottom {
        display: flex;
        justify-content: center;
        gap: 16px;
        }
        .gauges-mobile,
        .all-buttons,
        .boat-center-mobile,
        .boat-row-mobile {
        display: none;
        }
        footer.screen-footer {
        background: #111;
        padding: 10px;
        text-align: center;
        }
 
    </style>

<!-- NEW VERSION 2 -->

    <!-- MOBILE VERSION -->
    <style>
    @media (max-width: 768px) {
    .screen-main {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        gap: 12px;
        justify-content: space-between; /* или flex-start / center */
        justify-content: center;
        padding-bottom: 30px;
        }
        }

        /* GAUGES BLOCK */
        .gauge-1, .gauge-2, .gauge-3, .gauge-4,
        .gauge-5, .gauge-6, .gauge-7, .gauge-8 {
            flex: 1 1 calc(25% - 12px); /* 4 в ряд */
            order: 1;
            margin: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* CENTER BLOCK (boat + throttles) */
 

       .rudder-wrapper {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 998;

        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 28px;
        pointer-events: none;
        }


        /* BUTTONS BLOCK */
        .button-1, .button-2, .button-3, .button-4,
        .button-5, .button-6, .button-7, .button-8 {
            order: 3;
            margin: 5px;
        }

    </style>
    
    <!-- TABLET VERSION -->
    <style>
    </style>

    <!-- DESKTOP VERSION -->
    <style>

        @media (min-width: 769px) {
            .screen-main {
            display: grid;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 996;    
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: min-content;
            gap: 30px;
            padding: 24px;
            align-items: center;
            justify-items: center;
        }
            .rudder-wrapper,
            .boat-image {
            pointer-events: auto;
            }


        .main-content {
            display: flex;
            flex-direction: column;
            max-width: 100%;
            flex-wrap: nowrap;
            overflow: hidden;
        }

        /* Левый throttle */
        .throttle-wrapper {
            grid-column: 1;
            grid-row: 2;
            justify-self: center;
        }

        /* Левые gauges */
        .gauge-1 { grid-column: 2; grid-row: 1; }
        .gauge-2 { grid-column: 2; grid-row: 2; }
        .gauge-3 { grid-column: 2; grid-row: 3; }
        .gauge-4 { grid-column: 2; grid-row: 4; }

        /* Левые кнопки (по центру блока, визуально как gauges) */
        .button-1 { grid-column: 3; grid-row: 1; }
        .button-2 { grid-column: 3; grid-row: 2; }
        .button-3 { grid-column: 3; grid-row: 3; }
        .button-4 { grid-column: 3; grid-row: 4; }





        
        /* Центр (rudder + лодка) */
        .rudder-wrapper {
            grid-column: 4;
            grid-row: 1 / span 4;
            justify-self: center;
            align-self: center;

            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .boat-image {
            width: 12vw;
            max-width: 140px;
            transform: scale(1);
        }

        /* Правые кнопки */
        .button-5 { grid-column: 5; grid-row: 1; }
        .button-6 { grid-column: 5; grid-row: 2; }
        .button-7 { grid-column: 5; grid-row: 3; }
        .button-8 { grid-column: 5; grid-row: 4; }

        /* Правые gauges */
        .gauge-5 { grid-column: 6; grid-row: 1; }
        .gauge-6 { grid-column: 6; grid-row: 2; }
        .gauge-7 { grid-column: 6; grid-row: 3; }
        .gauge-8 { grid-column: 6; grid-row: 4; }

        /* Общие отступы и центрирование */
        .gauge-1, .gauge-2, .gauge-3, .gauge-4,
        .gauge-5, .gauge-6, .gauge-7, .gauge-8,
        .button-1, .button-2, .button-3, .button-4,
        .button-5, .button-6, .button-7, .button-8 {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0; /* добавлено для согласованности с gauges */
        }

        .control-button {
            width: 100%;
            max-width: 140px;
            
        }

        .gauge-placeholder {
            width: 100px;
            height: 100px;
        }

        /* Payload screen layout for screen 2 */
        #screen-2 .button-1 { grid-column: 3; grid-row: 1; }
        #screen-2 .button-2 { grid-column: 3; grid-row: 2; }
        #screen-2 .button-3 { grid-column: 3; grid-row: 3; }
        #screen-2 .button-4 { grid-column: 5; grid-row: 1; }
        #screen-2 .button-5 { grid-column: 5; grid-row: 2; }
        #screen-2 .button-6 { grid-column: 5; grid-row: 3; }




        /* Payload screen layout for screen 3 */
        #screen-3 .button-1 { grid-column: 3; grid-row: 1; }
        #screen-3 .button-2 { grid-column: 3; grid-row: 2; }
        #screen-3 .button-3 { grid-column: 5; grid-row: 1; }
        #screen-3 .button-4 { grid-column: 5; grid-row: 2; }



    }






        
    </style>

    <!-- SIZE SMALL -->
    <style>
        
        @media (min-width: 1400px) {
        .scale-wrapper {
            transform: scale(1);
        }
        }

        @media (max-width: 1399px) and (min-width: 1200px) {
        .scale-wrapper {
            transform: scale(0.9);
        }
        }

        @media (max-width: 1199px) and (min-width: 1025px) {
        .scale-wrapper {
            transform: scale(0.8);
        }
        }

        @media (max-width: 1024px) {
        .scale-wrapper {
            transform: none;
        }
        }


        @media (min-width: 551px) and (max-width: 768px) {
        .screen-main {
            display: grid !important;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: min-content;
            gap: 16px;
            padding: 16px;
            justify-items: center;
        }

        .rudder-wrapper {
            grid-column: 2 / span 2;
            grid-row: 2;
            justify-self: center;
        }

            .throttle-wrapper {
            grid-column: 1;
            grid-row: 2; /* или другой ряд, если нужно ниже/выше */
            justify-self: start;
            align-self: center;
            margin-top: 0;
        }

            .gauge-1 { grid-column: 1; grid-row: 1; }
            .gauge-2 { grid-column: 2; grid-row: 1; }
            .gauge-3 { grid-column: 3; grid-row: 1; }
            .gauge-4 { grid-column: 4; grid-row: 1; }
            
            .gauge-5 { grid-column: 1; grid-row: 5; }
            .gauge-6 { grid-column: 2; grid-row: 5; }
            .gauge-7 { grid-column: 3; grid-row: 5; }
            .gauge-8 { grid-column: 4; grid-row: 5; }

            .button-1 { grid-column: 1; grid-row: 3; }
            .button-2 { grid-column: 2; grid-row: 3; }
            .button-3 { grid-column: 3; grid-row: 3; }
            .button-4 { grid-column: 4; grid-row: 3; }

            .button-5 { grid-column: 1; grid-row: 4; }
            .button-6 { grid-column: 2; grid-row: 4; }
            .button-7 { grid-column: 3; grid-row: 4; }
            .button-8 { grid-column: 4; grid-row: 4; }


        }

    </style>

    <!-- HUGE SIGN & ANIMATION LOAD -->
    <style>
    /* HUGE SIGN */
    #throttle-indicator{
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 30vh;
    font-weight: bold;
    color: rgba(255,255,255,0.8);
    text-shadow: 0 0 30px rgba(255,255,255,0.8);
    z-index: 100000;
    pointer-events: none;
    opacity: 0;
    transition: opacity .2s ease;
    }
    #throttle-indicator.show{ opacity: 1; }



    /* ANIMATION LOAD */

    /* OVERLAY */
    #start-loader{
    position: fixed;
    inset: 0;
    display: grid;
    place-items: center;
    z-index: 100001;      /* above #throttle-indicator */
    pointer-events: none;
    opacity: 0;
    transition: opacity .2s ease;
    }
    #start-loader.show{ opacity: 1; }

    /* Fullscreen slot */
    #start-loader .loader-slot{
    width: 100vw; height: 100vh;
    display: grid; place-items: center;
    background: rgba(0,0,0,0.45);
    font: 600 18px/1.2 Inter, system-ui, sans-serif;
    color: #fff; text-transform: uppercase; letter-spacing: .08em;
    }

    /* (optional) background pulse – remove if you don't use it */
    #start-loader.show .loader-slot{
    animation: startLoaderPulse 1.2s ease-in-out infinite;
    }

    /* POWER icon scale (3×) */
    #start-loader .start-power{
    width: 480px; height: 480px;
    display: grid; place-items: center;
    }
    #start-loader .start-power svg{
    width: 300px; height: 300px; display: block;
    }

    /* (optional) CSS spinner fallback size */
    #start-loader .start-spinner{
    width: 480px; height: 480px; display: grid; place-items: center;
    }
    #start-loader .start-spinner__ring{
    width: 216px; height: 216px; border-width: 18px;
    }

    /* POWER icon root: enable GPU hint for jitter */
    .start-power{ will-change: transform, filter; }

    /* Track circle (latest: black) */
    .start-power__track{
    fill: none;
    stroke: #000000;
    stroke-width: 10;
    }

    /* Progress arc (pathLength=1), starts at 1 o’clock, jerky fill with easing */
    .start-power__progress{
    --C: 1;
    --S: var(--start-frac, 0.0833333);    /* 30°/360 */
    --ARC: var(--sweep-frac, 0.8333333);  /* 300°/360 */

    fill: none;
    stroke: #ffffff;
    stroke-width: 10;
    stroke-linecap: round;

    stroke-dasharray: 0 var(--C);
    transform-origin: 50% 50%;
    transform: rotate(-90deg);
    stroke-dashoffset: calc(-1 * var(--S));

    /* last chosen timing: cubic-bezier(.42,0,.58,1) */
    animation: startPowerFillJerk var(--fill-ms,2000ms) cubic-bezier(.42,0,.58,1) forwards;
    filter: drop-shadow(0 0 6px rgba(171,171,171,0.45));
    }

    /* Jerky/stuttered growth */
    @keyframes startPowerFillJerk{
    0%   { stroke-dasharray: 0                        var(--C); }
    8%   { stroke-dasharray: calc(var(--ARC)*0.04)    var(--C); } /* gentle jump */
    10%  { stroke-dasharray: calc(var(--ARC)*0.10)    var(--C); }
    13%  { stroke-dasharray: calc(var(--ARC)*0.12)    var(--C); }
    25%  { stroke-dasharray: calc(var(--ARC)*0.22)    var(--C); }
    35%  { stroke-dasharray: calc(var(--ARC)*0.38)    var(--C); }
    45%  { stroke-dasharray: calc(var(--ARC)*0.41)    var(--C); }
    60%  { stroke-dasharray: calc(var(--ARC)*0.60)    var(--C); }
    70%  { stroke-dasharray: calc(var(--ARC)*0.63)    var(--C); }
    82%  { stroke-dasharray: calc(var(--ARC)*0.78)    var(--C); }
    90%  { stroke-dasharray: calc(var(--ARC)*0.82)    var(--C); }
    91%  { stroke-dasharray: calc(var(--ARC)*0.985)   var(--C); } /* late squeeze */
    100% { stroke-dasharray: var(--ARC)               var(--C); }
    }

    /* Jitter (applies while filling) */
    .start-power.is-booting{
    animation: startPowerJitter var(--fill-ms,2000ms) ease-in-out;
    will-change: transform, filter;
    }
    @keyframes startPowerJitter{
    0%   { transform: translate(0,0);           filter: brightness(1); }
    8%   { transform: translate(-1.2px,-0.8px); filter: brightness(1.02); }
    16%  { transform: translate(1.6px,0.4px);   filter: brightness(0.98); }
    24%  { transform: translate(-0.8px,1.2px);  filter: brightness(1.01); }
    36%  { transform: translate(2px,-0.4px);    filter: brightness(0.99); }
    48%  { transform: translate(-1.6px,0.8px);  filter: brightness(1.02); }
    62%  { transform: translate(1.2px,-1.2px);  filter: brightness(0.99); }
    76%  { transform: translate(-1px,0.4px);    filter: brightness(1.01); }
    88%  { transform: translate(0.8px,-0.6px);  filter: brightness(1.00); }
    100% { transform: translate(0,0);           filter: brightness(1); }
    }

    /* Vertical bar (phase 2) */
    .start-power__line{
    stroke: #ffffff;
    stroke-width: 10;
    stroke-linecap: round;
    opacity: 0;
    }
    .start-power.is-filled .start-power__line{
    animation: startPowerLine var(--line-ms,1000ms) ease forwards;
    filter: drop-shadow(0 0 8px rgba(115,115,115,0.65));
    }
    @keyframes startPowerLine{ from{opacity:0} to{opacity:1} }
    </style>



    <!-- MODAL GAUGES PANEL -->
        <style>

            .gauges-button-panel {
            display: flex;            /* vertical stack */
            flex-direction: column;
            align-items: stretch;     /* children take full width */
            position: absolute;
            top: 50%;
            left: 3vh;
            transform: translateY(-50%);
            z-index: 999;

            width: 128px;
            height: 896px;            /* total column height */
            }

            .gauges-panel {
            position: static;
            z-index: 999;

            width: 128px;
            height: 736px;
            background-color: black;
            border-radius: 6px;

            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
            }

            .gauge-block {
            width: 100%;
            text-align: center;
            color: white;
            font-family: sans-serif;
            font-size: 16px;
            font-weight: 500;
            }

            .gauge-icon {
            opacity: 1;
            filter: none;
            mix-blend-mode: normal;
            }

            /* When safety sits to the right of the gauges panel */
            .gauges-button-panel.side-safety .safety-block {
            /* width stays the same; position will be set inline by JS */
            width: 128px;
            }
            .gauges-button-panel.side-safety .kill-all-btn {
            width: 100%;
            }


            /* CSS-only switch: when safety moves to the right, fix parent height */
            @media (max-height: 1024px) {
            .gauges-button-panel {
                height: 736px;                 /* parent becomes 736px tall */
                overflow: visible;             /* allow the side block to overflow */
            }

            .gauges-button-panel .safety-block {
                position: absolute;
                left: calc(100% + 12px);       /* gap to the right of the panel */
                bottom: 0px;                 /* align bottoms: 896 - 736 = 160 */
                margin-top: 0;
                width: 128px;
            }
            }


        </style>

        <!-- Active Helm block -->
        <style>
            /* Active Helm block */
            .active-helm-gauge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px; 
            }

            .active-helm-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            .active-helm-gauge .gauge-label {
            font-family: Inter, sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: #757575;
            line-height: 21px;
            text-align: center;
            }

            .active-helm-gauge .gauge-value {
            font-family: Inter, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: white;
            line-height: 24px;
            text-align: center;
            }
            
        </style>

        <!-- AP Status block -->
        <style>
            /* AP Status block */
            .ap-status-gauge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            }

            .ap-status-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            .ap-status-gauge .gauge-label {
            font-family: Inter, sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: #757575;
            line-height: 21px;
            text-align: center;
            }

            .ap-status-gauge .gauge-value {
            font-family: Inter, sans-serif;
            font-size: 16px;
            font-weight: 500;
            color: white;
            line-height: 24px;
            text-align: center;
            }
        </style>

        <!-- Speed / Avg gauge block -->
        <style>
            .speed-avg-gauge {
            /* --pct controls the white fill width (0%..100%) */
            --pct: 0%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px; /* vertical spacing between rows */
            }

            /* Icon size same as в предыдущих блоках */
            .speed-avg-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            /* Top and bottom text rows */
            .speed-avg-gauge .gauge-line {
            display: inline-flex;
            align-items: baseline;
            gap: 4px;
            color: #ffffff; /* values are white by default */
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            }

            .speed-avg-gauge .value-lg { /* main value */
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            }
            .speed-avg-gauge .unit-lg {
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #757575; /* muted unit */
            }

            /* AVG row style */
            .speed-avg-gauge .gauge-line--small .label {
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            font-size: 12px;
            line-height: 18px;
            font-weight: 700;
            color: #fff;
            }
            .speed-avg-gauge .value-sm {
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            font-size: 12px;
            line-height: 18px;
            font-weight: 700;
            color: #fff;
            }
            .speed-avg-gauge .unit-sm {
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            font-size: 12px;
            line-height: 18px;
            font-weight: 400;
            color: #757575;
            }

            /* Mini gauge bar (0..100%) */
            .speed-avg-gauge .mini-gauge {
            /* Base bar */
            width: 100%;
            max-width: 104px;        /* tweak to your panel width */
            height: 2px;             /* bar height */
            background: #2b2b2b;     /* muted gray base */
            border-radius: 3px;
            overflow: hidden;        /* clip inner fill */
            }

            /* White fill controlled by --pct */
            .speed-avg-gauge .mini-gauge-fill {
            /* Fill grows from left to right */
            width: var(--pct);       /* e.g., 39% */
            height: 100%;
            background: #ffffff;
            border-radius: 3px;      /* keeps rounded cap when near 100% */
            transition: width 180ms ease; /* smooth updates */
            }

        </style>

        <!-- RPM gauge block -->
        <style>
            /* ===== RPM gauge block ===== */
            .rpm-gauge {
            --pct: 0%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            }

            .rpm-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            .rpm-gauge .gauge-line {
            display: inline-flex;
            align-items: baseline;
            gap: 4px;
            color: #ffffff;
            font-family: "Roboto Mono", monospace;
            }

            .rpm-gauge .value-lg {
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            }
            .rpm-gauge .unit-lg {
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #757575;
            }

            /* Mini bar reused from speed gauge */
            .rpm-gauge .mini-gauge {
            width: 100%;
            max-width: 104px;
            height: 2px;
            background: #757575;
            border-radius: 3px;
            overflow: hidden;
            }
            .rpm-gauge .mini-gauge-fill {
            width: var(--pct);
            height: 100%;
            background: #fff;
            border-radius: 3px;
            transition: width 180ms ease;
            }
        </style>

        <!-- Engine Temperature gauge block -->
        <style>
            /* ===== Engine Temperature gauge block ===== */
            .engine-temperature-gauge {
            /* --pct controls fill width (0..100) */
            --pct: 0%;
            /* --bar-color controls the fill color; default is white */
            --bar-color: #ffffff;

            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            }

            .engine-temperature-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            .engine-temperature-gauge .gauge-line {
            display: inline-flex;
            align-items: baseline;
            gap: 4px;
            color: #ffffff;
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            }

            .engine-temperature-gauge .value-lg {
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            }
            .engine-temperature-gauge .unit-lg {
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #757575;
            }

            /* Mini bar */
            .engine-temperature-gauge .mini-gauge {
            width: 100%;
            max-width: 104px;
            height: 2px;
            background: #757575;     /* base track */
            border-radius: 3px;
            overflow: hidden;         /* clip inner fill */
            }

            .engine-temperature-gauge .mini-gauge-fill {
            width: var(--pct);
            height: 100%;
            background: var(--bar-color);
            border-radius: 3px;       /* rounded end near 100% */
            transition: width 180ms ease, background-color 180ms ease;
            }

            /* Optional state colors (use one of these classes on the root block) */
            .engine-temperature-gauge.cold  { --bar-color: #0059FF; } /* cool blue */
            .engine-temperature-gauge.warm  { --bar-color: #FFBD0A; } /* amber */
            .engine-temperature-gauge.hot   { --bar-color: #D0021B; } /* red */

        </style>

        <!-- Battery Voltage Gauge block -->
        <style>
            .battery-voltage-gauge {
            --pct: 0%;               /* controls fill width */
            --bar-color: #ffffff;     /* default bar color */

            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            }

            .battery-voltage-gauge .gauge-icon {
            width: 24px;
            height: 24px;
            }

            /* Text line: muted label + strong value + muted unit */
            .battery-voltage-gauge .battery-line {
            display: inline-flex;
            align-items: baseline;
            gap: 2px;
            text-align: center;
            }

            .label-muted,
            .unit-muted {
            color: #757575;
            font-family: Inter, sans-serif;
            font-size: 16px;
            line-height: 24px;
            font-weight: 500;
            }

            .value-strong {
            color: #ffffff;
            font-family: Inter, sans-serif;
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            }

            /* Mini bar (same logic as RPM/Speed) */
            .battery-voltage-gauge .mini-gauge {
            width: 100%;
            max-width: 104px;
            height: 2px;
            background: #757575;      /* muted gray track */
            border-radius: 3px;
            overflow: hidden;
            }

            .battery-voltage-gauge .mini-gauge-fill {
            width: var(--pct);
            height: 100%;
            background: var(--bar-color);
            border-radius: 3px;
            transition: width 180ms ease;
            }

        </style>

        <!-- Fuel Gauge block -->
        <style>
            .fuel-gauge{
            /* --pct controls the white fill width (0..100%) */
            --pct: 0%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px; /* vertical spacing between rows */
            }

            .fuel-gauge .gauge-icon{
            width: 24px;
            height: 24px;
            }

            /* Top and bottom text rows (values + units) */
            .fuel-gauge .gauge-line{
            display: inline-flex;
            align-items: baseline;
            gap: 4px;
            text-align: center;
            justify-content: center;
            color: #ffffff;
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            }

            .fuel-gauge .value-lg{
            font-size: 16px;
            line-height: 24px;
            font-weight: 700;
            }
            .fuel-gauge .unit-lg{
            font-size: 16px;
            line-height: 24px;
            font-weight: 400;
            color: #757575;
            }

            /* Mini bar like Speed/RPM */
            .fuel-gauge .mini-gauge{
            width: 100%;
            max-width: 104px;      /* keep consistent with other gauges */
            height: 2px;
            background: #757575;   /* base track */
            border-radius: 3px;
            overflow: hidden;
            }
            .fuel-gauge .mini-gauge-fill{
            width: var(--pct);     /* e.g., 37% */
            height: 100%;
            background: #ffffff;   /* fill color */
            border-radius: 3px;
            transition: width 180ms ease;
            }

            /* Burn rate row styling (uses Inter per your mock for mixed text) */
            .fuel-gauge .gauge-line--rate{
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: #757575;        /* muted default */
            }
            .fuel-gauge .value-rate{
            color: #ffffff;
            font-weight: 500;
            font-size: 16px;
            line-height: 24px;
            }
            .fuel-gauge .unit-rate{
            color: #757575;
            font-weight: 500;
            font-size: 16px;
            line-height: 24px;
            }

        </style>


    <!-- KILL ALL BUTTON -->
        <style>

        .safety-block {
        margin-top: auto;
        position: static;
        z-index: auto;

        width: 128px;
        height: 128px;

        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        gap: 4px;  /* optional: spacing between title and button */
        }

        /* Make "Safety" label normal weight */
        .safety-block .drawer-button-title {
        font-weight: 400; /* normal */
        }


        .kill-all-btn {
        width: 128px;
        height: 90px;
        background-color: #FFBD0A;
        border-radius: 6px;

        display: flex;
        flex-direction: column;
        justify-content: space-evenly;

        color: #000000;
        opacity: 0.8;
        font: 800 16px/44px Inter, system-ui, sans-serif; /* vertical centering */
        letter-spacing: .6px;
        text-transform: uppercase;
        text-align: center;
        cursor: pointer;
        }
                    
        .kill-all-btn:hover  { 
        filter: brightness(1.05); 
        opacity: 1;
        }
        .kill-all-btn:active {
        transform: translateY(1px);
        box-shadow: 0 1px 0 rgba(255,255,255,.10) inset, 0 4px 10px rgba(0,0,0,.5);
        }

        </style>


    <!-- MODAL DRAWER PANEL -->

        <!-- Tabs container -->
        <style>
        .drawer-panel {
            position: absolute;
            top: 50%;
            right: 3vh;
            transform: translateY(-50%);
            z-index: 999;

            width: 288px;
            height: 896px;
            background-color: #303030;
            border-radius: 6px;

            display: flex;
            flex-direction: column;
        }

        /* Tabs container (horizontal row) */
        .drawer-tabs {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            padding: 4px 0 0 0;
            background: #252525;
            border-radius: 6px 6px 0 0;
        }

        /* Tab */
        .drawer-tab {
            flex: 1; /* equal width */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px 0;
            cursor: pointer;
            opacity: 0.2;          /* inactive icons 50% */
            color: #757575; /* inactive gray */
            transition: color 0.2s;
        }

        .drawer-tab.active {
            color: #ffffff; /* active white */
            opacity: 1; /* active icon 100% */
            background-color: #303030; /* darker background */
            border-radius: 4px 4px 0 0; /* only top corners rounded */
        }

        /* Icon */
        .drawer-tab .tab-icon {
            width: 24px;
            height: 24px;
            
        }

        .drawer-tab .tab-icon svg {
            width: 100%;
            height: 100%;
        }

        /* Show only the active pane; hide others */
        .drawer-content .tab-pane { 
            display: none; /* hidden by default */
        }
        .drawer-content .tab-pane.active {
            display: block; /* or flex if you prefer */
        }

        /* Inactive tab on hover becomes semi-transparent */
        .drawer-tab:not(.active):hover {
        opacity: 0.5;
        }


        /* Push bottom bars sideways when viewport is short (DevTools-like effect) */
        @media (max-height: 1024px) {
        :root{
            /* width of the drawer side panel + desired gap */
            --drawer-side-clear: 320px; /* ← set to your actual drawer-panel width */
        }

        .status-bar,
        .debug-panel,
        .info-bar {
            /* devtools-like: reserve space on the right side */
            left: 0;                          /* stick to left edge */
            right: var(--drawer-side-clear);  /* leave free space on the right */
            width: auto;                      /* let left/right define width */
            max-width: calc(100vw - var(--drawer-side-clear));
            position: fixed;                  /* if they are fixed already—this line is harmless */
            /* If they are not fixed in your code, remove this line. */
        }
        }



        
        </style>

        <!-- Content -->
        <style>
        /* === Drawer content layout (skeleton) === */
        .drawer-content{
            background:#303030; /* to merge with active tab bg */
            padding:12px;
            color:#fff;
            overflow:auto;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }

        .pane-title{
            /* Title row with optional actions on the right */
            display:flex; align-items:center; justify-content:center;
            margin-bottom:12px;
            font-size:16px; font-weight:600; line-height:24px;
        }
        

        /* Scroll */


        /* Chrome/Safari/Edge */
        .drawer-content::-webkit-scrollbar { width: 8px; }
        .drawer-content::-webkit-scrollbar-track { background: #9b2ca5; }
        .drawer-content::-webkit-scrollbar-thumb { background: #a52c2c; border-radius: 4px; }
        .drawer-content::-webkit-scrollbar-thumb:hover { background: #0c965a; }

        /* Firefox */
        .drawer-content { 
        scrollbar-color: #505050 #303030; /* thumb track */
        scrollbar-width: thin;
        }

        </style>

        <!-- TAB 1: Boat Control -->
        <style>


            /* ===== Communication block (scoped) ===== */

            /* Display container */
            .comm-display{
            display:grid;
            grid-template-columns: 1fr 1px 1fr;  /* two equal halves + divider */
            align-items:center;
            justify-content:space-between;
            gap:16px;
            padding:14px 16px;
            background:#000;
            border-radius:8px;
            }

            /* Single metric cell */
            .comm-metric{
            display:grid;
            grid-template-columns: 1fr 1fr; 
            align-items:center;
            gap:6px;
            font:600 16px/20px Inter, sans-serif;
            color:#fff;
            }
            .comm-metric .display-unit{ color:#9a9a9a; font-weight:500; }

            /* Vertical divider */
            .comm-divider{
            width:1px;
            height:24px;
            background: #757575;
            opacity:1;
            justify-self:center;
            }

            /* Toggle group */
            .comm-toggle{
            margin-top:8px;
            display:flex;
            background:#404040;
            border-radius:8px;
            overflow:hidden;           /* clip inner rounded active */
            }

            /* Toggle buttons */
            .comm-btn{
            flex:1;
            padding:14px 0;
            border:none;
            background:#505050;
            color:#fff;
            font:500 16px/16px Inter, sans-serif;
            cursor:pointer;
            opacity:.5;
            transition:opacity .2s, background .2s;
            }
            .comm-btn:first-child{ border-radius:8px 0 0 8px; }
            .comm-btn:last-child { border-radius:0 8px 8px 0; }

            .comm-btn.active{
            background:#707070;
            opacity:1;
            font-weight:600;
            border-radius:8px;
            }







         /* === SOLO toggle styles (scoped) === */

            /* One block, full width */
            .solo-controls{
            display:block;
            }

            /* Toggle group container */
            .solo-toggle{
            display:flex;
            width:100%;
            background:#404040;
            border-radius:6px;
            overflow:hidden;
            }

            /* Buttons */
            .solo-btn{
            flex:1;
            padding:14px 0;
            border:none;
            background:#404040;
            color:#fff;
            font:500 16px/16px Inter, sans-serif;
            text-align:center;
            cursor:pointer;
            opacity:.5;
            transition:opacity .2s, background .2s;
            }

            /* Endcaps rounding */
            .solo-btn.off{ border-radius:6px; }
            .solo-btn.on { border-radius:6px; }

            /* Active visual */
            .solo-btn.active{
            background:#707070;
            opacity:1;
            font-weight:600;
            border-radius:6px;
            }


            /* === SOLO3 toggle styles (scoped) === */

            /* Container */
            .solo3-controls {
            display: block;
            }

            .solo3-toggle {
            display: flex;
            width: 100%;
            background: #404040;
            border-radius: 6px;
            overflow: hidden;
            }

            /* Buttons */
            .solo3-btn {
            flex: 1;
            padding: 14px 0;
            border: none;
            background: #404040;
            color: #fff;
            font: 500 16px/16px Inter, sans-serif;
            text-align: center;
            cursor: pointer;
            opacity: .5;
            transition: opacity .2s, background .2s;
            }

            /* Endcaps rounding */
            .solo3-btn.off    { border-radius: 6px; }
            .solo3-btn.silent { border-radius: 6px; }          /* middle – no rounding */
            .solo3-btn.on     { border-radius: 6px; }

            /* Active visual */
            .solo3-btn.active {
            background: #707070;
            opacity: 1;
            font-weight: 600;
            border-radius: 6px;
            }


            /* === Pump === */

            /* Horizontal container for two blocks */
            .button-button-row {
            display: grid;          /* Arrange children horizontally */
            flex: 1; 
            grid-template-columns: 1fr 1fr;
            gap: 16px;              /* Space between blocks */
            padding: 10px;
            }


            /* Pump block container */
            .button-button-block {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 0px;
            background: #303030;
            border-radius: 6px;
            color: #fff;
            font-family: Inter, sans-serif;
            }

            .half-relay {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            background: #404040;
            border-radius: 6px;
            overflow: hidden;
            }


            /* === Active Helm & AP status === */

            .middle-drawer-button {
            width: 100%;
            height: 48px;     /* fixed button height */
            padding: 0 16px;

            background: #404040;
            border: none;
            border-radius: 6px;

            /* Flexbox for icon + text */
            display: flex;
            align-items: center;       /* vertical centering relative to the button height */
            justify-content: center;   /* horizontal centering */
            gap: 8px;

            font-family: Inter, sans-serif;
            font-size: 16px;
            letter-spacing: 0.5px;     /* technical look */
            color: #fff;

            cursor: pointer;
            transition: background 0.2s, transform 0.1s, color 0.2s;
            box-sizing: border-box;
            }

            .middle-drawer-button:hover {
            background: #505050;
            font-weight: 600;
            }

            /* Active state highlight */
            .middle-drawer-button.active {
            background: #757575;
            font-weight: 600;
            }


            /* === Active Helm BUTTON / DISPLAY === */


        </style>

        <!-- TAB 2: Payload Control -->
        <style>
            .drawer-display { 
            display: flex;
            justify-content: center;    /* center horizontally */
            align-items: center;        /* align icon and text vertically in the middle */
            gap: 8px;                   /* space between icon and text */
            padding: 14px 16px;
            background: #000;
            border-radius: 6px;
            font-weight: 500;
            font-size: 16px;
            line-height: 1;             /* consistent vertical alignment */
            width: 100%;
            box-sizing: border-box;
            color: #fff;                /* make text visible */
            }

            .drawer-display .display-icon {
            width: 24px;
            height: 24px;
            display: block;             /* prevent inline misalignment */
            }

            /* BUTTONS */

            /* Exactly two items per row, pushed apart inside narrow pane */
            .payload-button-block {
            display: grid;                        /* keep grid */
            grid-template-columns: 1fr 1fr;    /* two fixed columns */
            column-gap: 8px;                      /* must be <= 14px for 254px pane */
            row-gap: 32px;
            justify-content: space-between;
            padding-left: 0;                      /* free space for two 120px items */
            padding-right: 0;
            margin-top: 42px;
            /* keep existing top/bottom padding, background, colors, etc. */
            }

            /* Ensure grid children don't try to be flex containers accidentally */
            .payload-button-block > div {
            display: block;                        /* avoid unexpected flex behavior */
            width: 120px;                          /* match column width */
            }
        </style>
    
        <!-- TAB 2: BUTTONS -->
        <style>

        /* Button positioning (scaled down from original) */
        /* Control block: width locked to button; height auto to fit label lines */
        /* Control wrapper: let it grow to fit label; keep flex layout */
        .control-button {
        position: relative;
        width: 100px;
        height: auto;                 /* was 90px */
        display: flex;                /* keep column flex */
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        }

        /* Outer wrappers: do not cap height so the label doesn't force shrink */
        .button-1,
        .button-2,
        .button-3,
        .button-4,
        .button-5,
        .button-6,
        .button-7,
        .button-8 {
        width: 100px;
        height: auto;                 /* was 90px */
        }

        /* SAFETY CAP ICON SIZE AND STYLING (proportionally reduced) */
        .safety-cap {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;             /* was 110px */
        height: 60px;            /* was 55px */
        background: repeating-linear-gradient(-45deg, #9a7000, #9a7000 12px, black 8px, black 25px);
        border-radius: 6px;      /* was 8px */
        z-index: 200;
        transform-origin: top center;
        transition: transform 0.3s ease-out;
        box-shadow: inset 0 0 0 2px #9a7000, 0 4px 8px rgba(0, 0, 0, 0.4);
        outline: black, 8px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 8px;          /* was 10px */
        color: rgba(0, 0, 0, 0.7);
        font-weight: bold;
        text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.4);
        outline: inset 2px solid #9a7000;
        }


        .safety-cap:hover {
        box-shadow:
            inset 0 0 0 2px #9a7000,
            0 0 10px 2px rgb(90, 90, 90);
        }

        /* Thinner (by ~1/3) yet dense outline via drop-shadows */
        .safety-cap img {
        width: 34px;
        height: 34px;
        filter:
            brightness(0)
            /* orthogonal offsets: 2px -> 1.33px */
            drop-shadow(1.33px 0 0 #9a7000)
            drop-shadow(-1.33px 0 0 #9a7000)
            drop-shadow(0 1.33px 0 #9a7000)
            drop-shadow(0 -1.33px 0 #9a7000)
            /* diagonal offsets: 3px -> 2px */
            drop-shadow(2px 2px 0 #9a7000)
            drop-shadow(-2px 2px 0 #9a7000)
            drop-shadow(2px -2px 0 #9a7000)
            drop-shadow(-2px -2px 0 #9a7000);
        }

        .safety-cap.open {
        /* keeps your existing percentage-based lift */
        transform: translateX(-50%) translateY(var(--shift-amount, -110%));
        opacity: 0.5;
        }

        /* Base button: hard-lock to 100×60 and prevent flex shrink */
        .control-button button {
        width: 100px;
        height: 60px;
        flex: 0 0 60px;               /* do not shrink in column flex */
        box-sizing: border-box;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: rgb(30, 30, 30);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 9px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        z-index: 1;
        position: relative;
        margin-top: 0;
        }

        .button-icon {
        /* same filter; size is controlled by the asset or other rules */
        filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(95%) contrast(92%);
        }

        /* Armed state */
        .control-button button.armed {
        background-color: black;
        box-shadow: none;
        animation: none;
        }
        .control-button button.armed .button-icon {
        filter: 
        brightness(0) saturate(100%) invert(100%) sepia(0%) 
        saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%);
        }

        /* Active state */
        .control-button button.active {
        background-color: rgb(0, 202, 198);
        animation: pulse-button 1.5s infinite;
        }
        .control-button button.active .button-icon {
        filter: brightness(0) saturate(100%) invert(75%) sepia(85%) 
        hue-rotate(40deg) brightness(115%) contrast(105%);
        }
        @keyframes pulse-button {
        0%   { background-color: rgb(213, 21, 191); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3), 0 0 5px rgb(74, 91, 222); }
        50%  { background-color: rgb(219, 28, 175); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3), 0 0 15px rgb(41, 106, 227); }
        100% { background-color: rgb(222, 42, 222); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3), 0 0 5px rgb(240, 85, 29); }
        }

        /* On state */
        .control-button button.on {
        background-color: #2d340f;
        animation: pulse-green 1.5s infinite;
        box-shadow: 0 0 0 0px #2d340f, 0 0 12px #536020;
        }
        @keyframes pulse-green {
        0%   { box-shadow: 0 0 0 2px #2d340f, 0 0 5px #90b400; }
        50%  { box-shadow: 0 0 0 2px #2d340f, 0 0 15px #ccff00; }
        100% { box-shadow: 0 0 0 2px #2d340f, 0 0 5px #90b400; }
        }
        .control-button button.on .button-icon {
        filter: brightness(0) saturate(100%) invert(81%) sepia(98%) saturate(500%) hue-rotate(32deg) brightness(120%) contrast(110%);
        animation: icon-brightness-pulse 1.5s ease-in-out infinite;
        }
        @keyframes icon-brightness-pulse {
        0%, 100% { filter: brightness(0) saturate(55%) invert(81%) sepia(98%) saturate(500%) hue-rotate(32deg) brightness(54%) contrast(110%); }
        50%      { filter: brightness(0) saturate(100%) invert(81%) sepia(98%) saturate(500%) hue-rotate(32deg) brightness(120%) contrast(110%); }
        }

        /* Hover for active states */
        .control-button button.armed:hover,
        .control-button button.active:hover,
        .control-button button.on:hover {
        box-shadow: 0 0 10px 2px rgb(100, 100, 100);
        }

        /* Button label (reduced) */
        .button-label {
        margin-top: 6px;         /* was 8px */
        color: #fff;
        text-align: center;
        font-family: Inter, sans-serif;
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 0.5px;     /* technical look */
        line-height: 18px; /* e.g., 16px for compact but readable lines */

        }


        /* Icon: keep it from affecting button height */
        .button-icon {
        width: 24px;
        height: 24px;
        display: block;               /* remove inline baseline gaps */
        filter: brightness(0) saturate(100%) invert(36%) sepia(0%) saturate(0%)
                hue-rotate(0deg) brightness(95%) contrast(92%);
        }

        /* Normalize base size for all eight buttons (wins over generic button rules) */
        .button-1 .control-button button,
        .button-2 .control-button button,
        .button-3 .control-button button,
        .button-4 .control-button button,
        .button-5 .control-button button,
        .button-6 .control-button button,
        .button-7 .control-button button,
        .button-8 .control-button button {
        width: 100px;
        height: 60px;                 /* was auto */
        flex: 0 0 60px;               /* extra guard against shrinking */
        }




        </style>

        <!-- TAB 3: Engine Status -->
        <style>
            
        /* Display block */
        .status-block {
        display: flex;
        flex-direction: column;
        gap: 8px; /* space between header and controls */
        padding: 10px;
        background: #303030;
        border-radius: 6px;
        color: #fff;
        font-family: Inter, sans-serif;
        }

        /* Header */
        .status-header {
        flex: 1;                      /* take remaining space */
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        font-weight: 500;
        opacity: 0.9;
        white-space: nowrap;          /* prevent title from wrapping */
        overflow: hidden;             /* truncate if too long */
        text-overflow: ellipsis;      /* show ... if truncated */
        }

        .status-title {
        font-size: 14px;
        font-weight: 500;
        line-height: 24px;
        }

        .status-icon {
        font-size: 24px;
        }

        /* Controls row */
        .engine-status-controls {
        display: flex;    /* put header and display in one row */
        align-items: center;
        gap: 10px;        /* space between header and display */
        }

        .status-display {
        width: 80px;                  /* fixed width for display */
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 4px;
        padding: 6px 6px;
        background: #000;
        border-radius: 6px;
        font-weight: 600;
        font-size: 16px;
        line-height: 20px;
        white-space: nowrap;          /* value + unit stay on one line */
        }

        .status-display-value {
        font-size: 16px;
        font-weight: 500;
        color: #fff;
        }

        .status-display-unit {
        font-size: 16px;
        font-weight: 500;
        color: #757575;
        }


        </style>

        <!-- TAB 4: Battery Status -->
        <style>
            .battery-button-block {
            display: flex;
            flex-direction: column;
            gap: 6px; /* space between header and controls */
            padding: 4px;

            }
            /* Container for the section (unchanged) */
            .battery-block {
            gap: 6px;              /* space between items */
            display: flex;
            flex-direction: column;
            padding: 10px;
            background: #303030;
            border-radius: 6px;
            color: #fff;
            font-family: Inter, sans-serif;
            }



            /* TAB 4: Engine Status Ignition, Off | Start, Engine Kill */

            /* Base button */
            .battery-engine-status {
                position: relative;
                height: 48px;
                padding: 0;
                background: #303030;    /* default = state 1 */
                border: none;
                border-radius: 6px;
                display: flex;
                align-items: center;    /* center icon+text vertically */
                justify-content: center;/* center content horizontally */
                gap: 8px;


                font-family: Inter, sans-serif;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.5px;
                color: #fff;

                cursor: pointer;
                transition: background 0.2s, transform 0.1s, color 0.2s;
                box-sizing: border-box;
            }

            /* Hover/pressed */
            /* Blue glow on hover */
            .battery-engine-status:hover {
                background: #808080;
            }

            .battery-engine-status:active { transform: scale(0.98); }


            /* Hide all states by default */
            .battery-engine-status .state-one,
            .battery-engine-status .state-two,
            .battery-engine-status .state-three {
                display: none;
                width: 100%;
                height: 100%;
            }

            /* Show only the state that matches data-state */
            .battery-engine-status[data-state="1"] .state-one   { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                gap: 8px; }

            .battery-engine-status[data-state="2"] .state-two   { 
                display: flex; 
                align-items: center; 
                border-radius: 6px;
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.253);
                justify-content: space-between; }

            .battery-engine-status[data-state="3"] .state-three { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                gap: 8px; }

            /* Split layout (state 2) */
            .battery-engine-status .half {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                height: 100%;
                transition: background 0.2s, transform 0.1s;
                cursor: pointer; /* make it clickable */
            }

            /* Hover effect on halves */
            .battery-engine-status .half:hover {
                background: rgba(255,255,255,0.1);
            }

            /* Hover effect on halves */
            .battery-engine-status .half-off:hover {
                border-radius: 6px 0 0 6px;
            }






            /* !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

            /* On hover of the left half, remove the parent's glow */
            /* Requires :has() support */
            .battery-engine-status[data-state="2"] .state-two {
            transition: box-shadow .2s ease; /* smoother toggle */
            }
            .battery-engine-status[data-state="2"] .state-two:has(.half-off:hover) {
            box-shadow: none; /* hide glow while hovering .half-off */
            }

            /* Your existing hover on the half */
            .battery-engine-status .half-off:hover {
            border-radius: 6px 0 0 6px; /* keep your corner change */
            }










            /* Hover effect on halves */
            .battery-engine-status .half-start:hover {
            border-radius: 0 6px 6px 0;
            }

            /* Pressed effect */
            .battery-engine-status .half:active {
            transform: scale(0.97);
            }


            .battery-engine-status .divider {
            width: 1px;
            height: 24px;
            background: #fff;
            opacity:1;
            }

            /* Icon + label */
            .battery-engine-status .button-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            filter: brightness(0) invert(1);   /* white */
            transition: filter 0.2s;
            }
            .battery-engine-status .battery-engine-label {
            color: #fff;
            transition: color 0.2s;
            }

            /* Ensure label stays white in all states (can be tuned per state if needed) */
            .battery-engine-status[data-state="2"] .battery-engine-label,
            .battery-engine-status[data-state="3"] .battery-engine-label {
            color: #fff;
            }

            /* --- state backgrounds --- */
            .battery-engine-status[data-state="1"] { background:#606060; } /* single (gray) */
            .battery-engine-status[data-state="2"] { background:#909090; } /* split */
            .battery-engine-status[data-state="3"] { background:#bbbbbb;   
                animation: blue-pulse 2.2s ease-in-out infinite; /* smooth, even pulse */
            } 

  
            /* Keyframes: keep color, change blur/intensity slightly */
            @keyframes blue-pulse {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 255, 255, 0.35); } /* base */
            50%      { box-shadow: 0 0 14px rgba(255, 255, 255, 0.75); } /* brighter */
            }

            /* Respect reduced motion */
            @media (prefers-reduced-motion: reduce) {
            .battery-engine-status:hover { animation: none; box-shadow: 0 0 10px rgba(255, 255, 255, 0.55); }
            }


            /* --- hover per state (place AFTER the rules above) --- */
            .battery-engine-status[data-state="1"]:hover { 
            background:#707070;          /* darker gray on hover */
            box-shadow: 0 0 14px rgba(255, 255, 255, 0.15);
            }

            .battery-engine-status[data-state="3"]:hover { 
            background:#909090;          /* slightly darker green on hover */
            }

            /* Ensure label can host an overlay */
            .battery-engine-status .battery-engine-label{
            position: relative;      /* create containing block for ::after */
            display: inline-block;   /* stable overlay box */
            }

            /* On hover: hide original text and show replacement */
            .battery-engine-status[data-state="3"]:hover .battery-engine-label{
            color: transparent;      /* hide original string */
            }
            .battery-engine-status[data-state="3"]:hover .battery-engine-label::after{
            content: "Stop Engine";  /* replacement text */
            position: absolute;
            inset: 0;                /* fill the label box */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #fff;             /* choose text color for green bg */
            pointer-events: none;    /* keep hover on the parent */
            }


            /* pressed is fine to keep generic */
            .battery-engine-status:active { transform: scale(0.98); }




            /* TAB 4: House Relay */

            /* Controls row */
            .relay-controls {
            display: grid;
            grid-template-columns: 3fr 2fr; /* two equal columns */
            gap: 10px;
            }

            /* Toggle buttons */
            .drawer-button-relay {
            display: flex;
            background: #404040;
            border-radius: 6px;
            overflow: hidden;
            }

            .relay-btn {
            flex: 1;
            padding: 14px 0;
            border: none;
            background: #404040;
            color: #fff;
            font-size: 16px;
            line-height: 16px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            opacity: 0.5;
            transition: opacity 0.2s, background 0.2s;
            }

            .relay-btn.off { border-radius: 6px; }
            .relay-btn.on  { border-radius: 6px; }

            .relay-btn.active {
                background: #707070;
                color: #fff;
                opacity: 1;   /* fully opaque */
                font-weight: 600;
                border-radius: 6px;
            }

            /* White live-outline inside the selected button */
            .relay-btn.live {
            /* inner white stroke that doesn't change layout */
            box-shadow: inset 0 0 0 2px #fff;
            /* keep rounded corners of edge buttons */
            border-radius: inherit;
            transition: box-shadow 0.15s ease;
            }

            /* Optional: a bit clearer hover on the trio */
            .drawer-button-relay .relay-btn:hover {
            opacity: 0.8;
            }

        </style>

        <!-- TAB 4: BATTERY LINES -->
        <style>

            /* Anchor & layer */
            .tab-pane[data-tab="4"] .pane-grid { position: relative; }
            #battery-wires{
            position: absolute; inset: 0;
            width: 100%; height: 100%;
            z-index: 5; pointer-events: none; display: block;
            }

            /* Tokens */
            :root{
            --wire-active:   #c8c8c8;  /* light gray */
            --wire-inactive: #505050;  /* dark gray */
            --wire-width:    1;
            --wire-dash:     2 3;
            --wire-back:     8 8; 
            }

            /* State by track */
            #battery-wires .wire-track{ --wire-stroke: var(--wire-inactive); }
            #battery-wires .wire-track.is-active{ --wire-stroke: var(--wire-active); }

            /* Apply stroke once */
            #battery-wires .wire-track line{
            stroke: var(--wire-stroke);
            stroke-width: var(--wire-width);

            vector-effect: non-scaling-stroke;
            }

            /* Variants */
            .wire--dash  line{ stroke-dasharray: var(--wire-dash); }
            .wire--solid line{ stroke-dasharray: var(--wire-back); stroke-width: 2.2;}

            /* ANIMATION */
            /* dashed flow only when the track is active */
            #battery-wires .wire-track.wire--dash.is-active line{
            /* ensure a consistent dash pattern and animate offset */
            stroke-dasharray: 2 3;                  /* one pattern = 5 units */
            animation: wireDash var(--dash-duration, 1.1s) linear infinite;
            }

            #battery-wires .wire-track.wire--solid.is-active line{
            stroke-dasharray: 3 1.75;                  /* one pattern = 5 units */
            animation: wireDash var(--dash-duration, 1.1s) linear infinite; 
            stroke-width: 2.2; 
            }

            /* non-active dashed tracks do not animate */
            #battery-wires .wire-track.wire--dash:not(.is-active) line{
            animation: none;
            }

            /* keyframes: shift by one full pattern length (2+3=5) */
            @keyframes wireDash{
            to { stroke-dashoffset: -5; }           /* negative = flow to the right/down */
            }

        </style>

        <!-- TAB 5: Mission Playlist -->
        <style>
        /* === MISSION CARD === */

        /* Container */
        .mission-card {
        background: #404040;
        border-radius: 8px;
        padding: 12px 14px;
        color: #fff;
        font-family: Inter, sans-serif;
        }
        .mission-card + .mission-card { margin-top: 12px; } /* stack spacing */

        /* Header: title left, icon right */
        .mission-card__header {
        display: flex;            /* title left, icon right */
        align-items: center;
        justify-content: flex-start;/* no space-between */
        margin-bottom: 12px;
        }
        .mission-card__title {
        font-weight: 600;
        font-size: 16px;
        line-height: 1.1;
        letter-spacing: 0.2px;
        }
        .mission-card__icon {
        width: 24px;
        height: 24px;
        display: block;
        opacity: 0.9;
        }
        /* Push the first icon to the right edge; the rest follow it */
        .mission-card__icon:first-of-type {
        margin-left: auto;          /* pushes icon group to the right */
        }

        /* Spacing between adjacent icons on the right */
        .mission-card__icon + .mission-card__icon {
        margin-left: 8px;           /* gap between right-side icons */
        }

        /* List */
        .mission-card__list {
        display: flex;
        flex-direction: column;
        gap: 6px;                 /* vertical spacing between rows */
        }
        .mission-card__item {
        display: grid;            /* icon + text */
        grid-template-columns: 28px 1fr;
        align-items: center;
        column-gap: 8px;
        }
        .mission-card__item-icon {
        width: 24px;
        height: 24px;
        display: block;
        opacity: 0.9;
        }
        .mission-card__item-text {
        font-size: 14px;
        font-weight: 500;
        line-height: 1.5;         /* compact lines */
        color: #fff;
        }



        /* === MISSION PLEER === */

            .mission-pleer-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding-bottom: 12px;
            background: #303030;
            border-radius: 6px;
            color: #fff;
            font-family: Inter, sans-serif;
            }

            .mission-pleer {
            background: #404040;
            border-radius: 8px;
            padding: 8px 14px;
            color: #fff;
            font-family: Inter, sans-serif;
            }



            /* ======= Mission-PLEER styles (scoped) ======= */
            /* Layout of the top line */
            .mission-pleer .mission-meta{
            display:grid;
            grid-template-columns: 1fr auto 1fr;  /* time — title — time */
            gap:12px;
            align-items:center;
            margin-bottom:10px;
            font-variant-numeric: tabular-nums;   /* even monospaced digits */
            }
            .mission-pleer .meta-time{
            color:#fff; opacity:.9; font-weight:600;
            }
            .mission-pleer .meta-time:last-child{ text-align:right; }
            .mission-pleer .meta-title{
            color:#fff; font-weight:600; opacity:.9;
            }



            /* Timeline track */
            .mission-pleer .mission-timeline{ position:relative; margin:6px 0 12px; }
            .mission-pleer .timeline-track{
            position:relative;
            height:4px;
            background:#6a6a6a;
            border-radius:999px;
            }
            /* end caps (light dots) */
            .mission-pleer .timeline-track::before,
            .mission-pleer .timeline-track::after{
            content:""; position:absolute; top:50%; width:8px; height:8px;
            background:#bfbfbf; border-radius:50%; transform:translateY(-50%);
            }
            .mission-pleer .timeline-track::before{ left:-6px; }
            .mission-pleer .timeline-track::after{ right:-6px; }



            /* Waypoints */
            /* Make waypoint labels visible inside the dot */
            .mission-pleer .mission-waypoint{
            position: absolute; top: 50%;
            width: 12px; height: 12px; border-radius: 50%;
            background: #d9d9d9;
            transform: translate(-50%, -50%);
            box-shadow: inset 0 0 0 2px #404040;

            /* center the text and make it readable */
            display: flex;                    /* center label horizontally/vertically */
            align-items: center;
            justify-content: center;
            font: 700 10px/12px Inter, system-ui, sans-serif; /* tight line height */
            }
            /* Reserve space under the track for labels */
            .mission-pleer .mission-timeline { padding-bottom: 12px; } /* 8px dot + 15px gap ~ 22px */

            /* Waypoint label 15px below the dot */
            .mission-pleer .mission-waypoint[data-label]::after{
            content: attr(data-label);         /* take text from data-label */
            position: absolute;
            top: calc(100% + 5px);            /* 15px under the bottom of the dot */
            left: 50%;
            transform: translateX(-50%);
            font: 500 12px/1 Inter, system-ui, sans-serif; /* compact line height */
            color: #ffffff;
            white-space: nowrap;
            pointer-events: none;              /* label doesn't catch hover/clicks */
            z-index: 2;
            }

            /* Keep cursor above labels if they overlap */
            .mission-pleer .mission-cursor { z-index: 3; }


            /* Yellow cursor */
            .mission-pleer .mission-cursor{
            position:absolute; top:50%;
            width:16px; height:16px; border-radius:50%;
            transform:translate(-50%,-50%);
            box-shadow: inset 0 0 0 2px #ffffff;
            background:transparent;
            transition:left .22s ease;
            pointer-events:none;
            }




            /* Controls row */
            .mission-pleer .mission-controls{
            display:grid;
            grid-template-columns: auto 1fr auto;
            align-items:center;
            gap:12px;
            margin-top:8px;
            }
            .mission-pleer .pleer-buttons { display:flex; gap:4px; }
            .mission-pleer .pleer-data{
            margin-left:auto;
            text-align:right;
            display:flex; flex-direction:column; gap:0px;
            color:#bfbfbf;
            }

            .mission-pleer .pleer-btn{
            height:28px; min-width:28px;
            display:inline-flex; align-items:center; justify-content:center;
            background:#2e2e2e; color:#fff; border:0px solid #5a5a5a;
            border-radius:6px; cursor:pointer;
            transition:filter .12s ease, transform .04s ease;
            }
            .mission-pleer .pleer-btn:hover{ filter:brightness(1.08); }
            .mission-pleer .pleer-btn:active{ transform:translateY(1px); }
            .mission-pleer .pleer-btn[disabled]{ opacity:.4; cursor:default; }




            /* ======= PLEER DATA styles ======= */

            .mission-name{
            /* small caps look */
            font-family: Inter, system-ui, sans-serif;
            font-weight: 500;
            font-size: 14px;
            letter-spacing: 0.4px;   /* tech look */
            color: #858585;        /* muted gray */
            text-align: center;     /* center the text itself */
            line-height: 1.1; /* tighter lines; try 1, 1.2 or a fixed 16px */
            }
            .mission-value {
            font-family: Inter, system-ui, sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: #ffffff;  /* brighter than unit */
            }


            .pleer-data-item {
            display: inline-flex;     /* single row */
            align-items: center;      /* vertical centering */
            gap: 4px;                 /* spacing between icon and text */
            height: 20px;             /* = icon box height */
            white-space: nowrap;      /* prevent wrapping that causes jumps */
            }

            .pleer-data-name {
            /* small caps look */
            font-family: Inter, system-ui, sans-serif;
            font-weight: 500;
            font-size: 12px;
            letter-spacing: 0.6px;   /* tech look */
            color: #858585;        /* muted gray */
            }

            /* Value text (e.g., "Locked") */
            .pleer-data-value {
            font-family: Inter, system-ui, sans-serif;
            font-weight: 600;
            font-size: 12px;
            color: #ffffff;  /* brighter than unit */
            }

            .pleer-data-unit {
            /* small caps look */
            font-family: Inter, system-ui, sans-serif;
            font-weight: 500;
            font-size: 12px;
            letter-spacing: 0.6px;   /* tech look */
            color: #858585;        /* muted gray */
            }





        </style>

        <!-- TAB 6: Safety -->
        <style>
        .drawer-button-display.fullwidth {
        display: flex;
        justify-content: center;    /* center content horizontally */
        align-items: center;
        gap: 4px;
        padding: 14px 16px;
        background: #000;
        border-radius: 6px;
        font-weight: 500;
        font-size: 16px;
        line-height: 20px;
        width: 100%;                /* stretch to full width */
        box-sizing: border-box;      /* include padding in width */
        }

        .button-block {
        display: flex;
        flex-direction: column;
        gap: 8px; /* space between header and controls */
        padding: 10px;
        background: #303030;
        border-radius: 6px;
        color: #fff;
        font-family: Inter, sans-serif;
        }

        .big-drawer-button {
        width: 100%;
        height: 48px;               /* fixed button height */
        padding: 0;              /* remove extra padding */

        background: #707070;
        border: none;
        border-radius: 6px;

        /* Flexbox for icon + text */
        display: flex;
        align-items: center;       /* vertical centering relative to the button height */
        justify-content: center;   /* horizontal centering */
        gap: 8px;

        font-family: Inter, sans-serif;
        font-size: 16px;
        font-weight: 600;
        letter-spacing: 0.5px;     /* technical look */
        color: #fff;

        cursor: pointer;
        transition: background 0.2s, transform 0.1s, color 0.2s;
        box-sizing: border-box;
        }

        .big-drawer-button .button-icon {
        width: 24px;
        height: 24px;
        align-self: center; 
        flex-shrink: 0;
        filter: brightness(0) invert(1);
        transition: filter 0.2s;
        }

        .big-drawer-button .button-drawer-label {
        color: #fff;
        transition: color 0.2s;
        display: inline-block;    /* behaves well with flex parent */
        }



        /* Hover */
        .big-drawer-button.active:hover {
        background: #555555;
        }

        .big-drawer-button:hover {
        background: #808080;
        }

        /* Pressed */
        .big-drawer-button:active {
        transform: scale(0.98);
        }

        /* Active state */
        .big-drawer-button.active {
        background: #505050;
        }

        .big-drawer-button.active .button-drawer-label {
        color: #757575; /* gray text */
        }

        .big-drawer-button.active .button-icon {
        filter: brightness(0) saturate(100%) invert(46%) sepia(0%) saturate(0%) hue-rotate(181deg) brightness(95%) contrast(90%);
        }


        </style>

        <!-- TAB 7: Assets -->
        <style>
       
        .pane-grid{
            /* Responsive grid for small info cards */
            display:grid; grid-template-columns: 1fr; gap:4px;
        }
        .pane-card .card-title{ 
            font-size:14px; font-weight:600; margin-bottom:6px; opacity:.9; 
        }
        .pane-card .card-row{ font-size:14px; line-height:18px; display:flex; 
            justify-content:space-between; gap:8px; opacity:.9; 
        }
        /* === Assets list === */
        .assets-list{
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        /* Single asset card */
        .asset-card{
            background: #404040;
            border: 1px solid #404040;
            border-radius: 4px;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        /* Parent: two columns (left info / right metrics) */
        .asset-main {
            display: grid;
            grid-template-columns: 1fr auto; /* left grows, right autosize */
            column-gap: 12px;
            /* shared row heights for both inner grids */
            --row1: 24px; /* title line */
            --row2: 16px; /* subtitle line */
        }
        .asset-icon {
            grid-column: 1;
            grid-row: 1 / span 2;                    /* icon spans both rows */
            width: 24px;
            height: 24px;
        }

        .asset-texts {
            grid-column: 2;
            grid-row: 1 / span 2;                    /* text column also spans both */
            display: grid;
            grid-template-rows: var(--row1) var(--row2);
        }

        .asset-title {
            grid-row: 1;                              /* first row */
            line-height: var(--row1);
        }

        .asset-sub {
            grid-row: 2;                              /* second row */
            line-height: var(--row2);
        }

        /* Right block: two metrics stacked with the same row heights */
        .asset-meta {
            display: grid;
            grid-template-rows: var(--row1) var(--row2);
            row-gap: 0;                               /* exact alignment with left side */
            justify-items: end;                       /* align metrics to the right */
        }

        /* Explicit row mapping (optional but clear) */
        .asset-meta .metric:nth-child(1) { 
            grid-row: 1; /* aligns with title */
        } 
        /* Left block: icon + two text lines aligned to the same row heights */
        .asset-info {
            display: grid;
            grid-template-columns: 24px auto;        /* icon + text column */
            grid-template-rows: var(--row1) var(--row2);
            column-gap: 8px;
            align-items: center;
        }
        .metric{
            display: inline-flex; align-items: center; gap: 6px;
            color: #fff;
            font: 600 16px/16px Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            white-space: nowrap;
        }
        .metric .m-icon{
            width: 24px; height: 24px;
            color: #fff;

        }
        .metric .unit{
            font: 500 16px/16px Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: #fff;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        /* --- ASSETS: ensure cards remain visible --- */
        .pane-card {
            /* Card surface + spacing */
            background: #404040;            /* visible against #303030 panel */
            border: 1px solid #404040;      /* make border visible (was #404040 on #404040) */
            border-radius: 6px;
            padding: 6px 10px 6px 10px ;
            margin-bottom: 2px;             /* stack multiple cards */
            color: #fff;                    /* readable text */
        }

        /* Parent layout: two columns (left info / right metrics) */
        .pane-card .asset-main {
            display: grid;
            grid-template-columns: 1fr auto;   /* left grows, right autosize */
            column-gap: 12px;
            /* shared row heights for perfect alignment */
            --row1: 24px; /* title line height */
            --row2: 16px; /* subtitle line height */
        }

        /* Left block: icon + two text lines aligned to shared rows */
        .pane-card .asset-info {
            display: grid;
            grid-template-columns: 24px auto;  /* icon + text column */
            grid-template-rows: var(--row1) var(--row2);
            column-gap: 8px;
            align-items: center;
        }

        .pane-card .asset-icon {
            grid-column: 1;
            grid-row: 1 / span 2;              /* icon spans both rows */
            width: 24px;
            height: 24px;
            opacity:1;
        }

        .pane-card .asset-texts {
            grid-column: 2;
            grid-row: 1 / span 2;
            display: grid;
            grid-template-rows: var(--row1) var(--row2);
        }

        .pane-card .asset-title {
            grid-row: 1;
            font: 600 16px/24px Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .pane-card .asset-sub {
            grid-row: 2;
            font: 500 12px/16px Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: #757575;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* Right block: two metrics aligned to the same two rows */
        .pane-card .asset-meta {
            display: grid;
            grid-template-rows: var(--row1) var(--row2);
            justify-items: start;               /* align metrics to the left edge */
            row-gap: 0;                       /* exact row alignment with the left side */
        }

        .pane-card .asset-meta .metric:nth-child(1) { grid-row: 1; } /* with title */
        .pane-card .asset-meta .metric:nth-child(2) { grid-row: 2; } /* with subtitle */

        .pane-card .metric {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font: 600 16px/18px Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            color: #fff;
        }

        .pane-card .metric .m-icon {
            width: 24px; height: 24px;
        }

        .pane-card .metric .unit {
            color: #757575; font-weight: 500;
        }

        </style>

        <!-- TAB 8: Sensors -->
        <style>
        /* Sensor block container */
        .drawer-button-block {
        display: flex;
        flex-direction: column;
        gap: 8px; /* space between header and controls */
        padding: 10px;
        background: #303030;
        border-radius: 6px;
        color: #fff;
        font-family: Inter, sans-serif;
        }

        /* Header */
        .drawer-button-header {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        font-weight: 500;
        opacity: 0.9;
        }

        .drawer-button-title {
        font-size: 16px;
        font-weight: 500;
        line-height: 24px;
        }

        .drawer-button-icon {
        font-size: 24px;
        }

        /* Controls row */
        .sensor-controls {
        display: grid;
        grid-template-columns: 3fr 2fr; /* two equal columns */
        gap: 10px;
        }

        /* Toggle buttons */
        .drawer-button-toggle {
        display: flex;
        background: #404040;
        border-radius: 6px;
        overflow: hidden;
        }

        .toggle-btn {
        flex: 1;
        padding: 14px 0;
        border: none;
        background: #404040;
        color: #fff;
        font-size: 16px;
        line-height: 16px;
        font-weight: 500;
        cursor: pointer;
        text-align: center;
        opacity: 0.5;
        transition: opacity 0.2s, background 0.2s;
        }

        .toggle-btn.off { border-radius: 6px; }
        .toggle-btn.on  { border-radius: 6px; }

        .toggle-btn.active {
            background: #707070;
            color: #fff;
            opacity: 1;   /* fully opaque */
            font-weight: 600;
        }

        /* Display block */
        .drawer-button-display {
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 4px;
        padding: 14px 14px;
        background: #000;
        border-radius: 6px;
        font-weight: 600;
        font-size: 16px;
        line-height: 20px;
        font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;

        }

        .display-value {
        font-size: 16px;
        font-weight: 500;
        color: #fff;
        }

        .display-unit {
        font-size: 16px;
        font-weight: 500;
        color: #757575;
        }


        </style>


    <!-- MODAL ACTIVE HELM PANEL -->
    <style>
        .helm-display {
        display: flex;
        align-items: baseline;
        justify-content: center;
        gap: 4px;
        padding: 14px 16px;
        background: #000;
        border-radius: 6px;
        font-size: 16px;
        line-height: 20px;
        }

        .helm-display-value {
        font-size: 16px;
        font-weight: 500;
        color: #757575;
        }
    

    </style>

    <!-- MODAL AUTO PILOT PANEL -->
    <style>

        .status-modal {
        width: 170px;
        display: none;
        position: fixed;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: #353535;
        border-radius: 6px;
        padding: 20px;
        z-index: 1000;
        }

        .status-modal-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        }

        .status-modal-header {
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-size: 16px;
        font-weight: 600;
        }


        .ap-mode-btn {
        width: 100%;
        height: 48px;     /* fixed button height */
        padding: 0;       /* remove extra padding */

        background: #404040;
        border: none;
        border-radius: 6px;

        /* Flexbox for icon + text */
        display: flex;
        align-items: center;       /* vertical centering relative to the button height */
        justify-content: center;   /* horizontal centering */
        gap: 8px;

        font-family: Inter, sans-serif;
        font-size: 16px;
        font-weight: 500;
        letter-spacing: 0.5px;     /* technical look */
        color: #757575;

        cursor: pointer;
        transition: background 0.2s, transform 0.1s, color 0.2s;
        box-sizing: border-box;
        }

        .ap-mode-btn:hover {
        background: #505050;
        color: #fff;
        }
        .ap-mode-btn.active {
        font-weight: 600;
        color: #fff;
        background: #454545;

        }



        /* Modifier when a modal is docked to the drawer */
        .status-modal.is-docked{
        position: fixed;
        transform: none;         /* kill 50/50 centering transform */
        top: auto;               /* we control bottom via JS */
        /* left/right/bottom are set inline via JS */
        max-width: min(560px, 42vw); /* tune as you like */
        overflow: auto;          /* clip if taller than drawer */
        z-index: 10000;
        }

    </style>



    <!-- MAGENTA / ERROR / BORDER -->
    <style>

    * {
    outline: 1px dashed rgba(181, 90, 169, 0.01);
    
    }

    </style>





</head>



<body>
    <div class="control-screen">
        <!-- INFO BAR -->
        <div class="info-bar">

            <div class="info-item">
                <span class="info-icon" aria-hidden="true"><img src="images/time-icon.svg" alt=""></span>
                <span class="info-value">00:00:00</span>
                <span class="info-unit">UTC</span>
            </div>


            <div class="info-item info-item--center">
                &nbsp; &nbsp; &nbsp; <!-- SPASE -->

                <span class="alarm-icon" aria-hidden="true"><img src="images/engine.svg" alt=""></span>
                    &nbsp; <!-- space -->
                <span class="info-icon" aria-hidden="true"><img src="images/joystick-icon.svg" alt=""></span>
                    &nbsp; <!-- space -->
                <span class="info-icon" aria-hidden="true"><img src="images/comp-icon.svg" alt=""></span>
                    &nbsp; <!-- space -->

                    <!-- inactive -->
                <span class="alarm-icon" aria-hidden="true"><img src="images/fuel.svg" alt=""></span>
                    &nbsp; <!-- space -->
                    <!-- active -->
                <span class="alarm-icon is-active" aria-hidden="true"><img src="images/propeller.svg" alt=""></span>
                    &nbsp; <!-- space -->
                <span class="alarm-icon" aria-hidden="true"><img src="images/oil-tempriture.svg" alt=""></span>
                    &nbsp; <!-- space -->
                <span class="alarm-icon" aria-hidden="true"><img src="images/oil-pressure.svg" alt=""></span>
                
                &nbsp; &nbsp; &nbsp; <!-- SPASE -->
            </div>



            <div class="info-item">

                <div class="info-item">
                    <span class="info-icon" aria-hidden="true"><img src="images/satellite.svg" alt=""></span>
                    <span class="info-value">32</span>
                </div>

                &nbsp; &nbsp; &nbsp;         <!-- SPASE -->

                <span class="info-icon" aria-hidden="true"><img src="images/coordinates-icon.svg" alt=""></span>

                <span class="info-unit">LAT</span>
                <span class="info-value">0.000000</span>
                &nbsp;         <!-- SPASE -->
                <span class="info-unit">LNG</span>
                <span class="info-value">0.000000</span>
            </div>

        </div>

        
        <!-- HEADER -->
        <header id="header">
            <div class="header-inner">
                <button class="nav-arrow left" id="prev-screen">◀</button>
                <div class="carousel-titles">
                    <div class="carousel-title active" data-screen="1">Kilo #06</div>
                    <div class="carousel-title" data-screen="2">Kilo #14</div>
                    <div class="carousel-title" data-screen="3">Kilo #22</div>
                </div>
                <button class="nav-arrow right" id="next-screen">▶</button>
            </div>
        </header>

        <!-- MAIN -->
        <main id="main">
            <!-- Main content area -->
            <div class="main-content">

                <!-- Screen 1: Boat Control -->
                <div class="screen active" id="screen-1">          
                    <main class="screen-main">

                    </main>
                </div>

                <!-- Screen 2: Payload Release -->
                <div class="screen" id="screen-2">
                    <main class="screen-main">

                    </main>
                </div>

                <!-- Screen 3: AUX Functions -->
                <div class="screen" id="screen-3">
                    <main class="screen-main">
                        
                    </main>
                </div>

            </div>

        </main>


        <!-- FOOTER -->
        <footer id="footer">
            <!-- Screen indicator dots -->
            <div class="screen-indicator">
                <div class="indicator-dot active" data-screen="1"></div>
                <div class="indicator-dot" data-screen="2"></div>
                <div class="indicator-dot" data-screen="3"></div>
            </div>
            <!-- Status bar -->
            <div class="status-bar" id="status-bar">
                <div class="status-content">
                    <div class="connection-indicator" id="connection-indicator"></div>
                    <div class="status-text">Kilo #2 ↗️ 48° 10m/s [00:00:00] Buoy Release Safety Designated</div>
                </div>
            </div>
            <!-- Debug panel -->
            <div class="debug-panel" id="debug-panel">
                <div class="debug-content">
                    <div class="debug-box">
                        <h3>Controller Heartbeat</h3>
                        <pre id="controller-heartbeat">Waiting for data...</pre>
                    </div>
                    <div class="debug-box">
                        <h3>Device Heartbeats</h3>
                        <pre id="device-heartbeats">Waiting for data...</pre>
                    </div>
                    <div class="debug-box">
                        <h3>Options</h3>
                        <pre id="options-panel">No options set</pre>
                        <div class="options-icons">
                            <img alt="Settings" class="options-icon" src="images/edit.svg"/>
                            <img alt="Timer" class="options-icon" src="images/exit.svg"/>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!-- BOAT & MODAL RUDDER -->
        <div class="rudder-wrapper">
            <!-- BOAT -->
            <img class="boat-image" onclick="openTrimModal()" src="images/kilo.svg" style="cursor: pointer;"/>

            <!-- Rudder Angle Indicator -->
            <div class="rudder-gauge">
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    viewBox="70 60 150 60" 
                    preserveAspectRatio="xMidYMid meet"
                >
                    <g fill="none" font-family="sans-serif" font-size="6" stroke-width="1" text-anchor="middle">
                    <line stroke="#d32828" stroke-linecap="round" x1="88.9" x2="99.2" y1="78.6" y2="63.8" />
                    <text fill="#757575" x="84.8" y="87.5">35</text>
                    <line stroke="#d32828" x1="96.0" x2="105.0" y1="83.2" y2="67.6" />
                    <text fill="#757575" x="92.4" y="92.4">30</text>
                    <line stroke="#d32828" x1="103.4" x2="111.0" y1="87.0" y2="70.7" />
                    <text fill="#757575" x="100.4" y="96.5">25</text>
                    <line stroke="#d32828" x1="111.1" x2="117.4" y1="90.2" y2="73.3" />
                    <text fill="#757575" x="108.7" y="100.0">20</text>
                    <line stroke="#d32828" x1="119.2" x2="123.8" y1="92.8" y2="75.4" />
                    <text fill="#757575" x="117.2" y="102.7">15</text>
                    <line stroke="#d32828" x1="127.3" x2="130.4" y1="94.6" y2="76.8" />
                    <text fill="#757575" x="126.1" y="104.6">10</text>
                    <line stroke="#d32828" x1="135.6" x2="137.2" y1="95.6" y2="77.8" />
                    <text fill="#757575" x="135.0" y="105.8">5</text>
                    <line stroke="#ffffff" x1="144.0" x2="144.0" y1="96.0" y2="78.0" />
                    <text fill="#757575" x="144.0" y="106.2">0</text>
                    <line stroke="#00c800" x1="152.4" x2="150.8" y1="95.6" y2="77.8" />
                    <text fill="#757575" x="153.0" y="105.8">5</text>
                    <line stroke="#00c800" x1="160.7" x2="157.6" y1="94.6" y2="76.8" />
                    <text fill="#757575" x="161.9" y="104.6">10</text>
                    <line stroke="#00c800" x1="169.0" x2="164.2" y1="92.8" y2="75.4" />
                    <text fill="#757575" x="171.0" y="102.7">15</text>
                    <line stroke="#00c800" x1="176.9" x2="170.6" y1="90.2" y2="73.3" />
                    <text fill="#757575" x="179.3" y="100.0">20</text>
                    <line stroke="#00c800" x1="184.6" x2="177.0" y1="87.0" y2="70.7" />
                    <text fill="#757575" x="187.6" y="96.5">25</text>
                    <line stroke="#00c800" x1="192.0" x2="183.0" y1="83.2" y2="67.6" />
                    <text fill="#757575" x="195.6" y="92.4">30</text>
                    <line stroke="#00c800" x1="199.1" x2="188.8" y1="78.6" y2="63.8" />
                    <text fill="#757575" x="203.2" y="87.5">35</text>
                    </g>

                    <text fill="#757575" font-size="6.6" font-weight="bold" x="80" y="114">PORT</text>
                    <text fill="#757575" font-size="6.6" font-weight="bold" x="190" y="114">STBD</text>

                    <g id="rudder-pointer" transform="rotate(0, 144, 40)">
                    <line x1="144" y1="50" x2="144" y2="95" stroke="#ffffff" stroke-linecap="round" stroke-width="2.5" />
                    </g>
                </svg>
            </div>

            <!-- Rudder Angle INPUT -->
            <div class="rudder-input-control">
            <label for="rudder-input">Rudder Angle:</label>
            <input
                type="number"
                id="rudder-input"
                min="-35"
                max="35"
                value="0"
                onchange="updateRudderFromInput()"
            />
            <span>°</span>
            </div>
            
            <!-- BOAT // Rudder & Trim GAUGE row -->
            <div class="boat-stats-row">
                
                <!-- Left: Rudder Angle -->
                <div class="boat-stat" id="boat-rudder-stat" aria-label="Rudder angle">
                    <span class="boat-stat__icon" aria-hidden="true">
                        <img src="images/rudder-icon.svg" alt="" class="boat-icon">
                    </span>
                    <span class="boat-stat__value">
                        <span id="rudder-angle-value">0</span><span class="deg">°</span>
                    </span>
                </div>

                <!-- Right: Trim --> 
                <div class="boat-stat" id="boat-trim-stat" aria-label="Trim">
                <span class="boat-stat__icon" aria-hidden="true">
                    <img src="images/trim.svg" alt="" class="boat-icon">
                </span>
                <span class="boat-stat__value">
                    <span id="trim-value">0</span><span class="deg">°</span>
                </span>
                </div>

            </div>

            
            <!-- MODAL THROTTLE -->
            <div class="throttle-wrapper">

                <!-- Throttle Up Button -->
                <button class="throttle-button throttle-up">
                    <span class="throttle-icon">▲</span>
                </button>

                    <div class="mini-gear-toggle">
                        <div class="gear-track">

                

                            <!-- Forward label -->
                            <div class="forward-button">
                                <span class="text-f">F</span>
                                <span class="text-forward">FORWARD</span>
                            </div>

                            <!-- Fill and thumb -->
                            <div class="gear-fill" id="gear-fill"></div>
                            <div class="gear-thumb">
                                <span class="gear-thumb-text">
                                    <span class="text-n">N</span>
                                    <span class="text-neutral">NEUTRAL</span>
                                </span>
                            </div>


                            <!-- Neutral label -->
                            <div class="neutral-button">
                                <span class="text-n">N</span>
                                <span class="text-neutral">NEUTRAL</span>
                            </div>

                            <!-- Reverse label -->
                            <div class="reverse-button">
                                <span class="text-r">R</span>
                                <span class="text-reverse">REVERSE</span>
                            </div>
                        </div>
                    </div>

                <!-- Throttle Down Button -->
                <button class="throttle-button throttle-down">
                    <span class="throttle-icon">▼</span>
                </button>
            </div>


        </div>

        <!-- TRIM MODAL -->
        <!-- To close an editor -->
        <div class="modal-backdrop" id="modal-backdrop" style="display: none;"></div>
        <div id="edit-modal-container" style="display: none;"></div>

        <!-- TRIM MODAL -->
        <div class="modal-backdrop" id="trim-modal-backdrop" style="display: none;"></div>
        <div id="trim-modal-container" style="display: none;">
            <div class="editor-modal-backdrop">

                <div class="editor-modal-window">
                    <h2 class="editor-modal-title">Trim Control</h2>
                    <div class="editor-modal-close" onclick="applyTrimSettings()">✕</div>


                    <!-- TRIM MODAL Background image -->
                    <div class="trim-image-wrapper">
                    <img alt="KILO" class="trim-center-image" src="images/kilo-half-side.svg"/>

                        <!-- Overlay for gauge marks -->
                        <div class="trim-gauge-overlay">
                        <svg height="100%" id="trim-gauge-svg" viewbox="0 0 300 300" width="100%"></svg>
                        </div>

                        <!-- Rotating arrow -->
                        <div class="trim-pointer">
                        <img alt="Pointer" class="trim-pointer-img" src="images/oxe300.svg"/>
                        </div>
                        <!-- Slider -->
                        <div class="trim-slider-overlay">

                            <div class="trim-labels">
                                                                —<br/><br/><br/><br/><br/><br/><br/>
                                                                15<br/>14<br/>13<br/>12<br/>11<br/>10<br/>9<br/>8<br/>7<br/>6<br/>5<br/>4<br/>3<br/>2<br/>1<br/>0<br/><br/>
                            </div>

                            <div class="trim-track-bg"></div>
                            <div class="trim-track-fill" id="trim-fill"></div>
                            <div class="trim-thumb" id="trim-thumb"></div>

                            <!-- READOUT -->
                            <div class="trim-readout" id="trim-readout">1</div>
                            <div class="trim-slider-wrapper">
                            </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- HUGE SIGN -->
        <div id="throttle-indicator">
            <span class="throttle-char"></span>
        </div>

        <!-- ANIMATION LOAD ENGINE -->
        <!-- START-LOADER Overlay (future animation mountpoint) -->
        <div id="start-loader" aria-hidden="true">
            <div class="loader-slot" role="img" aria-label="Starting…">STARTING…</div>
        </div>


        <!-- MODAL GAUGES PANEL -->
        <div class="gauges-button-panel">
  
            <div class="gauges-panel">

                <!-- Active Helm Gauge -->
                <div class="active-helm-gauge gauge-block">
                    <div class="active-helm-gauge gauge-block">
                        <img src="images/helm-icon.svg" alt="Rudder Icon" class="gauge-icon">
                        <div class="gauge-label">Active Helm</div>
                        <div class="gauge-value">Main</div>
                    </div>
                </div>

                <!-- AP Status Gauge -->
                <div class="ap-status-gauge gauge-block">
                    <div class="ap-status-gauge gauge-block">
                    <img src="images/autopilot-icon.svg" alt="AP Status Icon" class="gauge-icon">
                    <div class="gauge-label">AP status</div>
                    <div class="gauge-value">Mission</div>
                    </div>
                </div>

                <!-- Speed / Avg Gauge -->
                <div class="speed-avg-gauge gauge-block">
                    <div class="speed-avg-gauge gauge-block" style="--pct: 39%;">
                        <!-- icon -->
                        <img src="images/speed.svg" alt="Speed Icon" class="gauge-icon">

                        <!-- value line -->
                        <div class="gauge-line">
                            <span class="value value-lg">38.6</span>
                            <span class=""> km/h</span>
                        </div>

                        <!-- mini gauge bar -->
                        <div class="mini-gauge" role="img" aria-label="Speed level">
                            <div class="mini-gauge-fill"></div>
                        </div>

                        <!-- avg line -->
                        <div class="gauge-line gauge-line--small">
                            <span class="label">AVG&nbsp;</span>
                            <span class="value value-sm">38.6</span>
                            <span class="unit unit-sm"> km/h</span>
                        </div>
                    </div>
                </div>

                <!-- RPM Gauge block -->
                <div class="rpm-gauge gauge-block">
                    <div class="rpm-gauge gauge-block" style="--pct: 64%;">
                        <!-- icon -->
                        <img src="images/rpm-icon.svg" alt="RPM Icon" class="gauge-icon">

                        <!-- value line -->
                        <div class="gauge-line">
                            <span class="value value-lg">3.200</span>
                            <span class="unit unit-lg"> RPM</span>
                        </div>

                        <!-- mini gauge bar -->
                        <div class="mini-gauge" role="img" aria-label="RPM level">
                            <div class="mini-gauge-fill"></div>
                        </div>
                    </div>

                </div>

                <!-- Engine Temperature Gauge -->
                <div class="engine-temperature-gauge gauge-block">
                    <div class="engine-temperature-gauge gauge-block hot" style="--pct: 72%;">
                        <!-- icon -->
                        <img src="images/engine.svg" alt="Engine Temperature Icon" class="gauge-icon">

                        <!-- value line -->
                        <div class="gauge-line">
                            <span class="value value-lg">134</span>
                            <span class="unit unit-lg">ºC</span>
                        </div>

                        <!-- mini gauge bar -->
                        <div class="mini-gauge" role="img" aria-label="Engine temperature level">
                            <div class="mini-gauge-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- Battery Voltage Gauge block -->
                <div class="battery-voltage-gauge gauge-block">
                    <!-- Battery Voltage Gauge (with mini bar) -->
                    <div class="battery-voltage-gauge gauge-block" style="--pct: 64%;">
                        <!-- icon -->
                        <img src="images/battery.svg" alt="Battery Icon" class="gauge-icon">

                        <!-- value line -->
                        <div class="gauge-line">
                            <span class="label-muted">Start&nbsp;</span>
                            <span class="value-strong js-voltage">11.2</span>
                            <span class="unit-muted">&nbsp;v</span>
                        </div>

                        <!-- mini gauge bar -->
                        <div class="mini-gauge" role="img" aria-label="Battery level">
                            <div class="mini-gauge-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- Fuel Gauge block -->
                <div class="fuel-gauge gauge-block">
                    <!-- Fuel Gauge (like Speed) -->
                    <div class="fuel-gauge gauge-block" style="--pct: 37%;">
                        <!-- icon -->
                        <img src="images/fuel.svg" alt="Fuel Icon" class="gauge-icon">

                        <!-- main value (gallons) -->
                        <div class="gauge-line">
                            <span class="value value-lg">12.23</span>
                            <span class="unit unit-lg"> gal</span>
                        </div>

                        <!-- mini gauge bar: level 0..100% -->
                        <div class="mini-gauge" role="img" aria-label="Fuel level">
                            <div class="mini-gauge-fill"></div>
                        </div>

                        <!-- burn rate -->
                        <div class="gauge-line gauge-line--rate">
                            <span class="value-rate">3.5</span>
                            <span class="unit-rate">&nbsp;G/Hr</span>
                        </div>
                    </div>
                </div>
            </div>


            <!-- KILL ALL BUTTON -->
            <div class="safety-block">
                <div class="drawer-button-header">
                    <img class="drawer-button-icon" src="images/safety.svg" alt="Communication">
                    <span class="drawer-button-title">Safety</span>
                </div>

                <button class="kill-all-btn" type="button" data-action="kill_all">KILL ALL</button>
            </div>

        </div>


        <!-- MODAL DRAWER PANEL -->
        <div class="drawer-panel">
        
            <!-- Tabs row -->
            <div class="drawer-tabs" id="drawerTabs">
                <div class="drawer-tab active" data-tab="1">
                    <img class="tab-icon" src="images/helm-icon.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="2">
                    <img class="tab-icon" src="images/kilo-icon.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="3">
                    <img class="tab-icon" src="images/engine.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="4">
                    <img class="tab-icon" src="images/battery.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="5">
                    <img class="tab-icon" src="images/range.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="6">
                    <img class="tab-icon" src="images/safety.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="7">
                    <img class="tab-icon" src="images/assets.svg" alt="">
                </div>

                <div class="drawer-tab" data-tab="8">
                    <img class="tab-icon" src="images/signal-bars.svg" alt="">
                </div>
            </div>

            <!-- Content area -->
            <div class="drawer-content" id="drawerContent">

                <!-- TAB 1: Boat Control -->
                <div class="tab-pane active" data-tab="1">
                    <div class="pane-title">
                    <span>Boat Control</span>
                    </div>
                    <div class="pane-grid">

                        <div class="drawer-button-block">

                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/engine.svg" alt="Lamp icon">
                                <span class="drawer-button-title">Engine</span>
                            </div>
                        
                            <!-- Engine -->
                            <button class="battery-engine-status" id="ignitionBtn" data-state="1">
                                <!-- State 1: single "Ignition" -->
                                <span class="state-one">
                                    <img class="button-icon" src="images/engine-power.svg" alt="Engine power">
                                    <span class="battery-engine-label">Ignition</span>
                                </span>

                                <!-- State 2: split "Off | Start" -->
                                <span class="state-two" hidden>
                                    <span class="half half-off">
                                        <img class="button-icon" src="images/engine-power.svg" alt="Engine power">
                                        <span class="battery-engine-label">Off</span>
                                    </span>

                                    <span class="divider" aria-hidden="true"></span>

                                    <span class="half half-start">
                                        <img class="button-icon" src="images/engine.svg" alt="Engine">
                                        <span class="battery-engine-label">Start</span>
                                    </span>
                                </span>

                                <!-- State 3: single "Engine Works" (pulse) -->
                                <span class="state-three" hidden>
                                    <img class="button-icon" src="images/engine.svg" alt="Engine power">
                                    <span class="battery-engine-label">Engine Works</span>
                                </span>
                            </button>
                        </div>





                        <!-- Radar -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/radar-icon.svg" alt="Radar icon">
                                <span class="drawer-button-title">Radar</span>
                            </div>

                            <div class="solo-controls">
                                <div class="solo-toggle" role="group" aria-label="Radar toggle">
                                    <button class="solo-btn off active" data-value="--"> Off </button>
                                    <button class="solo-btn on" data-value="17.2"> On </button>
                                </div>
                            </div>
                        </div>
                      
                        <!-- AIS -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/radio-icon.svg" alt="Radio icon">
                                <span class="drawer-button-title">AIS</span>
                            </div>

                           <div class="solo3-controls">
                                <div class="solo3-toggle" role="group" aria-label="Sound toggle">
                                    <button class="solo3-btn off active" type="button" data-value="--">Off</button>
                                    <button class="solo3-btn silent"      type="button" data-value="S">Silent</button>
                                    <button class="solo3-btn on"          type="button" data-value="17.2">On</button>
                                </div>
                            </div>
                        </div>                     
                        
                        <!-- Navigation Lights -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/lamp-icon.svg" alt="Lamp icon">
                                <span class="drawer-button-title">Navigation Lights</span>
                            </div>

                           <div class="solo3-controls">
                                <div class="solo3-toggle" role="group" aria-label="Light relay">
                                    <button class="solo3-btn off active" type="button" data-value="--">Off</button>
                                    <button class="solo3-btn silent"      type="button" data-value="S">Anchor</button>
                                    <button class="solo3-btn on"          type="button" data-value="17.2">On</button>
                                </div>
                            </div>
                        </div>
                      
                        <!-- Beacon -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/lamp-icon.svg" alt="Lamp icon">
                                <span class="drawer-button-title">Beacon</span>
                            </div>

                            <div class="solo-controls">
                                <div class="solo-toggle" role="group" aria-label="Beacon toggle">
                                    <button class="solo-btn off active" data-value="--"> Off </button>
                                    <button class="solo-btn on" data-value="17.2"> On </button>
                                </div>
                            </div>
                        </div>
                                                                                              
                        <!-- Pump -->
                        <div class="button-button-row">

                            <!-- Pump Hight -->
                            <div class="button-button-block">
                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/pump-icon.svg" alt="Pump icon">
                                    <span class="drawer-button-title">Pump Hight</span>
                                </div>

                                <div class="half-relay" data-live-default="on">
                                    <button class="relay-btn auto" data-value="13.2">Auto</button>
                                    <button class="relay-btn on" data-value="13.2">On</button>
                                </div>
                            </div>
                                                        
                            <!-- Pump Low-->
                            <div class="button-button-block">
                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/pump-icon.svg" alt="Pump icon">
                                    <span class="drawer-button-title">Pump Low</span>
                                </div>

                                <div class="half-relay" data-live-default="on">
                                    <button class="relay-btn auto" data-value="13.2">Auto</button>
                                    <button class="relay-btn on" data-value="13.2">On</button>
                                </div>
                            </div>

                        </div>
                  


                        <!-- Active Helm & AP status  -->
                        <div class="button-button-row">

                            <!-- Active Helm -->
                            <div class="button-button-block">
                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/helm-icon.svg" alt="Helm icon">
                                    <span class="drawer-button-title">Helm</span>
                                </div>
                                <!-- Main Button -->
                                <button id="helm-toggle" class="middle-drawer-button">Manual</button>
                            </div>
                                                        
                            <!-- AP status-->
                            <div class="button-button-block">
                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/autopilot-icon.svg" alt="Autopilot icon">
                                    <span class="drawer-button-title">AP status</span>
                                </div>
                                <!-- Main Button -->
                                <button id="ap-toggle" class="middle-drawer-button">Manual</button>
                            </div>

                        </div>
                  


                    </div>
                </div>

                <!-- TAB 2: Payload Control -->
                <div class="tab-pane" data-tab="2">
                    <div class="pane-title">
                        <span>Payload Control</span>
                    </div>

                    <!-- Release Authorized / Prohibited -->
                    <div class="drawer-button-block">
                        <div class="drawer-display" id="drawer-display">
                            <img class="display-icon" src="images/unlock-icon.svg" alt="Unlock">
                            <span class="display-value">Release Authorized</span>
                        </div>
                    </div>

         


                    <!-- BUTTONS -->
                    <div class="payload-button-block">
     
                        <div class="button-1"> 
                            <div class="control-button" data-device="actuator_power">
                                <div class="safety-cap">
                                <img alt="Actuator" src="images/vtol.svg"/>
                                </div>

                                <button data-bit="0" data-id="0x550">
                                <img alt="Actuator" class="button-icon" src="images/engine.svg"/>
                                </button>

                                <div class="button-label">Actuator Power</div>
                            </div>
                        </div> 
                        <div class="button-2"> 
                            <div class="control-button" data-device="engine_power">
                                <div class="safety-cap">
                                <img alt="engine" src="images/engine.svg"/>
                                </div>
                                
                                <button data-bit="1" data-id="0x550">
                                <img alt="engine" class="button-icon" src="images/engine.svg"/>
                                </button>
                                <div class="button-label">engine Power</div>
                            </div>
                        </div>
                        <div class="button-3"> 
                            <div class="control-button" data-device="12v_house_charging">
                                <div class="safety-cap">
                                <img alt="12V Charging" src="images/12Vchg.svg"/>
                                </div>
                                <button data-bit="2" data-id="0x550">
                                <img alt="12V Charging" class="button-icon" src="images/12Vchg.svg"/>
                                </button>
                                <div class="button-label">12V House Charging</div>
                            </div>
                        </div>
                        <div class="button-4"> 
                            <div class="control-button" data-device="12v_house_charging">
                                <div class="safety-cap">
                                <img alt="12V Charging" src="images/12Vchg.svg"/>
                                </div>
                                <button data-bit="2" data-id="0x550">
                                <img alt="12V Charging" class="button-icon" src="images/12Vchg.svg"/>
                                </button>
                                <div class="button-label">12V House Charging</div>
                            </div>
                        </div>
                        <div class="button-5"> 
                            <div class="control-button" data-device="actuator_power">
                                <div class="safety-cap">
                                <img alt="Actuator" src="images/Actuator.svg"/>
                                </div>

                                <button data-bit="0" data-id="0x550">
                                <img alt="Actuator" class="button-icon" src="images/Actuator.svg"/>
                                </button>

                                <div class="button-label">Actuator Power</div>
                            </div>
                        </div> 
                        <div class="button-6"> 
                            <div class="control-button" data-device="engine_power">
                                <div class="safety-cap">
                                <img alt="engine" src="images/engine.svg"/>
                                </div>
                                
                                <button data-bit="1" data-id="0x550">
                                <img alt="engine" class="button-icon" src="images/engine.svg"/>
                                </button>
                                <div class="button-label">engine Power</div>
                            </div>
                        </div>
                        <div class="button-7"> 
                            <div class="control-button" data-device="12v_house_charging">
                                <div class="safety-cap">
                                <img alt="12V Charging" src="images/12Vchg.svg"/>
                                </div>
                                <button data-bit="2" data-id="0x550">
                                <img alt="12V Charging" class="button-icon" src="images/12Vchg.svg"/>
                                </button>
                                <div class="button-label">12V House Charging</div>
                            </div>
                        </div>
                        <div class="button-8"> 
                            <div class="control-button" data-device="12v_house_charging">
                                <div class="safety-cap">
                                <img alt="12V Charging" src="images/12Vchg.svg"/>
                                </div>
                                <button data-bit="2" data-id="0x550">
                                <img alt="12V Charging" class="button-icon" src="images/12Vchg.svg"/>
                                </button>
                                <div class="button-label">12V House Charging</div>
                            </div>
                        </div>

                    </div>

                </div>

                <!-- TAB 3: Engine Status -->
                <div class="tab-pane" data-tab="3">

                    <div class="pane-title"><span>Engine Status</span></div>
                    
                    <div class="pane-grid">

                        <!-- Engine Status block -->

                        <div class="status-block">

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/coolant-temp.svg" alt="Temperature icon">
                                    <span class="status-title">Engine coolant temp</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">102</span>
                                    <span class="status-display-unit">° C</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/oil-tempriture.svg" alt="Temperature icon">
                                    <span class="status-title">Engine oil temp </span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">451</span>
                                    <span class="status-display-unit">° F</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/oil-pressure.svg" alt="Temperature icon">
                                    <span class="status-title">Engine oil pressure</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">30</span>
                                    <span class="status-display-unit">bar</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/gas-temperature.svg" alt="Temperature icon">
                                    <span class="status-title">Exhaust gas temp</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">102</span>
                                    <span class="status-display-unit">° C</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/manifold-air-pressur.svg" alt="Temperature icon">
                                    <span class="status-title">Manifold air pressur</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">102</span>
                                    <span class="status-display-unit">° C</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/manifold-air-temperature.svg" alt="Temperature icon">
                                    <span class="status-title">Manifold air temp</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">102</span>
                                    <span class="status-display-unit">° C</span>
                                </div>
                            </div>
                            
                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/gearbox-oil.svg" alt="Temperature icon">
                                    <span class="status-title">Gearbox oil pressure</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">10</span>
                                    <span class="status-display-unit">Psi</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/fuel-time.svg" alt="Temperature icon">
                                    <span class="status-title">Fuel rate avg [time]</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">23.5</span>
                                    <span class="status-display-unit">G/h</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/fuel-distance.svg" alt="Temperature icon">
                                    <span class="status-title">Fuel rate avg [dist]</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">5.5</span>
                                    <span class="status-display-unit">G/m</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/propeller.svg" alt="Temperature icon">
                                    <span class="status-title">Propeller speed low</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">OK</span>
                                    <span class="status-display-unit"></span>
                                </div>
                            </div>
                            
                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/fuel-used.svg" alt="Temperature icon">
                                    <span class="status-title">Fuel used</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">94</span>
                                    <span class="status-display-unit">G</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/range.svg" alt="Temperature icon">
                                    <span class="status-title">Traveled distance</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">142</span>
                                    <span class="status-display-unit">Nm</span>
                                </div>
                            </div>
                                                        
                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/speed.svg" alt="Temperature icon">
                                    <span class="status-title">Max speed</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">19</span>
                                    <span class="status-display-unit">Kn</span>
                                </div>
                            </div>

                            <div class="engine-status-controls">
                                <div class="status-header">
                                    <img class="status-icon" src="images/engine-hrs.svg" alt="Temperature icon">
                                    <span class="status-title">Engine hrs</span>
                                </div>

                                <div class="status-display">
                                    <span class="status-display-value">102</span>
                                    <span class="status-display-unit">Hr</span>
                                </div>
                            </div>

                            
                        </div>
                        
                        <!-- Kill Engine button -->
                        <div class="drawer-button-block">
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/engine.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill Engine</span>
                            </button>
                        </div>

                    </div>

                </div>

                <!-- TAB 4: Battery Status -->
                <div class="tab-pane" data-tab="4">
                    <div class="pane-title"><span>Battery Status</span></div>                   
                                   
                    <div class="pane-grid">

                        <!-- Unified SVG container with three separate tracks -->
                        <svg id="battery-wires"
                            viewBox="0 0 100 100"
                            preserveAspectRatio="none"
                            width="100%" height="100%"
                            aria-hidden="true">


                        </svg>

                        <div class="battery-block">

                            <!-- Start -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">Engine Start</span>
                                </div>

                            <!-- Start relay (Bank 1, Switch 1) -->
                                <div class="relay" data-bank="1" data-instance="1" data-name="Start">
                                <div class="relay-controls">
                                    <div class="drawer-button-toggle">
                                    <button class="toggle-btn off active" data-value="--"> Off </button>
                                    <button class="toggle-btn on"  data-value="--"> On </button>
                                    </div>
                                    <div class="drawer-button-display">
                                    <span class="display-value">--</span>
                                    <span class="display-unit">V</span>
                                    </div>
                                </div>
                                </div>
                            </div>
                            <!-- Start -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">Engine Control</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                                          
                            <!-- House Relay -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/relay-icon.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">Engine -> House</span>
                                </div>

                                <div class="relay-controls">

                                    <div class="drawer-button-relay" data-live-default="on">
                                        <button class="relay-btn off active">Off</button>
                                        <button class="relay-btn auto" data-value="13.2">Auto</button>
                                        <button class="relay-btn on" data-value="13.2">On</button>

                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                            
                            <!-- House -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">House → Payload 1</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                            
                            
                            <!-- House -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">House Loads</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                                              
                            

-------------------------------------------



                            <!-- House -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title"> Payload 1 Loads</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                                                                                
                            <!-- Payload 1 -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">Payload 1 → Payload 2</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>
                                                                             
                            <!-- Payload 2 -->
                            <div class="battery-button-block">

                                <div class="drawer-button-header">
                                    <img class="drawer-button-icon" src="images/battery.svg" alt="Temperature icon">
                                    <span class="drawer-button-title">Payload 2 Loads</span>
                                </div>

                                <div class="sensor-controls">

                                    <div class="drawer-button-toggle">
                                        <button class="toggle-btn off active" data-value="--"> Off </button>
                                        <button class="toggle-btn on" data-value="17.2"> On </button>
                                    </div>

                                    <div class="drawer-button-display">
                                        <span class="display-value">--</span>
                                        <span class="display-unit">V</span>
                                    </div>

                                </div>
                            </div>

                        </div>

                    </div>

                </div>

                <!-- TAB 5: Mission Playlist -->
                <div class="tab-pane" data-tab="5">
                    <div class="pane-title">
                        <span>Mission Playlist</span>
                    </div>


                
                    <!-- Mission-PLEER -->
                    <div class="mission-pleer-block">

                        <div class="drawer-button-header">
                            <img class="drawer-button-icon" src="images/range.svg" alt="Communication">
                            <span class="drawer-button-title">Mission</span>
                        </div>

                        <div class="mission-pleer">


                                    <!-- ======= Mission-PLEER content ======= -->

                                    <div class="mission-meta">
                                        <!-- left time -->
                                        <span class="mission-value">00:00:00</span>
                                        <!-- mission title -->
                                        <span class="mission-name">Mission Name</span>
                                        <!-- right time -->
                                        <span class="mission-value">00:00:00</span>
                                    </div>

                                    <!-- timeline -->
                                    <div class="mission-timeline" data-points="8">
                                        <div class="timeline-track">
                                            <!-- waypoints (auto-positioned by JS) -->
                                            <span class="mission-waypoint" data-label="1"></span>
                                            <span class="mission-waypoint" data-label="2"></span>
                                            <span class="mission-waypoint" data-label="#"></span>
                                            <span class="mission-waypoint" data-label="A"></span>


                                            <!-- yellow cursor (moves to active waypoint) -->
                                            <span class="mission-cursor" aria-hidden="true"></span>
                                        </div>
                                    </div>

                                    <!-- controls row -->
                                    <div class="mission-controls">

                                        <div class="pleer-buttons">
                                            <!-- home / back / pause / next -->
                                            <button class="pleer-btn" type="button" title="Home" disabled>
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 14l6-6 6 6"/></svg>
                                            </button>
                                            <button class="pleer-btn js-prev" type="button" title="Previous">
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                                            </button>
                                            <button class="pleer-btn js-play-toggle" type="button" title="Pause">
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M8 6v12M16 6v12"/>
                                                </svg>
                                            </button>
                                            <button class="pleer-btn js-next" type="button" title="Next">
                                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6"/></svg>
                                            </button>
                                        </div>

                                        <div class="pleer-data">
                                            <div class="pleer-data-item">
                                                <span class="pleer-data-name">DST:</span>
                                                <span class="pleer-data-value">240</span>
                                                <span class="pleer-data-unit">m</span>
                                            </div>
                                            <div class="pleer-data-item">
                                                <span class="pleer-data-name">HDN:</span>
                                                <span class="pleer-data-value">310</span>
                                                <span class="pleer-data-unit">°</span>
                                            </div>
                                        </div>
                                        
                                    </div>


                        </div>

                    </div>









                    <!-- Mission CARDS -->

                    <!-- 23 Kilo -->
                    <div class="mission-card">
                        <div class="mission-card__header">
                            <div class="mission-card__title">23 Kilo</div>
                            <img class="mission-card__icon" src="images/radio-icon.svg" alt="Link status">
                        </div>

                        <div class="mission-card__list">
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/in-formation.svg" alt="">
                            <span class="mission-card__item-text">In Formation</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/true-north.svg" alt="">
                            <span class="mission-card__item-text">HDG 120°</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/range.svg" alt="">
                            <span class="mission-card__item-text">320 NM</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/altimeter-icon.svg" alt="">
                            <span class="mission-card__item-text">0 m AGL</span>
                            </div>
                            <div class="mission-card__item">
                                <img class="mission-card__item-icon" src="images/coordinates-icon.svg" alt="Coordinates">
                                <span class="mission-card__item-text">0.000000, 0.000000</span>
                            </div>
                        </div>
                    </div>

                    <!-- 7 VTOL -->
                    <div class="mission-card">
                        <div class="mission-card__header">
                            <div class="mission-card__title">7 VTOL</div>
                            <img class="mission-card__icon" src="images/vtol.svg" alt="Link status">
                            <img class="mission-card__icon" src="images/vtol.svg" alt="Link status">
                            <img class="mission-card__icon" src="images/vtol.svg" alt="Link status">
                        </div>

                        <div class="mission-card__list">
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/in-formation.svg" alt="">
                            <span class="mission-card__item-text">In Formation</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/true-north.svg" alt="">
                            <span class="mission-card__item-text">HDG 120°</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/range.svg" alt="">
                            <span class="mission-card__item-text">320 NM</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/altimeter-icon.svg" alt="">
                            <span class="mission-card__item-text">0 m AGL</span>
                            </div>
                            <div class="mission-card__item">
                                <img class="mission-card__item-icon" src="images/coordinates-icon.svg" alt="Coordinates">
                                <span class="mission-card__item-text">0.000000, 0.000000</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 14 Quadro -->
                    <div class="mission-card">
                        <div class="mission-card__header">
                            <div class="mission-card__title">14 Quadro</div>
                            <img class="mission-card__icon" src="images/quadro-icon.svg" alt="Link status">
                            <img class="mission-card__icon" src="images/quadro-icon.svg" alt="Link status">

                        </div>

                        <div class="mission-card__list">
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/in-formation.svg" alt="">
                            <span class="mission-card__item-text">In Formation</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/true-north.svg" alt="">
                            <span class="mission-card__item-text">HDG 120°</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/range.svg" alt="">
                            <span class="mission-card__item-text">320 NM</span>
                            </div>
                            <div class="mission-card__item">
                            <img class="mission-card__item-icon" src="images/altimeter-icon.svg" alt="">
                            <span class="mission-card__item-text">0 m AGL</span>
                            </div>
                            <div class="mission-card__item">
                                <img class="mission-card__item-icon" src="images/coordinates-icon.svg" alt="Coordinates">
                                <span class="mission-card__item-text">0.000000, 0.000000</span>
                            </div>
                        </div>
                    </div>





                </div>

                <!-- TAB 6: Safety -->
                <div class="tab-pane" data-tab="6">
                    <div class="pane-title"><span>Safety</span></div>
                    <div class="pane-grid">

                        <!-- Mission hours -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/time-light.svg" alt="Temperature icon">
                                <span class="drawer-button-title">Mission hours</span>
                            </div>

                            <div class="drawer-button-display fullwidth">
                                <span class="display-value">00:00:00</span>
                            </div>
                        </div>
                        
                        <!-- Engine hours -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/engine-hrs.svg" alt="Temperature icon">
                                <span class="drawer-button-title">Engine hour</span>
                            </div>

                            <div class="drawer-button-display fullwidth">
                                <span class="display-value">00:00:00</span>
                            </div>
                        </div>

                        
                        <!-- Last Service -->
                        <div class="drawer-button-block">
                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/engine.svg" alt="Temperature icon">
                                <span class="drawer-button-title">Last Service</span>
                            </div>

                            <div class="drawer-button-display fullwidth">
                                <span class="display-value">MM/DD/YY</span>
                            </div>
                        </div>


                        <!-- Kill BUTTONS -->
                        
                        <div class="button-block">

                            <!-- Kill Engine button -->
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/engine.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill Engine</span>
                            </button>

                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/battery.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill 12V Bus</span>
                            </button>
                            
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/battery.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill 24V Bus</span>
                            </button>
                            
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/kilo-icon.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill Payload Power</span>
                            </button>
                            
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/radio-icon.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill Radio</span>
                            </button>
                            
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/satellite.svg" alt="Engine icon">
                                <span class="button-drawer-label">Kill Satellite</span>
                            </button>
                            
                            <button class="big-drawer-button">
                                <img class="button-icon" src="images/silent-mode.svg" alt="Engine icon">
                                <span class="button-drawer-label">Silent Mode</span>
                            </button>


                        </div>

                    </div>
                </div>

                <!-- TAB 7: Assets -->
                <div class="tab-pane" data-tab="7">
                        <div class="pane-title">
                        <span>Assets</span>
                        </div>

                        <div class="pane-grid">

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/kilo-icon.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>289<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>22 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/vtol.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">VT52</div>
                                            <div class="asset-sub">In formation</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/vtol.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">VT52</div>
                                            <div class="asset-sub">In formation</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/vtol.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">VT52</div>
                                            <div class="asset-sub">In formation</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            
                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="pane-card">
                                <div class="asset-main">

                                    <div class="asset-info">
                                        <img class="asset-icon" src="images/boat.svg" alt="">
                                        <div class="asset-texts">
                                            <div class="asset-title">23 Kilo</div>
                                            <div class="asset-sub">Leader</div>
                                        </div>
                                    </div>

                                    <div class="asset-meta">
                                        <div class="metric">
                                            <img class="m-icon" src="images/true-north.svg" alt="">
                                            <span>102<span class="unit">°</span></span>
                                        </div>
                                        <div class="metric">
                                            <img class="m-icon" src="images/distance.svg" alt="">
                                            <span>14 <span class="unit">km</span></span>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>
                </div>

                <!-- TAB 8: Sensors -->
                <div class="tab-pane" data-tab="8">

                    <div class="pane-title"><span>Communication</span> </div>
                    <div class="pane-grid">

                        <!-- Communication block -->
                        <div class="drawer-button-block comm-block">

                            <div class="drawer-button-header">
                                <img class="drawer-button-icon" src="images/signal-bars.svg" alt="Communication">
                                <span class="drawer-button-title">Communication</span>
                            </div>


                            <!-- Toggle row -->
                            <div class="comm-toggle">
                                <button class="comm-btn radio" type="button"
                                        data-signal="98" data-dbm="107">Radio</button>
                                <button class="comm-btn satellite active" type="button"
                                        data-signal="100" data-dbm="110">Satellite</button>
                            </div>

                            
                            <!-- Display row "100% | 110 dBm" -->
                            <div class="comm-display">
                                <div class="comm-metric">
                                    <span class="display-value" data-key="signal">100</span>
                                    <span class="display-unit">%</span>
                                </div>

                                <div class="comm-divider" aria-hidden="true"></div>

                                <div class="comm-metric">
                                    <span class="display-value" data-key="dbm">110</span>
                                    <span class="display-unit">dBm</span>
                                </div>
                            </div>

                        </div>


                    </div>

                </div>

            </div>
        </div>

        
        <!-- MODAL ACTIVE HELM PANEL -->
        <div id="helm-modal" class="status-modal">
            <div class="status-modal-content">
                <div class="status-modal-header">
                    <img src="images/helm-icon.svg" alt="Helm icon" class="helm-icon">
                    <span>AP status</span>
                </div>

                <div class="helm-display">
                    <span class="helm-display-value">Main</span>
                </div>
                <div class="helm-display">
                    <span class="helm-display-value">AUX</span>
                </div>
                <div class="helm-display">
                    <span class="helm-display-value">Robot</span>
                </div>

                <button id="ap-mode-btn" class="ap-mode-btn" data-mode="Manual">Take Control</button>
            </div>
        </div>


        <!-- MODAL AUTO PILOT PANEL -->
        <div id="auto-pilot-modal" class="status-modal">
            <div class="status-modal-content">
                
                <!-- Modal Header -->
                <div class="status-modal-header">
                    <img src="images/autopilot-icon.svg" alt="AP icon" class="ap-icon">
                    <span>AP status</span>
                </div>

                <!-- Mode Buttons -->
                <button class="ap-mode-btn" data-mode="Manual">Manual</button>
                <button class="ap-mode-btn" data-mode="Hold">Hold</button>
                <button class="ap-mode-btn" data-mode="Auto">Auto</button>
                <button class="ap-mode-btn" data-mode="Loiter">Loiter</button>
                <button class="ap-mode-btn" data-mode="Acro">Acro</button>
                <button class="ap-mode-btn" data-mode="RTL">RTL</button>

            </div>
        </div>



    </div>
</div>




    <!-- SCRIPT // FOOTER and NAVIGATION -->
    <script>
               // === Initial State ===
                let currentScreen = 1;
                let deviceStates = {
                '0x550': Array(8).fill(0),
                '0x551': Array(8).fill(0),
                '0x552': Array(8).fill(0)
                };

                // === DOM Elements ===
                const connectionIndicator = document.getElementById('connection-indicator');
                const statusBar = document.getElementById('status-bar');
                const debugPanel = document.getElementById('debug-panel');
                const controllerHeartbeat = document.getElementById('controller-heartbeat');
                const deviceHeartbeats = document.getElementById('device-heartbeats');

                // === Screen Navigation Logic ===
                function switchScreen(screenNumber) {
                // Deactivate all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                const targetScreen = document.getElementById(`screen-${screenNumber}`);
                if (targetScreen) targetScreen.classList.add('active');

                // Update indicator dots
                document.querySelectorAll('.indicator-dot').forEach(dot => {
                    dot.classList.remove('active');
                });
                const activeDot = document.querySelector(`.indicator-dot[data-screen="${screenNumber}"]`);
                if (activeDot) activeDot.classList.add('active');

                // Update carousel title
                document.querySelectorAll('.carousel-title').forEach(title => {
                    title.classList.remove('active');
                });
                const visibleTitle = document.querySelector(`.carousel-title[data-screen="${screenNumber}"]`);
                if (visibleTitle) visibleTitle.classList.add('active');

                currentScreen = screenNumber;
                }

                // === Event Listeners ===

                // Arrows
                document.getElementById('prev-screen')?.addEventListener('click', () => {
                const prev = currentScreen === 1 ? 3 : currentScreen - 1;
                switchScreen(prev);
                });

                document.getElementById('next-screen')?.addEventListener('click', () => {
                const next = currentScreen === 3 ? 1 : currentScreen + 1;
                switchScreen(next);
                });

                // Dots
                document.querySelectorAll('.indicator-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const screenNumber = parseInt(dot.dataset.screen);
                    switchScreen(screenNumber);
                });
                });

                // Toggle debug panel
                statusBar?.addEventListener('click', () => {
                debugPanel.classList.toggle('open');
                });


    </script>

    <!-- SCRIPT // BUTTONS -->
    <script>

            // Safety cap functionality
            function initializeSafetyCaps() {
                const safetyCaps = document.querySelectorAll('.safety-cap');
                
                safetyCaps.forEach(cap => {
                    const controlButton = cap.closest('.control-button');
                    const deviceName = controlButton.dataset.device;
                    
                    cap.addEventListener('click', function () {
                        if (editMode) return; // Block in editMode
                        this.classList.toggle('open');
                        updateButtonArmedState(deviceName);
                    });
                });
            }

            // Initialize button event listeners
            function initializeButtons() {
                const buttons = document.querySelectorAll('.control-button button');
                
                buttons.forEach(button => {
                    const controlButton = button.closest('.control-button');
                    const deviceName = controlButton.dataset.device;
                    
                    // Initialize the button state based on safety cap
                    updateButtonArmedState(deviceName);
                    
                    button.addEventListener('click', () => {
                        if (editMode) {
                            openEditModal(deviceName);
                        } else {
                            handleButtonClick(deviceName);
                        }
                    });

                });
            }

            // Update the armed state of a button based on safety cap and connection
            function updateButtonArmedState(deviceName) {
                const controlButton = document.querySelector(`[data-device="${deviceName}"]`);
                if (!controlButton) return;

                const button = controlButton.querySelector('button');
                const safetyCap = controlButton.querySelector('.safety-cap');

                // Get current state
                const id = button.dataset.id;
                const bit = parseInt(button.dataset.bit);

                let state = 0;
                if (bit < 8) {
                    state = (deviceStates[id][0] >> bit) & 1;
                } else {
                    const byteIndex = Math.floor(bit / 8);
                    const bitInByte = bit % 8;
                    state = (deviceStates[id][byteIndex] >> bitInByte) & 1;
                }

                // only if there is a connection
                const isConnected = document.body.classList.contains('connected');

                // Update button appearance
                if (safetyCap.classList.contains('open') && isConnected) {
                    if (state === 1) {
                        button.classList.add('active');
                        button.classList.remove('armed');
                    } else {
                        button.classList.add('armed');
                        button.classList.remove('active');
                    }
                } else {
                    button.classList.remove('armed', 'active');
                }
            }

            // Handle button click
            function handleButtonClick(deviceName) {
                const controlButton = document.querySelector(`[data-device="${deviceName}"]`);
                if (!controlButton) return;
                
                const button = controlButton.querySelector('button');
                const safetyCap = controlButton.querySelector('.safety-cap');
                const led = document.getElementById(`led-${deviceName}`);
                
                // Check if safety cap is open
                if (!safetyCap.classList.contains('open')) {
                    console.log('Safety cap is closed. Cannot activate button.');
                    return;
                }
                
                const id = button.dataset.id;
                const bit = button.dataset.bit;
                
                // Send CAN button command
                CANbutton(id, bit);
            }

            // Main CAN button handler
            function CANbutton(id, loc) {
                console.log(`Button click: ${id}, bit ${loc}`);
                
                // Don't update local state yet - wait for server confirmation
                
                // Send message to Teensy
                let msg = 'STARTMSG' + id + ',' + loc + "ENDMSG";
                
                // Use relative URL instead of hardcoded IP
                fetch("/button-click", {
                    method: "POST",
                    headers: {"Content-Type": "text/plain"},
                    body: msg
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    console.log('Response:', data);
                    // Request status update after button press
                    requestStatus();
                })
                .catch(error => {
                    console.error('Error sending button command:', error);
                    connectionIndicator.classList.add('disconnected');
                    alert('Failed to send command to device');
                });
            }

            // Update all button states
            function updateAllButtonStates() {
                document.querySelectorAll('.control-button').forEach(controlButton => {
                    const deviceName = controlButton.dataset.device;
                    updateButtonArmedState(deviceName);
                });
            }

            // Update all LED indicators
            function updateAllLedStates() {
                document.querySelectorAll('.control-button').forEach(controlButton => {
                    const deviceName = controlButton.dataset.device;
                    const button = controlButton.querySelector('button');

                    if (!button) return;

                    const id = button.dataset.id;
                    const bit = parseInt(button.dataset.bit);

                    let state = 0;
                    if (bit < 8) {
                state = (deviceStates[id][0] >> bit) & 1;
                    } else {
                    const byteIndex = Math.floor(bit / 8);
                    const bitInByte = bit % 8;
                    state = (deviceStates[id][byteIndex] >> bitInByte) & 1;
                    }

                    if (state === 1) {
                    button.classList.add('on');
                    } else {
                    button.classList.remove('on');
                    }
                });
            }


            // Update the heartbeat displays
            function updateHeartbeatDisplay() {
                // Controller heartbeat display
                let controllerText = '';
                controllerText += `0x550: ${deviceStates['0x550'].map(b => b.toString(16).padStart(2, '0')).join(' ')}\n`;
                controllerText += `0x551: ${deviceStates['0x551'].map(b => b.toString(16).padStart(2, '0')).join(' ')}\n`;
                controllerText += `0x552: ${deviceStates['0x552'].map(b => b.toString(16).padStart(2, '0')).join(' ')}\n`;
                controllerHeartbeat.textContent = controllerText || 'No controller heartbeats';
                
                // Device heartbeat display (would show actual device states from CAN responses)
                deviceHeartbeats.textContent = 'No device heartbeats received';
            }


            // Request status from Teensy
            function requestStatus() {
            fetch("/status")
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.states) {
                    deviceStates = data.states;
                    updateAllButtonStates();
                    updateAllLedStates();
                    updateHeartbeatDisplay();
                    connectionIndicator.classList.remove('disconnected');

                    // Add class connected to <body>
                    document.body.classList.add('connected');
                    document.body.classList.remove('disconnected');
                }
            })
            .catch(error => {
                console.error('Error fetching status:', error);
                connectionIndicator.classList.add('disconnected');

                // Switching to mode disconnected
                document.body.classList.add('disconnected');
                document.body.classList.remove('connected');
            });
            }


    </script>

    <!-- SCRIPT // MODAL EDIT BUTTON -->
    <script>

        // OPEN EDIT MODAL //

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing application');
            
            // Initialize UI components
            initializeSafetyCaps();
            initializeButtons();
            
            // Update initial state
            updateAllButtonStates();
            updateAllLedStates();
            updateHeartbeatDisplay();
            
            // Request status every 500ms
            setInterval(requestStatus, 500);
        });

        // Gear icon click — enter EDIT MODE
        document.addEventListener('DOMContentLoaded', () => {
            const editIcon = document.querySelector('.options-icon[alt="Settings"]');
            if (editIcon) {
                editIcon.addEventListener('click', () => {
                    // Close the debug panel
                    document.getElementById('debug-panel').classList.remove('open');

                    // Activate edit mode
                    editMode = true;

                    // Close all safety caps when entering edit mode
                    document.querySelectorAll('.safety-cap').forEach(cap => {
                        cap.classList.remove('open');
                    });

                        updateAllButtonStates(); // Recalculate states after closing
                        document.body.classList.add('editing-mode');
                        console.log('Entered EDIT MODE');
                });
            }
        });






    // EDIT MODE // 

            let editMode = false;

            function applySettingsToButton(settings) {
                const container = document.getElementById('edit-modal-container');
                container.style.display = 'none';
                document.body.classList.remove('editing-mode');
                editMode = false;

                // Find the button being edited (stored in a variable)
                if (currentEditingDevice && settings) {
                    const control = document.querySelector(`[data-device="${currentEditingDevice}"]`);
                    if (control) {

                        // Apply icon to button
                        const icon = control.querySelector('.button-icon');
                        if (icon) {                            icon.style.display = "none";

                            if (settings.icon && settings.icon.trim() !== "") {
                                icon.src = settings.icon;
                                icon.alt = "Icon";
                                icon.style.display = "block";
                            }
                        }

                        // Apply icon to safety cap
                        const capIcon = control.querySelector('.safety-cap img');
                        if (capIcon) {                            capIcon.style.display = "none";

                            if (settings.icon && settings.icon.trim() !== "") {
                                capIcon.src = settings.icon;
                                capIcon.alt = "Icon";
                                capIcon.style.display = "block";
                            }
                        }

                        // Apply label
                        const label = control.querySelector('.button-label');
                        if (label) label.textContent = settings.label;

                        // Apply safety cap visibility (on/off)
                        const cap = control.querySelector('.safety-cap');
                        if (cap) {
                            cap.style.display = settings.safetyCap ? 'flex' : 'none';
                        }

                        console.log(`Applied settings to "${currentEditingDevice}":`, settings);
                    }
                }

                currentEditingDevice = null; // Reset the tracking variable
            }


    // Close Edit Modal //
            function closeEditModal() {
                document.getElementById('edit-modal-container').style.display = 'none';
                document.getElementById('modal-backdrop').style.display = 'none';
                document.body.classList.remove('editing-mode');
                editMode = false;
                currentEditingDevice = null;
            }

            let currentEditingDevice = null;


    // Reading all the required data using the selected button //

            function openEditModal(deviceName) {
                currentEditingDevice = deviceName;

                const control = document.querySelector(`[data-device="${deviceName}"]`);
                const iconEl = control.querySelector('.button-icon');
                const icon = iconEl && iconEl.style.display !== "none" ? iconEl.getAttribute("src") : "";
                const cap = control.querySelector('.safety-cap');
                const label = control.querySelector('.button-label')?.textContent?.trim() || "Label";

                // New: determine mode from saved data-mode (if available)
                const mode = control.getAttribute("data-mode") || "disabled";

                // New: timer, if available

                const timer = control.getAttribute("data-timer") || "300";

                const safetyCap = cap?.style.display !== 'none';

                const settings = {
                    icon,
                    label,
                    safetyCap,
                    mode,
                    timer
                };

                insertModalHTML(settings); // pass the settings
            }

            // ↓ define the function separately
            function insertModalHTML(settings) {
                const container = document.getElementById('edit-modal-container');

                const icon = settings.icon !== "" ? settings.icon : "images/disabled.svg";
                const label = settings.label || "Label";
                const safetyCap = settings.safetyCap;
                const mode = settings.mode || "disabled";
                const timer = settings.timer || "300";

                container.innerHTML = 
                `<div class="editor-modal-backdrop">
                            <div class="editor-modal-window ${mode === "timer" ? "timer-active" : ""}">
                                <h2 class="editor-modal-title">Button edit</h2>
                                <div class="editor-modal-content">
                                    <!-- Preview button area -->
                                    <div class="editor-preview-frame">
                                        <div class="editor-preview-content">
                                            <div class="editor-control-button preview-position" data-device="preview_button">
                                                <!-- Cap state container -->
                                                <div class="editor-cap-container ${safetyCap ? "state-safety" : "state-no-cap"}" onclick="toggleCapState(this)">
                                                    <div class="editor-safety-cap">
                                                        <img src="${icon}" alt="Icon on cap" class="editor-cap-icon">
                                                    </div>
                                                    <div class="editor-no-safety-cap"></div>
                                                    <div class="editor-safety-cap-hover"></div>
                                                </div>

                                                <!-- Button with icon -->
                                                <button class="editor-preview-button" data-id="0x999" data-bit="0">
                                                    <img src="${icon}" alt="Icon" class="editor-button-icon icon-selected">
                                                </button>

                                                <!-- Label below button -->
                                                <div class="editor-button-label edited" contenteditable="true">${label}</div>
                                            </div>
                                        </div>
                                    </div>

                            

                                <!-- Change Preview Button Icon -->

                                        <div class="editor-icon-picker-modal" id="iconPicker">
                                            <div class="editor-icon-grid">
                                                <img src="images/disabled.svg" alt="Disabled" onclick="selectIcon(this)">
                                                <img src="images/vtol.svg" alt="VTOL" onclick="selectIcon(this)">
                                                <img src="images/helicopter.svg" alt="Helicopter" onclick="selectIcon(this)">
                                                <img src="images/fpv.svg" alt="FPV Drone" onclick="selectIcon(this)">
                                                <img src="images/uav.svg" alt="UAV Drone" onclick="selectIcon(this)">
                                                <img src="images/torpedo.svg" alt="Torpedo" onclick="selectIcon(this)">
                                                <img src="images/boat.svg" alt="Boat" onclick="selectIcon(this)">
                                                <img src="images/mako.svg" alt="MAKO" onclick="selectIcon(this)">
                                                <img src="images/kilo-icon.svg" alt="Kilo" onclick="selectIcon(this)">
                                                <img src="images/catamaran.svg" alt="Catamaran" onclick="selectIcon(this)">
                                                <img src="images/drift-buoy.svg" alt="VTOL" onclick="selectIcon(this)">
                                                <img src="images/picsea.svg" alt="Picsea" onclick="selectIcon(this)">
                                                <img src="images/6drov.svg" alt="6DROV" onclick="selectIcon(this)">
                                                <img src="images/rov.svg" alt="ROV" onclick="selectIcon(this)">
                                                <img src="images/tether.svg" alt="Tether" onclick="selectIcon(this)">                    
                                                <img src="images/component-hardware.svg" alt="Hardware component" onclick="selectIcon(this)">
                                                <img src="images/camera.svg" alt="Camera" onclick="selectIcon(this)">
                                                <img src="images/robo-dog.svg" alt="Robo-dog" onclick="selectIcon(this)">
                                                <img src="images/headquarters.svg" alt="Headquarters" onclick="selectIcon(this)">
                                                <img src="images/satellite.svg" alt="Satellite" onclick="selectIcon(this)">
                                                <img src="images/tower.svg" alt="Tower" onclick="selectIcon(this)">
                                                <img src="images/scan-forward.svg" alt="Scan-forward" onclick="selectIcon(this)">
                                                <img src="images/scan-side.svg" alt="Scan-side" onclick="selectIcon(this)">
                                                <img src="images/dvl.svg" alt="DVL" onclick="selectIcon(this)">
                                                <img src="images/12vchg.svg" alt="12 vchg" onclick="selectIcon(this)">
                                                <img src="images/24vchg.svg" alt="24 vchg" onclick="selectIcon(this)">
                                                <img src="images/actuator.svg" alt="Actuator" onclick="selectIcon(this)">
                                                <img src="images/asterisk.svg" alt="Asterisk" onclick="selectIcon(this)">
                                                <img src="images/atak.svg" alt="ATAK" onclick="selectIcon(this)">
                                                <img src="images/bilge.svg" alt="Bilge" onclick="selectIcon(this)">
                                                <img src="images/blower.svg" alt="Blower" onclick="selectIcon(this)">
                                                <img src="images/engine.svg" alt="engine" onclick="selectIcon(this)">
                                                <img src="images/gear.svg" alt="Gear" onclick="selectIcon(this)">                    
                                                <img src="images/latch.svg" alt="Latch" onclick="selectIcon(this)">
                                                <img src="images/radar.svg" alt="Radar" onclick="selectIcon(this)">
                                                <img src="images/starter.svg" alt="Starter" onclick="selectIcon(this)">
                                                <img src="images/timer.svg" alt="Timer" onclick="selectIcon(this)">
                                                <img src="images/toggle.svg" alt="Toggle" onclick="selectIcon(this)">
                                            </div>
                                        </div>


                                <!-- Function button area -->
                                        <div class="editor-options-row">
                                            <div class="editor-option-wrapper" data-mode="disabled" onclick="selectMode(this)">
                                                <div class="editor-option-block">
                                                    <img src="images/disabled.svg" alt="Disabled">
                                                </div>
                                                <span class="editor-option-label">Disabled</span>
                                            </div>

                                            <div class="editor-option-wrapper" data-mode="latch" onclick="selectMode(this)">
                                                <div class="editor-option-block">
                                                    <img src="images/latch.svg" alt="Latch">
                                                </div>
                                                <span class="editor-option-label">One Shot</span>
                                            </div>

                                            <div class="editor-option-wrapper" data-mode="toggle" onclick="selectMode(this)">
                                                <div class="editor-option-block">
                                                    <img src="images/toggle.svg" alt="Toggle">
                                                </div>
                                                <span class="editor-option-label">Momentary</span>
                                            </div>

                                            <div class="editor-option-wrapper" data-mode="timer" onclick="selectMode(this)">
                                                <div class="editor-option-block">
                                                    <img src="images/timer.svg" alt="Timer">
                                                </div>
                                                <span class="editor-option-label">Timer</span>
                                            </div>
                                        </div>

                                        
                                        <!-- Timer value box BELOW all buttons -->
                                        <div class="editor-value-box-wrapper">
                                            <div class="editor-value-box">
                                                <div class="editor-arrow-controls">
                                                    <button type="button" class="arrow-up" onclick="changeTimerValue(50)">▲</button>
                                                    <button type="button" class="arrow-down" onclick="changeTimerValue(-50)">▼</button>
                                                </div>
                                                <input type="number" min="100" max="9900" step="50" value="300" class="editor-value-input" />
                                                <span class="editor-unit-label">ms</span>
                                            </div>
                                        </div>



                                        <!-- input output value -->
                                        <div class="editor-custom-input-row">
                                        <label class="editor-custom-label">CAN</label>

                                        <!-- Первый блок: 0x 3 numbers -->
                                            <div class="editor-prefixed-wrapper bn-wrapper">
                                                <span class="editor-prefix">0x</span>
                                                <input type="text" maxlength="3" class="editor-prefixed-input" placeholder="###">
                                            </div>

                                        <!-- Второй блок: длинное значение -->
                                            <div class="editor-prefixed-wrapper hex-wrapper">
                                                <input type="text" maxlength="23" class="editor-custom-input long-input" placeholder="00 00 00 00 00 00 00 00">
                                            </div>
                                        </div>




                                        <div class="editor-custom-input-row">
                                        <label class="editor-custom-label">Next Command</label>
                                        <select class="editor-select">
                                            <option value="none">NONE</option>
                                            <option value="start">1-1 Actuator</option>
                                            <option value="stop">1-2 Engine</option>
                                            <option value="reset">1-3 12V</option>
                                        </select>
                                        </div>





                                        <!-- Cancel Apply buttons -->
                                        <div class="editor-modal-actions">
                                            <button class="editor-cancel-button">Cancel</button>
                                            <button class="editor-apply-button">Apply</button>
                                        </div>
                                    </div>
                            </div>
                </div>`;
                container.style.display = 'block';

            bindEditorEvents(); // event binding
        }

        // Modal inside //
        
                function selectIcon(element) {
                    let newSrc = element.getAttribute("src");
                    if (newSrc.includes("disabled.svg")) {
                        newSrc = "images/no-icon.svg";
                    }

                    const icon = document.querySelector(".editor-button-icon");
                    const capIcon = document.querySelector(".editor-cap-icon");

                    if (icon) {
                        icon.src = newSrc;
                        icon.style.display = "block";
                    }

                    if (capIcon) {
                        capIcon.src = newSrc;
                        capIcon.style.display = "block";
                    }

                    const iconPicker = document.getElementById("iconPicker");
                    if (iconPicker) iconPicker.style.display = "none";
                }


                function bindEditorEvents() {


            // Initialize Safety Cap state
            const cap = document.querySelector(".editor-cap-container");
            if (cap) {
                cap.classList.add("state-safety");

                cap.addEventListener("click", () => {
                    if (cap.classList.contains("state-safety")) {
                        cap.classList.remove("state-safety");
                        cap.classList.add("state-no-cap");
                    } else {
                        cap.classList.remove("state-no-cap");
                        cap.classList.add("state-safety");
                    }
                });
            }

            // Select mode (disabled, latch, toggle, timer)
            document.querySelectorAll(".editor-option-wrapper").forEach(wrapper => {
                wrapper.addEventListener("click", () => {
                    document.querySelectorAll(".editor-option-wrapper").forEach(item => {
                        item.classList.remove("active");
                    });
                    wrapper.classList.add("active");

                    const selectedMode = wrapper.getAttribute("data-mode");
                    const modalWindow = document.querySelector(".editor-modal-window");
                    const input = document.querySelector(".editor-value-input");

                    if (selectedMode === "timer") {
                        modalWindow.classList.add("timer-active");
                        input.removeAttribute("disabled");
                    } else {
                        modalWindow.classList.remove("timer-active");
                        input.setAttribute("disabled", true);
                    }
                });
            });

            // Timer: arrow up/down buttons
            document.querySelectorAll(".editor-arrow-controls button").forEach(btn => {
                btn.addEventListener("click", () => {
                    const delta = btn.classList.contains("arrow-up") ? 50 : -50;
                    const input = document.querySelector(".editor-value-input");
                    let value = parseInt(input.value) || 0;
                    value += delta;
                    if (value < 100) value = 100;
                    if (value > 9900) value = 9900;
                    input.value = value;
                });
            });

                // Editable label
                const label = document.querySelector(".editor-button-label");
                if (label) {
            
                    // Character limit (18 max)
                    label.addEventListener("input", () => {
                        if (label.textContent.length > 18) {
                            label.textContent = label.textContent.slice(0, 18);
                            placeCaretAtEnd(label); // keep cursor from jumping
                        }
                    });

                    label.addEventListener("keydown", (e) => {
                        if (e.key === "Enter") {
                            e.preventDefault(); // prevent line break
                        }
                    });


                    label.addEventListener("blur", () => {
                        if (label.textContent.trim() !== "") {
                            label.classList.add("edited");
                        } else {
                            label.classList.remove("edited");
                        }
                    });
                }

                // Icon picker popup
                const iconPicker = document.getElementById("iconPicker");
                const iconBtn = document.querySelector(".editor-preview-button");
                if (iconBtn && iconPicker) {
                    iconBtn.addEventListener("click", () => {
                        iconPicker.style.display = "block";
                    });
                }

                

            // Cancel button — reset everything
            const modalWindow = document.querySelector(".editor-modal-window");
            const cancelBtn = modalWindow?.querySelector(".editor-cancel-button");


            if (cancelBtn) {
                cancelBtn.addEventListener("click", () => {
                    document.querySelectorAll(".editor-option-wrapper").forEach(item => {
                        item.classList.remove("active");
                    });
                    const defaultMode = document.querySelector('.editor-option-wrapper[data-mode="disabled"]');
                    if (defaultMode) defaultMode.classList.add("active");

                    const label = document.querySelector(".editor-button-label");
                    if (label) {
                        label.textContent = " Label ";
                        label.classList.remove("edited");
                    }

                    const icon = document.querySelector(".editor-button-icon");
                    if (icon) {
                        icon.src = "images/unknown.svg";
                        icon.style.display = "block";
                        icon.style.filter = "";
                    }

                    const cap = document.querySelector(".editor-cap-container");
                    if (cap) {
                        cap.classList.remove("state-no-cap");
                        cap.classList.add("state-safety");
                    }

                    const input = document.querySelector(".editor-value-input");
                    if (input) {
                        input.value = "300";
                        input.setAttribute("disabled", true);
                    }

                    const modalWindow = document.querySelector(".editor-modal-window");
                    modalWindow.classList.remove("timer-active");

                    closeEditModal();
                });
            }

            // Apply button — return the current settings
            const applyBtn = document.querySelector(".editor-apply-button");
            if (applyBtn) {
                applyBtn.addEventListener("click", () => {
                    const mode = document.querySelector(".editor-option-wrapper.active")?.getAttribute("data-mode") || "none";
                    const label = document.querySelector(".editor-button-label")?.textContent.trim() || "";
                    const icon = document.querySelector(".editor-button-icon")?.getAttribute("src") || "";
                    const hasCap = document.querySelector(".editor-cap-container")?.classList.contains("state-safety") || false;
                    const timerValue = document.querySelector(".editor-value-input")?.value || "0";

                    const result = { mode, label, icon, safetyCap: hasCap, timer: timerValue };

                    console.log("Settings applied:", result);

                    applySettingsToButton(result);
                });
            }
        }

        // Character limit (18 max) //

        function placeCaretAtEnd(el) {
            const range = document.createRange();
            const sel = window.getSelection();
            range.selectNodeContents(el);
            range.collapse(false);
            sel.removeAllRanges();
            sel.addRange(range);
        }



    </script>

    <!-- SCRIPT // MODAL TRIM -->
    <script>

                function openTrimModal() {
                    document.getElementById("trim-modal-container").style.display = "block";


                                    const thumb = document.getElementById('trim-thumb');
                                    const fill = document.getElementById('trim-fill');
                                    const pointer = document.querySelector('.trim-pointer-img');
        const readout = document.getElementById('trim-readout');
                                    const sliderWrapper = document.querySelector('.trim-slider-wrapper');

                                    if (thumb && fill && pointer && sliderWrapper) {
                                    thumb.onmousedown = function (e) {
                                        e.preventDefault();
                                        document.onmousemove = function (e) {
                                        const rect = sliderWrapper.getBoundingClientRect();
                                        const minY = rect.top;
                                        const maxY = rect.bottom;




                                        
                                        let posY = e.clientY;

                                        posY = Math.max(minY, Math.min(posY, maxY));

                                        const percent = (posY - minY) / (maxY - minY);
                                        const thumbY = percent * sliderWrapper.offsetHeight;

                                        thumb.style.top = `${thumbY}px`;
                                        fill.style.height = `${(1 - percent) * 100}%`;

                                        const angle = -15 + percent * 30;
                                pointer.style.transform = `rotate(${angle}deg)`;
                                if (readout) {
                                    const scaled = (1 - percent) * 1.5;
                                    let value = Math.floor(scaled * 15);
                                    if (value > 15) value = 'UP';
                                    else if (value < 0) value = 0;
                                    readout.textContent = value;
                                }
                                if (readout) {
                                }
                                        };

                                        document.onmouseup = function () {
                                        document.onmousemove = null;
                                        };
                                    };
                                    }


                    document.getElementById("trim-modal-backdrop").style.display = "block";
                    

                }

                function closeTrimModal() {
                    document.getElementById("trim-modal-container").style.display = "none";
                    document.getElementById("trim-modal-backdrop").style.display = "none";
                }

                function applyTrimSettings() {
                    console.log("Apply Trim pressed");
                    closeTrimModal();
                }



                /* SLIDER */
                const thumb = document.getElementById('trim-thumb');
                const fill = document.getElementById('trim-fill');
                const pointer = document.querySelector('.trim-pointer-img');
                    thumb.onmousedown = function (e) {
                        e.preventDefault();
                        document.onmousemove = function (e) {
                            const slider = document.querySelector('.trim-slider-wrapper');
                            const rect = slider.getBoundingClientRect();
                            const minY = rect.top;
                            const maxY = rect.bottom;
                            let posY = e.clientY;

                            if (posY < minY) posY = minY;
                            if (posY > maxY) posY = maxY;

                            const percent = 1 - (posY - minY) / (maxY - minY);
                            const newTop = percent * 100;
                            thumb.style.top = `${percent * 100}%`;
                            fill.style.height = `${percent * 100}%`;

                            const angle = Math.round((percent * 30) - 15); // from -15° to +15°
                            if (pointer) {
                                    pointer.style.transform = `rotate(${angle}deg)`;
                                    if (readout) {
                                        const raw = Math.round((1 - percent) * 14) + 1;
                                        readout.textContent = raw > 15 ? 'UP' : (raw < 1 ? 1 : raw);

                                    }
                if (readout) {
                }
                            }
                            };
                        document.onmouseup = () => {
                        document.onmousemove = null;
                    };
                };


                /* SLIDER button */

                window.onload = function () {
                        const thumb = document.getElementById('trim-thumb');
                        const fill = document.getElementById('trim-fill');
                        const pointer = document.querySelector('.trim-pointer-img');
                        const sliderWrapper = document.querySelector('.trim-slider-wrapper');
                        if (!thumb || !fill || !pointer || !sliderWrapper || !readout) {
                            console.warn("Missing slider element(s)");
                            return;
                        }

                        const edgeOffset = 16; // Top and bottom 
                        



                        thumb.onmousedown = function (e) {
                            e.preventDefault();

                            document.onmousemove = function (e) {
                                    const rect = sliderWrapper.getBoundingClientRect();
                                    const fullHeight = rect.height;
                                    const usableHeight = fullHeight - edgeOffset * 2;
                                    let mouseY = e.clientY - rect.top - edgeOffset;

                                    // Clamp inside the usable range
                                    mouseY = Math.max(0, Math.min(mouseY, usableHeight));

                                    // Update thumb position
                                    thumb.style.top = `${mouseY + edgeOffset}px`;

                                    // Update fill bar
                                    const percent = mouseY / usableHeight;
                                    fill.style.height = `${(1 - percent) * 100}%`;

                                    // Rotate pointer
                                    const angle = -60 + percent * 30;
                                    pointer.style.transform = `rotate(${angle}deg)`;
                                    if (readout) {
                                    const raw = Math.round((1 - percent) * 14) + 1;
                                        readout.textContent = raw > 15 ? 'UP' : (raw < 1 ? 1 : raw);


                                    }
                if (readout) {
                }

                                    // ✅ Update readout value
                                    };

                        };

                        document.onmouseup = function () {
                            document.onmousemove = null;
                        };
                    

                };
                
    </script>

    <!-- SCRIPT // MODAL THROTTLE -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const gearTrack = document.querySelector(".gear-track");
        const gearThumb = document.querySelector(".gear-thumb");
        const gearFill = document.getElementById("gear-fill");
        const thumbText = gearThumb?.querySelector(".gear-thumb-text");

        if (!gearTrack || !gearThumb || !gearFill) return;

        const VISUAL_MAX = 95;       // maximum visual range (%)
        const VISUAL_HALF = VISUAL_MAX / 2;
        const EDGE_PADDING = 12;
        const STEP = 0.5;

        let logicalPercent = 0;      // value from -1 to +1
        let isDragging = false;

        function renderSlider(logical) {
            const clamped = Math.max(-1, Math.min(1, logical));
            const visualOffset = clamped * VISUAL_HALF;
            const visualBottom = 50 - visualOffset;

            // Move thumb
            gearThumb.style.bottom = `${visualBottom}%`;

            // Fill
            gearFill.style.height = `${Math.abs(visualOffset)}%`;
            if (visualOffset >= 0) {
                gearFill.style.top = '50%';
                gearFill.style.bottom = 'auto';
            } else {
                gearFill.style.bottom = '50%';
                gearFill.style.top = 'auto';
            }

            // Label
        if (thumbText) {
    const percentValue = Math.round(Math.abs(clamped) * 100);
    if (Math.abs(clamped) < 0.1) {
        thumbText.textContent = 'NEUTRAL';
    } else {
        thumbText.textContent = `${percentValue}%`;
    }
    }

        }

        function updateSliderFromMouse(clientY) {
            const rect = gearTrack.getBoundingClientRect();
            const centerY = rect.height / 2;
            const minY = rect.top + EDGE_PADDING;
            const maxY = rect.bottom - EDGE_PADDING;

            const usableHeight = maxY - minY;
    const posY = Math.max(minY, Math.min(clientY, maxY)) - minY;
    const offset = posY - usableHeight / 2;
    logicalPercent = offset / (usableHeight / 2);


            renderSlider(logicalPercent);
        }

        // Start dragging
        gearThumb.addEventListener("mousedown", (e) => {
            isDragging = true;
            updateSliderFromMouse(e.clientY);
            e.preventDefault();
        });

        // Update while dragging
        document.addEventListener("mousemove", (e) => {
            if (isDragging) updateSliderFromMouse(e.clientY);
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
        });

        // ▲▼ control buttons
        function moveThrottle(up = true) {
            logicalPercent += (up ? -1 : 1) * (STEP / VISUAL_HALF);
            logicalPercent = Math.max(-1, Math.min(1, logicalPercent));
            renderSlider(logicalPercent);
        }

        document.querySelector(".throttle-up")?.addEventListener("click", () => moveThrottle(true));
        document.querySelector(".throttle-down")?.addEventListener("click", () => moveThrottle(false));
    });











    
    </script>

    <!-- BOAT // Rudder & Trim GAUGE row -->
    <script>
        // BOAT // Rudder & Trim data bindings
        // - Non-invasive bridge: reads existing DOM state and mirrors it to the new row.
        // - No changes to existing logic elsewhere.

        /* eslint-disable no-undef */
        (function () {
        // Cache DOM nodes once
        const rudderEl   = document.getElementById('rudder-angle-value');
        const trimEl     = document.getElementById('trim-value');
        const rudderWrap = document.getElementById('boat-rudder-stat');
        const trimWrap   = document.getElementById('boat-trim-stat');

        /** Format number for display (integer, keep sign) */
        function fmtInt(n) {
            const v = Math.round(Number(n) || 0);
            return v.toString();
        }

        /** Brief visual tick to indicate fresh data */
        function blip(el) {
            el && el.classList.add('updating');
            setTimeout(() => el && el.classList.remove('updating'), 120);
        }

        /** Public: update Rudder Angle in degrees */
        window.updateRudderAngle = function(angleDeg) {
            if (rudderEl) {
            rudderEl.textContent = fmtInt(angleDeg);
            blip(rudderWrap);
            }
        };

        /** Public: update Trim in degrees */
        window.updateTrim = function(trimDeg) {
            if (trimEl) {
            trimEl.textContent = fmtInt(trimDeg);
            blip(trimWrap);
            }
        };

        // ------------------------------
        // Auto-bridges (no logic changes)
        // ------------------------------

        // Rudder sources we can read from (whichever exists)
        const rudderInput   = document.getElementById('rudder-input');     // text/number field
        const rudderPointer = document.getElementById('rudder-pointer');   // SVG pointer with rotate()

        // Trim source: existing readout near the slider (text content with degrees)
        const trimReadout = document.querySelector('.trim-readout');

        // Last pushed values to avoid redundant DOM writes
        let lastRudderDeg = null;
        let lastTrimDeg   = null;

        /** Read current rudder angle from DOM without touching existing logic */
        function readRudderDeg() {
            // 1) Prefer explicit input value if present
            if (rudderInput && rudderInput.value !== '') {
            const v = Number(rudderInput.value);
            if (!Number.isNaN(v)) return v;
            }
            // 2) Else derive from pointer's transform rotate(A, cx, cy)
            if (rudderPointer) {
            const tr = rudderPointer.getAttribute('transform') || '';
            // Expect pattern like: rotate(XX, 144, 0)
            const m = tr.match(/rotate\(\s*(-?\d+(?:\.\d+)?)\s*,/);
            if (m) {
                const visual = Number(m[1]);      // visual angle
                // In many setups pointer rotates opposite sign to logical rudder.
                // If your UI uses inverted rotate, flip the sign here:
                return -visual;
            }
            }
            return null;
        }

        /** Read current trim angle from existing readout ".trim-readout" */
        function readTrimDeg() {
            if (!trimReadout) return null;
            const txt = (trimReadout.textContent || '').trim();
            // Accept forms like "-7", "-7°", " -7 deg " etc.
            const m = txt.match(/-?\d+/);
            if (m) return Number(m[0]);
            return null;
        }

        /** Push to public updaters only when value actually changed */
        function syncOnce() {
            const r = readRudderDeg();
            if (r !== null && r !== lastRudderDeg) {
            lastRudderDeg = r;
            window.updateRudderAngle(r);
            }
            const t = readTrimDeg();
            if (t !== null && t !== lastTrimDeg) {
            lastTrimDeg = t;
            window.updateTrim(t);
            }
        }

        // Use rAF loop for smooth, non-blocking sync with existing animations/dragging
        let rafId;
        function loop() {
            syncOnce();
            rafId = window.requestAnimationFrame(loop);
        }
        loop();

        // Also observe textual changes in trim readout (extra safety)
        if (trimReadout && 'MutationObserver' in window) {
            const mo = new MutationObserver(syncOnce);
            mo.observe(trimReadout, { childList: true, characterData: true, subtree: true });
        }

        // If rudder input exists and user types manually, reflect immediately
        if (rudderInput) {
            ['input','change','keyup'].forEach(evt =>
            rudderInput.addEventListener(evt, syncOnce, { passive: true })
            );
        }

        // Cleanup on unload
        window.addEventListener('beforeunload', () => {
            if (rafId) cancelAnimationFrame(rafId);
        });
        })();
    </script>

    <!-- SCRIPT // MODAL RULE RUDDER ANGLE INDICATOR -->
    <script>
            function setRudderAngle(angle) {
            const pointer = document.getElementById("rudder-pointer");
            const centerX = 144;
            const centerY = 0;

            // 0° points down, +angle = starboard, -angle = port
            const visualAngle = -angle;

            pointer.setAttribute("transform", `rotate(${visualAngle}, ${centerX}, ${centerY})`);
            }


            /**
             * Reads the angle from the input field and applies it to the pointer.
             * Ensures the angle stays within the allowed range (-35 to +35).
             */
            function updateRudderFromInput() {
            const input = document.getElementById("rudder-input");
            let angle = parseInt(input.value, 10);

            // Validate and clamp value
            if (isNaN(angle)) angle = 0;
            angle = Math.max(-35, Math.min(35, angle));

            setRudderAngle(angle);
            }

            /**
             * Automatically initialize the pointer when the page loads.
             */
            window.addEventListener("DOMContentLoaded", () => {
            updateRudderFromInput();
            });



    </script>

    <!-- SCRIPT // Logitech F310 -->

            <!-- Left/Right Screen -->
            <script>
                let screenGamepadIndex = null;
                let wasPressedLeft = false;
                let wasPressedRight = false;

                window.addEventListener("gamepadconnected", (event) => {
                    if (screenGamepadIndex === null) {
                    screenGamepadIndex = event.gamepad.index;
                    console.log("Screen nav connected at index", screenGamepadIndex);
                    }
                });

                window.addEventListener("gamepaddisconnected", () => {
                    screenGamepadIndex = null;
                });

                function pollScreenNavigation() {
                    if (screenGamepadIndex !== null) {
                    const gamepad = navigator.getGamepads()[screenGamepadIndex];
                    if (gamepad) {
                        // Left (B4)
                        if (gamepad.buttons[4].pressed && !wasPressedLeft) {
                        document.getElementById("prev-screen").click();
                        wasPressedLeft = true;
                        } else if (!gamepad.buttons[4].pressed) {
                        wasPressedLeft = false;
                        }

                        // Right (B5)
                        if (gamepad.buttons[5].pressed && !wasPressedRight) {
                        document.getElementById("next-screen").click();
                        wasPressedRight = true;
                        } else if (!gamepad.buttons[5].pressed) {
                        wasPressedRight = false;
                        }
                    }
                    }
                    requestAnimationFrame(pollScreenNavigation);
                }

                pollScreenNavigation();
            </script>

            <!-- Trim Modal -->
            <script>
            let trimGamepadIndex = null;
            let isTrimOpen = false;
            let trimHideTimeout = null;
            let wasPressedUp = false;
            let wasPressedDown = false;

            window.addEventListener("gamepadconnected", (event) => {
                if (trimGamepadIndex === null) {
                trimGamepadIndex = event.gamepad.index;
                console.log("Trim control connected at index", trimGamepadIndex);
                }
            });

            window.addEventListener("gamepaddisconnected", () => {
                trimGamepadIndex = null;
            });

            function showTrimModal() {
                if (!isTrimOpen) {
                document.getElementById("trim-modal-backdrop").style.display = "block";
                document.getElementById("trim-modal-container").style.display = "block";
                isTrimOpen = true;
                }
                if (trimHideTimeout) clearTimeout(trimHideTimeout);
            }

            function hideTrimModalDelayed() {
                trimHideTimeout = setTimeout(() => {
                document.getElementById("trim-modal-backdrop").style.display = "none";
                document.getElementById("trim-modal-container").style.display = "none";
                isTrimOpen = false;
                }, 1500);
            }

            function moveTrimThumb(direction) {
                const thumb = document.getElementById("trim-thumb");
                const currentTop = parseFloat(thumb.style.top || "50");
                let newTop = currentTop + direction;
                newTop = Math.max(0, Math.min(100, newTop));
                thumb.style.top = newTop + "%";
            }

            function pollTrimControl() {
                if (trimGamepadIndex !== null) {
                const gamepad = navigator.getGamepads()[trimGamepadIndex];
                if (gamepad) {
                    const upPressed = gamepad.buttons[12].pressed;
                    const downPressed = gamepad.buttons[13].pressed;

                    // UP (B12)
                    if (upPressed && !wasPressedUp) {
                    showTrimModal();
                    moveTrimThumb(-5);
                    wasPressedUp = true;
                    } else if (!upPressed) {
                    if (wasPressedUp && !downPressed) hideTrimModalDelayed();
                    wasPressedUp = false;
                    }

                    // DOWN (B13)
                    if (downPressed && !wasPressedDown) {
                    showTrimModal();
                    moveTrimThumb(5);
                    wasPressedDown = true;
                    } else if (!downPressed) {
                    if (wasPressedDown && !upPressed) hideTrimModalDelayed();
                    wasPressedDown = false;
                    }
                }
                }

                requestAnimationFrame(pollTrimControl);
            }

            pollTrimControl();
            </script>
                        
            <!-- Rudder Angle -->
            <script>
            let rudderGamepadIndex = null;
            let rudderAngle = 0; // value in degrees, -35 to +35

            window.addEventListener("gamepadconnected", (event) => {
                if (rudderGamepadIndex === null) {
                    rudderGamepadIndex = event.gamepad.index;
                    console.log("Rudder control connected at index", rudderGamepadIndex);
                }
            });

            window.addEventListener("gamepaddisconnected", () => {
                rudderGamepadIndex = null;
            });

            function updateRudderPointer(angle) {
                const pointer = document.getElementById("rudder-pointer");
                if (pointer) {
                    const visualAngle = -angle; // inverted for SVG
                    pointer.setAttribute("transform", `rotate(${visualAngle}, 144, 0)`);
                }

                const input = document.getElementById("rudder-input");
                if (input) {
                    input.value = Math.round(angle);
                }
            }

            function pollRudderControl() {
                if (rudderGamepadIndex !== null) {
                    const gamepad = navigator.getGamepads()[rudderGamepadIndex];
                    if (gamepad) {
                        const raw = gamepad.axes[2]; // AXIS 2
                        const deadzone = 0.1;

                        if (Math.abs(raw) > deadzone) {
                            // Accumulate angle over time
                            rudderAngle += raw * 0.8; // Speed of change — adjust if needed
                            rudderAngle = Math.max(-35, Math.min(35, rudderAngle));
                        }

                        updateRudderPointer(rudderAngle);
                    }
                }

                requestAnimationFrame(pollRudderControl);
            }

            pollRudderControl();

            function updateRudderFromInput() {
                const input = document.getElementById("rudder-input");
                if (!input) return;

                let value = parseInt(input.value);
                if (isNaN(value)) value = 0;
                rudderAngle = Math.max(-35, Math.min(35, value));

                updateRudderPointer(rudderAngle);
            }
            </script>

            <!-- Throttle -->
            <!-- SCRIPT // MODAL THROTTLE -->
            <script>
            document.addEventListener("DOMContentLoaded", () => {
            const gearTrack = document.querySelector(".gear-track");
            const gearThumb = document.querySelector(".gear-thumb");
            const gearFill = document.getElementById("gear-fill");
            const thumbText = gearThumb?.querySelector(".gear-thumb-text");
            const wrapper = document.querySelector(".throttle-wrapper");
            const indicator = document.getElementById("throttle-indicator");
            const indicatorText = indicator?.querySelector(".throttle-char");

            if (!gearTrack || !gearThumb || !gearFill || !wrapper || !thumbText || !indicatorText) return;

            const VISUAL_MAX = 95;
            const VISUAL_HALF = VISUAL_MAX / 2;
            const EDGE_PADDING = 12;
            const STEP = 0.5;
            const STICKY_ZONE = 0.1;
            const RESET_ZONE = 0.2;

            let logicalPercent = 0;
            let isDragging = false;
            let throttleExpandTimeout = null;
            let stickyBarrierActive = false;
            let stickyNeutralActive = false;
            let wasZone = "neutral";

            function expandThrottleUI() {
                wrapper.classList.add("expanded");
                if (throttleExpandTimeout) clearTimeout(throttleExpandTimeout);
                throttleExpandTimeout = setTimeout(() => {
                wrapper.classList.remove("expanded");
                }, 1000);
            }


            function renderSlider(logical) {
            const clamped = Math.max(-1, Math.min(1, logical));
            const visualOffset = clamped * VISUAL_HALF;
            const visualBottom = 50 + visualOffset;

            gearThumb.style.bottom = `${visualBottom}%`;
            gearFill.style.height = `${Math.abs(visualOffset)}%`;
            gearFill.style.top = visualOffset < 0 ? '50%' : 'auto';
            gearFill.style.bottom = visualOffset >= 0 ? '50%' : 'auto';

            if (Math.abs(clamped) < STICKY_ZONE) {
                thumbText.innerHTML = `
                <span class="text-n">N</span>
                <span class="text-neutral">NEUTRAL</span>
                `;
            } else {
                thumbText.textContent = `${Math.round(Math.abs(clamped) * 100)}%`;
            }
            }


  

            function showThrottleIndicator(letter) {
                indicatorText.textContent = letter;
                indicator.classList.add("show");
                setTimeout(() => {
                indicator.classList.remove("show");
                }, 500);
            }

            function updateSliderFromMouse(clientY) {
                const rect = gearTrack.getBoundingClientRect();
                const minY = rect.top + EDGE_PADDING;
                const maxY = rect.bottom - EDGE_PADDING;
                const usableHeight = maxY - minY;
                const posY = Math.max(minY, Math.min(clientY, maxY)) - minY;
                const offset = usableHeight / 2 - posY;

                logicalPercent = offset / (usableHeight / 2);
                logicalPercent = Math.max(-1, Math.min(1, logicalPercent));

                renderSlider(logicalPercent);
            }

            gearThumb.addEventListener("mousedown", (e) => {
                isDragging = true;
                updateSliderFromMouse(e.clientY);
                e.preventDefault();
            });

            document.addEventListener("mousemove", (e) => {
                if (isDragging) updateSliderFromMouse(e.clientY);
            });

            document.addEventListener("mouseup", () => {
                isDragging = false;
            });

            function moveThrottle(up = true) {
                logicalPercent += (up ? 1 : -1) * (STEP / VISUAL_HALF);
                logicalPercent = Math.max(-1, Math.min(1, logicalPercent));
                renderSlider(logicalPercent);
            }

            document.querySelector(".throttle-up")?.addEventListener("click", () => moveThrottle(true));
            document.querySelector(".throttle-down")?.addEventListener("click", () => moveThrottle(false));

            let throttleGamepadIndex = null;

            window.addEventListener("gamepadconnected", (event) => {
                if (throttleGamepadIndex === null) {
                throttleGamepadIndex = event.gamepad.index;
                console.log("Throttle connected at index", throttleGamepadIndex);
                }
            });

            window.addEventListener("gamepaddisconnected", () => {
                throttleGamepadIndex = null;
            });




            function determineThrottleLetter(prevValue, currentValue, raw) {
            const isNeutralNow = Math.abs(currentValue) <= STICKY_ZONE;
            const wasNeutral = Math.abs(prevValue) <= STICKY_ZONE;

            if (wasNeutral && currentValue > STICKY_ZONE && raw > 0) return "F";
            if (wasNeutral && currentValue < -STICKY_ZONE && raw < 0) return "R";
            if (!wasNeutral && isNeutralNow) return "N";
            if (currentValue > STICKY_ZONE && raw > 0) return "F";
            if (currentValue < -STICKY_ZONE && raw < 0) return "R";
            if (isNeutralNow && Math.abs(raw) < STICKY_ZONE) return "N";

            return null;
            }








            function pollThrottleControl() {
            if (throttleGamepadIndex !== null) {
                const gamepad = navigator.getGamepads()[throttleGamepadIndex];
                if (gamepad) {
                const raw = gamepad.axes[1];
                const deadzone = 0.1;

                // Reset sticky flags if in center zone
                if (Math.abs(raw) < RESET_ZONE) {
                    stickyBarrierActive = false;
                    stickyNeutralActive = false;
                }

                // If joystick is mostly centered, don't update
                if (Math.abs(raw) <= deadzone) {
                    renderSlider(logicalPercent); // raw не нужен тут
                    requestAnimationFrame(pollThrottleControl);
                    return;
                }

                const prevValue = logicalPercent;
                logicalPercent -= raw * 0.02;
                logicalPercent = Math.max(-1, Math.min(1, logicalPercent));

                const fromAbove = prevValue > STICKY_ZONE && logicalPercent <= STICKY_ZONE;
                const intoForward = prevValue < STICKY_ZONE && logicalPercent >= STICKY_ZONE;
                const fromBelow = prevValue < -STICKY_ZONE && logicalPercent >= -STICKY_ZONE;
                const intoReverse = prevValue > -STICKY_ZONE && logicalPercent <= -STICKY_ZONE;

                // If latch is active — hold at boundary and show N
                if (stickyBarrierActive) {
                    logicalPercent = prevValue > 0 ? STICKY_ZONE : -STICKY_ZONE;
                    showThrottleIndicator("N");
                    renderSlider(logicalPercent, raw);
                    requestAnimationFrame(pollThrottleControl);
                    return;
                }

                // Snap into forward/reverse barrier
                if (fromAbove || intoForward) {
                    logicalPercent = STICKY_ZONE;
                    stickyBarrierActive = true;
                    showThrottleIndicator("N");
                } else if (fromBelow || intoReverse) {
                    logicalPercent = -STICKY_ZONE;
                    stickyBarrierActive = true;
                    showThrottleIndicator("N");
                }

                const crossedNeutral =
                    (prevValue > 0 && logicalPercent < 0) ||
                    (prevValue < 0 && logicalPercent > 0);

                // Center snap
                if (stickyNeutralActive) {
                    logicalPercent = 0;
                    showThrottleIndicator("N");
                    renderSlider(logicalPercent, raw);
                    requestAnimationFrame(pollThrottleControl);
                    return;
                }

                if (crossedNeutral) {
                    logicalPercent = 0;
                    stickyNeutralActive = true;
                    showThrottleIndicator("N");
                }

                // Show indicators based on direction
                if (Math.abs(logicalPercent) <= STICKY_ZONE && raw < 0) {
                    console.log("NEUTRAL zone — joystick forward");
                    showThrottleIndicator("F");
                } else if (logicalPercent > STICKY_ZONE && raw < 0) {
                    console.log("Zone: FORWARD", "logical:", logicalPercent.toFixed(2), "raw:", raw.toFixed(2));
                    showThrottleIndicator("F");
                } else if (logicalPercent < -STICKY_ZONE && raw > 0) {
                    console.log("Zone: REVERSE", "logical:", logicalPercent.toFixed(2), "raw:", raw.toFixed(2));
                    showThrottleIndicator("R");
                }







                    

            // NEUTRAL zone — touching FORWARD edge
            if (Math.abs(logicalPercent) <= STICKY_ZONE && logicalPercent > 0) {
            console.log("NEUTRAL zone — touching FORWARD edge");
            showThrottleIndicator("F");
            }




            if (logicalPercent > STICKY_ZONE && raw < 0) {
            console.log("Zone: FORWARD", "logical:", logicalPercent.toFixed(2), "raw:", raw.toFixed(2));
            showThrottleIndicator("F");
            } else if (logicalPercent < -STICKY_ZONE && raw > 0) {
            console.log("Zone: REVERSE", "logical:", logicalPercent.toFixed(2), "raw:", raw.toFixed(2));
            showThrottleIndicator("R");
            }






                    expandThrottleUI();
                    renderSlider(logicalPercent);
                }
                }

                requestAnimationFrame(pollThrottleControl);
            }

            pollThrottleControl();
            });
            </script>

    <!-- MODAL GAUGES PANEL -->
    <script>
    // === Safety block smart placement ===
    // Moves safety-block to the right of gauges-panel if it overlaps the footer.

    document.addEventListener('DOMContentLoaded', () => {
    const parent  = document.querySelector('.gauges-button-panel');
    const panel   = parent?.querySelector('.gauges-panel');
    const safety  = parent?.querySelector('.safety-block');
    const footer  = document.querySelector('footer, .footer, #footer'); // try common footer hooks

    if (!parent || !panel || !safety || !footer) return;

    // Check viewport overlap between safety-block and footer
    const overlapsFooter = () => {
        const s = safety.getBoundingClientRect();
        const f = footer.getBoundingClientRect();
        return s.bottom > f.top && s.top < f.bottom; // vertical intersection
    };

    // Place safety under the panel (default stacked layout)
    const placeStacked = () => {
        parent.classList.remove('side-safety');
        safety.style.position = '';    // back to normal flow
        safety.style.top = '';
        safety.style.left = '';
        safety.style.marginTop = 'auto';
    };

    // Place safety to the right of the panel, bottom-aligned to panel
    const placeSide = () => {
        parent.classList.add('side-safety');

        // Compute coordinates relative to the parent
        const leftPx = panel.offsetWidth + 12; // 12px gap to the right of the panel
        const topPx  = (panel.offsetTop + panel.offsetHeight) - safety.offsetHeight;

        safety.style.position = 'absolute';
        safety.style.left = `${leftPx}px`;
        safety.style.top  = `${topPx}px`;
        safety.style.marginTop = '0';
    };

    const update = () => {
        // Start from stacked to measure true overlap
        placeStacked();
        // Next frame, evaluate overlap and possibly move aside
        requestAnimationFrame(() => {
        if (overlapsFooter()) placeSide();
        });
    };

    // Recalculate on resize/scroll (footer visibility/position changes)
    window.addEventListener('resize', update, { passive: true });
    window.addEventListener('scroll',  update, { passive: true });

    update();
    });
    </script>




    <!-- MODAL DRAWER PANEL -->
    <script>
    // Drawer tabs switching (data-tab = 1..8)
        (function () {
            const tabsRoot = document.getElementById('drawerTabs');      // tabs container
            const contentRoot = document.getElementById('drawerContent'); // panes container
            if (!tabsRoot || !contentRoot) return;

            const tabs  = Array.from(tabsRoot.querySelectorAll('.drawer-tab'));
            const panes = Array.from(contentRoot.querySelectorAll('.tab-pane'));

            // Activate a tab/pane by number
            function activate(n) {
            // 1) switch tab visuals
            tabs.forEach(t => t.classList.remove('active'));
            const tab = tabs.find(t => Number(t.dataset.tab) === n);
            if (tab) tab.classList.add('active');

            // 2) switch content panes
            panes.forEach(p => p.classList.remove('active'));
            const pane = panes.find(p => Number(p.dataset.tab) === n);
            if (pane) pane.classList.add('active');
            }

            // Click handlers for each tab
            tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const n = Number(tab.dataset.tab);
                activate(n);
            });
            // Accessibility: keyboard support
            tab.setAttribute('tabindex', '0');
            tab.setAttribute('role', 'tab');
            tab.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                activate(Number(tab.dataset.tab));
                }
            });
            });

            // Ensure initial state matches the HTML (active on load)
            const initial = tabs.find(t => t.classList.contains('active'));
            activate(initial ? Number(initial.dataset.tab) : 1);
        })();
    </script>

        <!-- TAB 1: Boat Control -->
        <script>
                // Communication toggle: updates display from button data attributes
                    document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.comm-block').forEach(block => {
                        const displaySignal = block.querySelector('[data-key="signal"]');
                        const displayDbm    = block.querySelector('[data-key="dbm"]');
                        const buttons       = block.querySelectorAll('.comm-toggle .comm-btn');

                        // helper: apply values from a button
                        const applyFromBtn = (btn) => {
                        if (displaySignal) displaySignal.textContent = btn.dataset.signal ?? '--';
                        if (displayDbm)    displayDbm.textContent    = btn.dataset.dbm ?? '--';
                        };

                        // init: set from the pre-active button
                        const active = block.querySelector('.comm-btn.active') || buttons[0];
                        if (active) applyFromBtn(active);

                        // click handling
                        block.querySelector('.comm-toggle').addEventListener('click', (e) => {
                        const btn = e.target.closest('.comm-btn');
                        if (!btn) return;
                        buttons.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        applyFromBtn(btn);
                        });
                    });
                    });


            /* === SOLO toggle styles (scoped) === */
                // JS scoped only to .solo-toggle to avoid collisions with existing handlers
                document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.solo-toggle').forEach(group => {
                    group.addEventListener('click', (e) => {
                    const btn = e.target.closest('.solo-btn');
                    if (!btn || !group.contains(btn)) return;

                    // clear and set active within this isolated group
                    group.querySelectorAll('.solo-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    // No display to update here; extend later if needed
                    });
                });
                });


            /* === SOLO3 toggle styles (scoped) === */
                // Scoped JS only for .solo3-toggle
                document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.solo3-toggle').forEach(group => {
                    group.addEventListener('click', (e) => {
                    const btn = e.target.closest('.solo3-btn');
                    if (!btn || !group.contains(btn)) return;

                    // Clear and set active
                    group.querySelectorAll('.solo3-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    // Example: log or later update display if needed
                    console.log("Selected:", btn.textContent, btn.dataset.value);
                    });
                });
                });

            /* === Pump === */
                document.addEventListener('DOMContentLoaded', () => {
                    document.querySelectorAll('.half-relay').forEach(group => {
                    const autoBtn = group.querySelector('.relay-btn.auto');
                    const onBtn   = group.querySelector('.relay-btn.on');

                    const clearStates = () => {
                        [autoBtn, onBtn].forEach(b => {
                        b.classList.remove('active');
                        b.classList.remove('live');
                        });
                    };

                    const getAutoLiveTarget = () => {
                        return (group.dataset.liveDefault || 'on').toLowerCase() === 'on' ? onBtn : autoBtn;
                    };

                    const setMode = (mode) => {
                        clearStates();

                        if (mode === 'auto') {
                        autoBtn.classList.add('active');
                        getAutoLiveTarget().classList.add('live');
                        } else if (mode === 'on') {
                        onBtn.classList.add('active');
                        onBtn.classList.add('live');
                        }

                        group.dataset.mode = mode;
                    };

                    // Инициализация: Auto по умолчанию
                    setMode(group.dataset.mode || 'auto');

                    // Обработчики кликов
                    autoBtn.addEventListener('click', () => setMode('auto'));
                    onBtn.addEventListener('click', () => setMode('on'));

                    // Внешнее обновление (например, по телеметрии)
                    group.updateLive = (isOn) => {
                        if ((group.dataset.mode || 'auto') !== 'auto') return;
                        autoBtn.classList.remove('live');
                        onBtn.classList.remove('live');
                        (isOn ? onBtn : autoBtn).classList.add('live');
                    };

                    // Сейчас: live = On
                    onBtn.classList.add('live');
                    });
                });

        </script>

        <!-- TAB 2: Payload Control -->
        <script>
            // === Control of drawer display state ===
            // All comments in English.

            function setDrawerDisplay(state) {
            // state should be either "authorized" or "prohibited"
            const display = document.getElementById("drawer-display");
            if (!display) return;

            const icon = display.querySelector(".display-icon");
            const text = display.querySelector(".display-value");

            if (state === "authorized") {
                icon.src = "images/unlock-icon.svg";
                icon.alt = "Unlock";
                text.textContent = "Release Authorized";
            } else if (state === "prohibited") {
                icon.src = "images/lock-icon.svg";
                icon.alt = "Lock";
                text.textContent = "Release Prohibited";
            }
            }

            // Example: default is "authorized"
            // Later you can call setDrawerDisplay("prohibited") when external signal arrives
        </script>


        <!-- TAB 4: Battery Status -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('ignitionBtn');

            const setState = (n) => btn.setAttribute('data-state', String(n));

            // Клик по всей кнопке в состояниях 1 и 3 -> переход в сплит (2)
            btn.addEventListener('click', (e) => {
                const s = Number(btn.getAttribute('data-state') || 1);
                if (s === 1 || s === 3) setState(2);
            });

            // Обработчики половинок в состоянии 2
            btn.querySelector('.half-off').addEventListener('click', (e) => {
                e.stopPropagation();           // не пускаем событие вверх
                setState(1);                   // Off -> назад в 1
            });
            btn.querySelector('.half-start').addEventListener('click', (e) => {
                e.stopPropagation();
                setState(3);                   // Start -> в 3 (зелёный)
            });
            });
        </script>

        <!-- TAB 4: ENGINE. House Relay -->
        <script>
        // 3-way relay control: Off / Auto / On
        document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.drawer-button-relay').forEach(group => {
            const offBtn  = group.querySelector('.relay-btn.off');
            const autoBtn = group.querySelector('.relay-btn.auto');
            const onBtn   = group.querySelector('.relay-btn.on');

            // Find paired display within the same relay-controls block
            const displayValue = group.closest('.relay-controls')?.querySelector('.display-value');

            // Helpers
            const clearStates = () => {
            [offBtn, autoBtn, onBtn].forEach(b => {
                b.classList.remove('active'); // gray fill (manual selection)
                b.classList.remove('live');   // white outline (actual state)
            });
            };

            const getAutoLiveTarget = () => {
            // Default: 'on'. Switch to 'off' by setting data-live-default="off" on the group.
            return (group.dataset.liveDefault || 'on').toLowerCase() === 'off' ? offBtn : onBtn;
            };

            const updateDisplayForMode = (mode) => {
            if (!displayValue) return;

            if (mode === 'on') {
                // Show value from the ON button
                displayValue.textContent = onBtn.dataset.value || '--';
            } else if (mode === 'auto') {
                // Mirror the current live target in AUTO (default is ON)
                const liveTarget = getAutoLiveTarget();
                displayValue.textContent = liveTarget.dataset.value || '--';
            } else {
                // OFF -> placeholder
                displayValue.textContent = '--';
            }
            };

            const setMode = (mode) => {
            clearStates();

            if (mode === 'off') {
                offBtn.classList.add('active');
                offBtn.classList.add('live');         // real state = Off
            } else if (mode === 'on') {
                onBtn.classList.add('active');
                onBtn.classList.add('live');          // real state = On
            } else { // 'auto'
                autoBtn.classList.add('active');      // manual selection is Auto (gray fill)
                getAutoLiveTarget().classList.add('live'); // real state decided externally (default here)
            }

            updateDisplayForMode(mode);
            group.dataset.mode = mode;
            };

            // Init — start from existing data-mode or 'auto'
            setMode(group.dataset.mode || 'auto');

            // Click handlers
            offBtn.addEventListener('click',  () => setMode('off'));
            onBtn.addEventListener('click',   () => setMode('on'));
            autoBtn.addEventListener('click', () => setMode('auto'));

            // Public hook for telemetry: switch the live outline in AUTO without changing gray selection
            group.updateLive = (isOn) => {
            if ((group.dataset.mode || 'auto') !== 'auto') return;
            offBtn.classList.remove('live');
            onBtn.classList.remove('live');
            (isOn ? onBtn : offBtn).classList.add('live');
            if (displayValue) displayValue.textContent = isOn ? (onBtn.dataset.value || '--') : '--';
            };
        });
        });
        </script>

        <!-- TAB 4: ENGINE. ANIMATION LOAD -->
        <script>
        // All comments in English.

        /** Get loader element once */
        const getStartLoaderEl = () => document.getElementById('start-loader');

        /** Show overlay with optional auto-hide */
        function showStartLoader(durationMs = 1200){
        // guard: the element must exist
        const el = getStartLoaderEl();
        if(!el) return;

        // prevent click-through interactions
        el.style.pointerEvents = 'auto';

        // show
        el.classList.add('show');

        // clear previous timers if any
        if (el._hideTimer) clearTimeout(el._hideTimer);

        // auto-hide after duration (we can remove this once real animation controls the lifecycle)
        el._hideTimer = setTimeout(() => hideStartLoader(), durationMs);
        }

        /** Hide overlay */
        function hideStartLoader(){
        const el = getStartLoaderEl();
        if(!el) return;
        el.classList.remove('show');
        el.style.pointerEvents = 'none';
        }

        /** Hook into existing ignition half buttons */
        document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('ignitionBtn');
        if(!btn) return;

        // keep existing handlers...
        const setState = (n) => btn.setAttribute('data-state', String(n));

        // left half remains the same
        const halfOff = btn.querySelector('.half-off');
        if (halfOff){
            halfOff.addEventListener('click', (e) => {
            e.stopPropagation();
            setState(1);
            // If loader was shown previously, ensure it is hidden
            hideStartLoader();
            });
        }

        // right half: now also trigger loader
        const halfStart = btn.querySelector('.half-start');
        if (halfStart){
            halfStart.addEventListener('click', (e) => {
            e.stopPropagation();
            setState(3);             // your existing green state
            showStartLoader();       // show loader overlay (auto hides)
            });
        }
        });
        </script>
        
        <script>
        function mountStartPower(opts = {}){
        const slot = document.querySelector('#start-loader .loader-slot');
        if (!slot) return;

        const fillMs = Number(opts.fillMs ?? 2000);
        const lineMs = Number(opts.lineMs ?? 1000);

        // Inject SVG (unit circumference via pathLength="1")
        slot.setAttribute('role', 'img');
        slot.setAttribute('aria-label', 'Starting…');
        slot.innerHTML = `
            <div class="start-power" style="--fill-ms:${fillMs}ms; --line-ms:${lineMs}ms" aria-hidden="true">
            <svg viewBox="0 0 100 100" focusable="false" aria-hidden="true">
                <circle class="start-power__track" cx="50" cy="50" r="45"/>
                <circle class="start-power__progress" id="startPowerProgress"
                        cx="50" cy="50" r="45" pathLength="1"
                        style="--start-frac:0.0833333; --sweep-frac:0.8333333;"/>
                <line class="start-power__line" x1="50" y1="5.7" x2="50" y2="35"/>
            </svg>
            </div>
        `;

        const root = slot.querySelector('.start-power');
        const progress = slot.querySelector('#startPowerProgress');

        // Enforce jitter inline so cascade can't override it
        root.classList.add('is-booting');
        root.style.willChange = 'transform, filter';
        root.style.animation = `startPowerJitter ${fillMs}ms ease-in-out 0s 1 both`;

        if (progress){
            progress.addEventListener('animationend', () => {
            root.classList.remove('is-booting');
            root.style.animation = 'none';
            root.classList.add('is-filled');
            setTimeout(() => {
                hideStartLoader();
                const s = document.querySelector('#start-loader .loader-slot');
                if (s) s.innerHTML = '';
            }, lineMs);
            }, { once: true });
        }
        }

        // Keep overlay visible for the whole run
        (function attachPowerToLoader(){
        const _origShow = window.showStartLoader;
        window.showStartLoader = function(){
            mountStartPower({ fillMs: 2000, lineMs: 1000 });
            if (typeof _origShow === 'function') _origShow(2000 + 1000 + 150);
        };
        })();
        </script>

        <!-- TAB 4: BATTERY LINES -->

        <!-- TAB 5: Mission Pleer -->
        <script>

            // === Minimal timeline logic: evenly space waypoints and move the yellow cursor ===
            (function(){
            // scope to the first mission-pleer on the page
            const pleer = document.querySelector('.mission-pleer');
            if(!pleer) return;

            const track = pleer.querySelector('.timeline-track');
            const points = [...pleer.querySelectorAll('.mission-waypoint')];
            const cursor = pleer.querySelector('.mission-cursor');
            const prevBtn = pleer.querySelector('.js-prev');
            const nextBtn = pleer.querySelector('.js-next');

            let idx = 0; // current waypoint index

            // Position waypoints evenly across the track
            const layoutPoints = () => {
                const n = points.length;
                points.forEach((p, i) => {
                const pct = (n === 1) ? 50 : (i/(n-1))*100;
                p.style.left = pct + '%';
                });
            };

            // Move cursor to waypoint by index
            const updateCursor = () => {
                const target = points[idx];
                if(!target) return;
                cursor.style.left = target.style.left || '0%';
                // enable/disable nav buttons
                prevBtn && (prevBtn.disabled = (idx === 0));
                nextBtn && (nextBtn.disabled = (idx === points.length - 1));
            };

            // Nav handlers
            prevBtn && prevBtn.addEventListener('click', () => { if(idx>0){ idx--; updateCursor(); } });
            nextBtn && nextBtn.addEventListener('click', () => { if(idx<points.length-1){ idx++; updateCursor(); } });

            // Re-layout on resize
            window.addEventListener('resize', layoutPoints);

            layoutPoints();
            updateCursor();
            })();




            
            // Toggle Play/Pause icon and title
            document.addEventListener('DOMContentLoaded', () => {
            const btn = document.querySelector('.pleer-buttons .js-play-toggle');
            if (!btn) return;

            // SVG icons (stroke uses currentColor)
            const ICONS = {
                pause: '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 6v12M16 6v12"/></svg>',
                play:  '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 5v14l11-7z"/></svg>'
            };

            // Initial state = "pause" (matches current icon)
            btn.dataset.state = 'pause';
            btn.setAttribute('aria-pressed', 'false');

            function render() {
                const st = btn.dataset.state;          // "pause" | "play"
                btn.innerHTML = st === 'pause' ? ICONS.pause : ICONS.play;
                btn.title = st === 'pause' ? 'Pause' : 'Play';
                btn.setAttribute('aria-label', btn.title);
                btn.setAttribute('aria-pressed', st === 'play' ? 'true' : 'false');
            }

            btn.addEventListener('click', () => {
                btn.dataset.state = btn.dataset.state === 'pause' ? 'play' : 'pause';
                render();
                // TODO: dispatch your real player command here if needed
                // e.g., player.pause() / player.play()
            });

            render();
            });

        </script>

        <!-- TAB 6: Safety -->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
            const bigButtons = document.querySelectorAll(".big-drawer-button");

            bigButtons.forEach((button) => {
                const label = button.querySelector(".button-drawer-label");
                const originalText = label.textContent;

                button.addEventListener("click", () => {
                button.classList.toggle("active");

                if (button.classList.contains("active")) {
                    if (originalText.includes("Silent Mode")) {
                    // special case for Silent Mode
                    label.textContent = "Silent Mode On";
                    } else {
                    // default case for other Kill-buttons
                    label.textContent = originalText.replace("Kill", "").trim() + " Killed";
                    }
                } else {
                    label.textContent = originalText;
                }
                });
            });
            });
        </script>

        <!-- TAB 8: Sensors -->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
            const toggles = document.querySelectorAll(".drawer-button-toggle");

            toggles.forEach(toggle => {
                const buttons = toggle.querySelectorAll(".toggle-btn");
                const display = toggle.parentElement.querySelector(".drawer-button-display");
                const valueEl = display.querySelector(".display-value");

                buttons.forEach(btn => {
                btn.addEventListener("click", () => {
                    // remove active from all
                    buttons.forEach(b => b.classList.remove("active"));
                    // set active
                    btn.classList.add("active");

                    // update only value (unit stays the same)
                    const value = btn.dataset.value || "--";
                    valueEl.textContent = value;
                });
                });
            });
            });
        </script>



    <!-- MODAL ACTIVE HELM PANEL -->
        <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggleBtn = document.getElementById("helm-toggle");                 // The main button that opens the modal
            const modal = document.getElementById("helm-modal");                     // The modal element
            const modeButtons = modal.querySelectorAll(".ap-mode-btn");             // All mode buttons inside the modal
            const helmValues = modal.querySelectorAll(".helm-display-value");       // All display value elements in the modal

            // When the main button is clicked → open the modal
            toggleBtn.addEventListener("click", () => {
                modal.style.display = "block";                                       // Show the modal

                const currentMode = toggleBtn.dataset.currentMode;                   // Get the current mode (stored in dataset)

                // Highlight the active mode button
                modeButtons.forEach(btn => {
                    if (btn.dataset.mode === currentMode) {
                        btn.classList.add("active");
                    } else {
                        btn.classList.remove("active");
                    }
                });
            });


            // Default to "Robot" on first load if no mode set yet
            if (!toggleBtn.dataset.currentMode) {
            toggleBtn.dataset.currentMode = 'Auto';   // "Auto" is treated as "Robot"
            toggleBtn.textContent = 'Robot';          // reflect on the toggle button

            // highlight "Robot" row in the modal
            helmValues.forEach(el => {
                const isRobot = el.textContent.trim() === 'Robot';
                el.style.color = isRobot ? '#ffffff' : '#757575';
                el.style.fontWeight = isRobot ? '600' : '500';
            });
            }



            // When a mode button is clicked inside the modal
            modeButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    const selectedMode = btn.dataset.mode;
                    const isRobot = selectedMode === "Auto";                         // Treat "Auto" as "Robot"

                    // Update the main button text based on selected mode
                    toggleBtn.textContent = isRobot ? "Robot" : selectedMode;
                    toggleBtn.dataset.currentMode = selectedMode;                    // Store selected mode in the main button

                    // Update display block appearance: highlight "Robot" only
                    helmValues.forEach(el => {
                        if (isRobot && el.textContent.trim() === "Robot") {
                            el.style.color = "#ffffff";
                            el.style.fontWeight = "600";
                        } else {
                            el.style.color = "#757575";
                            el.style.fontWeight = "500";
                        }
                    });

                    // Update the active button style
                    modeButtons.forEach(button => {
                        button.classList.remove("active");                           // Remove previous active state
                    });
                    btn.classList.add("active");                                     // Set active class to clicked button

                    // Close the modal
                    modal.style.display = "none";
                });
            });
        });
        </script>

    <!-- MODAL AUTO PILOT PANEL -->
        <script>
        // Auto-Pilot modal wiring (fixed for #auto-pilot-modal)
        document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('ap-toggle');          // main button
        const modal = document.getElementById('auto-pilot-modal');       // modal window

        if (!toggleBtn || !modal) return; // guard if markup not present

        const modeButtons = modal.querySelectorAll('.ap-mode-btn');

        function openModal(){
            modal.style.display = 'block';
            const currentMode = toggleBtn.dataset.currentMode;
            modeButtons.forEach(b => b.classList.toggle('active', b.dataset.mode === currentMode));
        }
        function closeModal(){ modal.style.display = 'none'; }

        toggleBtn.addEventListener('click', openModal);

        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
            const selectedMode = btn.dataset.mode;
            toggleBtn.textContent = selectedMode;
            toggleBtn.dataset.currentMode = selectedMode;
            closeModal();
            });
        });

        // Optional niceties: click backdrop or ESC to close (safe to keep)
        modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        });
        </script>


    <!-- Close MODAL PANEL -->
        <script>
            // === Click-outside & Esc close for HELM and AUTOPILOT modals ===
            document.addEventListener("DOMContentLoaded", () => {
            // Get references to toggle buttons and modals
            const helmToggle   = document.getElementById("helm-toggle");
            const helmModal    = document.getElementById("helm-modal");
            const helmContent  = helmModal?.querySelector(".status-modal-content");

            const apToggle     = document.getElementById("ap-toggle");
            const apModal      = document.getElementById("status-modal");
            const apContent    = apModal?.querySelector(".status-modal-content");

            // Helper: close a modal safely
            const closeModal = (el) => {
                if (!el) return;
                el.style.display = "none";
            };

            // Close on click outside: we listen on document to catch all clicks
            document.addEventListener("click", (e) => {
                // --- HELM ---
                if (helmModal && helmModal.style.display === "block") {
                const clickedOutsideHelm =
                    helmContent && !helmContent.contains(e.target) && e.target !== helmToggle && !helmToggle?.contains(e.target);
                if (clickedOutsideHelm) closeModal(helmModal);
                }

                // --- AUTOPILOT ---
                if (apModal && apModal.style.display === "block") {
                const clickedOutsideAp =
                    apContent && !apContent.contains(e.target) && e.target !== apToggle && !apToggle?.contains(e.target);
                if (clickedOutsideAp) closeModal(apModal);
                }
            });

            // Close on Esc for both
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                if (helmModal && helmModal.style.display === "block") closeModal(helmModal);
                if (apModal   && apModal.style.display === "block")   closeModal(apModal);
                }
            });
            });
        </script>

    <!-- MODAL PANEL DOCKER-->
        <script>
        // Dock a modal flush to .drawer-panel and align bottoms
        function dockModalToDrawer(modal, opts = {}){
        const drawer = document.querySelector(opts.drawerSelector ?? '.drawer-panel');
        if (!modal || !drawer) return;

        const gap = Number(opts.gap ?? 0); // px between drawer and modal, 0 = flush

        const dr = drawer.getBoundingClientRect();
        const vw = window.innerWidth, vh = window.innerHeight;

        // Align bottoms: distance from viewport bottom to drawer's bottom
        const bottom = Math.max(0, vh - dr.bottom);

        // Decide side: if drawer near left edge -> modal to the right; else to the left
        const placeToRight = dr.left <= vw / 2;

        // Apply docking styles
        modal.classList.add('is-docked');
        modal.style.bottom = `${bottom}px`;
        modal.style.maxHeight = `${dr.height}px`;   // keep within drawer height

        if (placeToRight){
            // Drawer at left → modal on its right edge
            modal.style.left = `${Math.round(dr.right + gap)}px`;
            modal.style.right = 'auto';
        } else {
            // Drawer at right → modal on its left edge
            modal.style.right = `${Math.round(vw - dr.left + gap)}px`;
            modal.style.left = 'auto';
        }
        }

        // Helper: set up docking + keep it on resize/drawer resize
        function setupDocking(modalSelector, opts = {}){
        const modal = document.querySelector(modalSelector);
        if(!modal) return;

        const redraw = () => dockModalToDrawer(modal, opts);

        // Recompute on resize
        window.addEventListener('resize', redraw);

        // Recompute when drawer size/position changes
        const drawer = document.querySelector(opts.drawerSelector ?? '.drawer-panel');
        if (drawer && 'ResizeObserver' in window){
            const ro = new ResizeObserver(redraw);
            ro.observe(drawer);
        }

        // If your "open modal" toggles a class, re-dock on show
        // Example: when .status-modal gets .is-open → dock
        const mo = new MutationObserver(() => { if (modal.classList.contains('is-open')) redraw(); });
        mo.observe(modal, { attributes: true, attributeFilter: ['class', 'style'] });

        // Initial (in case modal is already visible)
        redraw();
        }

        // Attach for both modals
        setupDocking('#helm-modal');
        setupDocking('#auto-pilot-modal');

        // Dock both modals with a 10px gap from the drawer
        setupDocking('#helm-modal',   { gap: 4 });  // 10px spacer
        setupDocking('#auto-pilot-modal', { gap: 4 });  // 10px spacer
        </script>

        // WS Scripts
        <script>
        (() => {
        // 1) Connect
        const ws = new WebSocket(
            (location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/ws"
        );

        ws.addEventListener("open", () => {
            // Subscribe to the banks present in the page (unique list)
            const banks = Array.from(new Set(Array.from(document.querySelectorAll(".relay")).map(el => Number(el.dataset.bank))));
            ws.send(JSON.stringify({ type: "subscribe", banks }));
        });

        // 2) Send commands when Off/On is clicked (use your exact classes)
        document.addEventListener("click", (e) => {
            const btn = e.target.closest(".toggle-btn");
            if (!btn) return;

            const relay = btn.closest(".relay");
            if (!relay) return;

            const bank = Number(relay.dataset.bank);
            const instance = Number(relay.dataset.instance);
            const state = btn.classList.contains("on") ? 1 : 0;   // on → 1, off → 0

            // White border (your "active") shows the *commanded* choice
            relay.querySelectorAll(".toggle-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            ws.send(JSON.stringify({ type: "relay.set", bank, instance, state }));
        });

        // 3) Handle feedback from ROS side → reflect actual state & volts
        ws.addEventListener("message", (evt) => {
            let msg; try { msg = JSON.parse(evt.data); } catch { return; }

            // Actual on/off coming from the device (PGN 127501 → relayed as JSON)
            if (msg.type === "relay.state") {
            const relay = document.querySelector(
                `.relay[data-bank="${msg.bank}"][data-instance="${msg.instance}"]`
            );
            if (!relay) return;

            const onBtn  = relay.querySelector(".toggle-btn.on");
            const offBtn = relay.querySelector(".toggle-btn.off");

            // Bold the *actual* state label (your request)
            onBtn.style.fontWeight  = msg.state ? "bold" : "normal";
            offBtn.style.fontWeight = msg.state ? "normal" : "bold";
            }

            // Voltage (PGN 127508 → relayed as JSON)
            if (msg.type === "relay.voltage") {
            const relay = document.querySelector(
                `.relay[data-bank="${msg.bank}"][data-instance="${msg.instance}"]`
            );
            if (!relay) return;
            const display = relay.querySelector(".display-value");
            if (display) display.textContent = (typeof msg.volts === "number" ? msg.volts.toFixed(1) : "--");
            }
        });
        })();
        </script>

</body>
</html>
